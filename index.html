<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>é¢˜åº“å¤ä¹ ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        /* è§¦æ‘¸è®¾å¤‡ä¼˜åŒ– */
        @media (hover: none) and (pointer: coarse) {
            .btn, .option, .status-item, .file-item, .tab-btn {
                min-height: 44px;
            }
            
            .option {
                padding: 14px;
            }
            
            .status-item {
                min-width: 44px;
                min-height: 44px;
            }
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            -webkit-overflow-scrolling: touch;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        /* å…è®¸æ–‡æœ¬é€‰æ‹©çš„å…ƒç´  */
        .question-text, .option-text, .essay-input, input[type="text"], textarea {
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .content {
            padding: 30px;
        }

        .section {
            margin-bottom: 30px;
        }

        .section h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        .file-upload {
            border: 2px dashed #ddd;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .file-upload:hover {
            border-color: #4CAF50;
            background-color: #f9f9f9;
        }

        .file-upload input[type="file"] {
            display: none;
        }

        .file-upload label {
            display: inline-block;
            padding: 12px 24px;
            background: #4CAF50;
            color: white;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .file-upload label:hover {
            background: #45a049;
        }

        .btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn:hover {
            background: #45a049;
            transform: translateY(-2px);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: #2196F3;
        }

        .btn-secondary:hover {
            background: #1976D2;
        }

        .btn-danger {
            background: #f44336;
        }

        .btn-danger:hover {
            background: #d32f2f;
        }

        .question-container {
            background: #f9f9f9;
            border-radius: 10px;
            padding: 25px;
            margin: 20px 0;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .question-number {
            background: #4CAF50;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
        }

        .question-type {
            background: #2196F3;
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 14px;
        }

        .question-text {
            font-size: 18px;
            line-height: 1.6;
            margin-bottom: 20px;
            color: #333;
        }

        .options {
            margin: 15px 0;
        }

        .option {
            margin: 10px 0;
            padding: 12px;
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .option:hover {
            border-color: #4CAF50;
            background: #f0f8f0;
        }

        .option.selected {
            border-color: #4CAF50;
            background: #e8f5e8;
            box-shadow: 0 2px 8px rgba(76, 175, 80, 0.3);
        }

        .answer-saved {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4CAF50;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
        }

        .answer-saved.show {
            opacity: 1;
            transform: translateX(0);
        }

        .option input[type="radio"], .option input[type="checkbox"] {
            margin-right: 10px;
        }

        .textarea-answer {
            width: 100%;
            min-height: 120px;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            font-family: inherit;
            resize: vertical;
            transition: border-color 0.3s ease;
        }

        .textarea-answer:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
        }

        .options-display {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .options-display h4 {
            margin: 0 0 10px 0;
            color: #495057;
            font-size: 16px;
        }

        .option-text {
              padding: 10px 0;
              color: #6c757d;
              font-size: 15px;
              line-height: 1.5;
              border-bottom: 1px solid #e9ecef;
              display: block;
              width: 100%;
          }

          .option-text:last-child {
              border-bottom: none;
          }
 
          .option-text:not(:first-child) {
              margin-top: 8px;
          }

        .answer-input-container {
            margin-top: 20px;
        }

        .answer-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #495057;
            font-size: 16px;
        }

        .answer-input {
            width: 320px;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            text-align: center;
            text-transform: uppercase;
            transition: all 0.3s ease;
        }

        .answer-input:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
            transform: scale(1.02);
        }

        .answer-input::placeholder {
            color: #adb5bd;
            font-weight: normal;
            text-transform: none;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
        }

        .question-status {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 20px 0;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 10px;
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .question-status.collapsed {
            max-height: 0;
            padding: 0 15px;
            margin: 0;
            opacity: 0;
        }

        .total-count-toggle {
            cursor: pointer;
            user-select: none;
            transition: color 0.3s ease;
        }

        .total-count-toggle:hover {
            color: #4CAF50;
        }

        #toggleIcon {
            font-size: 12px;
            margin-left: 5px;
            transition: transform 0.3s ease;
        }

        .question-status:not(.collapsed) ~ * #toggleIcon,
        .question-status.expanded #toggleIcon {
            transform: rotate(180deg);
        }

        .detected-files {
            margin-bottom: 20px;
        }

        .detected-files h3 {
            color: #4CAF50;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .file-list {
            background: #f9f9f9;
            border-radius: 8px;
            padding: 15px;
            min-height: 60px;
        }

        .loading-text {
            color: #666;
            font-style: italic;
            text-align: center;
            margin: 0;
        }

        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            margin: 8px 0;
            background: white;
            border-radius: 6px;
            border: 1px solid #ddd;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .file-item:hover {
            border-color: #4CAF50;
            box-shadow: 0 2px 8px rgba(76, 175, 80, 0.2);
        }

        .file-item.selected {
            border-color: #4CAF50;
            background: #e8f5e8;
        }

        .file-name {
            font-weight: 500;
            color: #333;
        }

        .file-size {
            color: #666;
            font-size: 14px;
        }

        .divider {
            text-align: center;
            margin: 25px 0;
            position: relative;
        }

        .divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: #ddd;
        }

        .divider span {
            background: white;
            padding: 0 20px;
            color: #666;
            font-size: 14px;
        }
        
        /* è€ƒè¯•è®¾ç½®æ ·å¼ */
        .exam-settings {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .exam-settings h3 {
            margin: 0 0 20px 0;
            color: #495057;
            font-size: 18px;
        }
        
        .setting-group {
            margin-bottom: 20px;
        }
        
        .setting-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #495057;
        }
        
        .question-type-selection {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        
        .type-info {
            display: flex !important;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            font-weight: normal !important;
            margin-bottom: 0 !important;
        }
        
        .available-count {
            margin-left: auto;
            font-size: 12px;
            color: #6c757d;
        }
        
        .number-input-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .number-input-group input {
            width: 100px;
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 16px;
        }
        
        .max-count-hint {
            font-size: 12px;
            color: #6c757d;
        }
        
        .setting-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }
        
        .setting-actions .btn {
            min-width: 120px;
        }
        
        /* é¢˜å‹æ•°é‡è®¾ç½®æ ·å¼ */
        .question-count-settings {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 15px;
            margin-top: 10px;
        }
        
        .count-input-row {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            gap: 10px;
        }
        
        .count-input-row:last-child {
            margin-bottom: 0;
        }
        
        .count-input-row label {
            min-width: 80px;
            margin: 0 !important;
            font-weight: normal !important;
            color: #495057;
        }
        
        .count-input-row input {
            width: 80px;
            padding: 6px 10px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
            text-align: center;
        }
        
        .count-input-row input:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
        }
        
        .max-hint {
            font-size: 12px;
            color: #6c757d;
            margin-left: auto;
        }
        
        .total-count-display {
            margin-top: 15px;
            padding: 10px;
            background: #e9ecef;
            border-radius: 4px;
            text-align: center;
            font-size: 14px;
            color: #495057;
        }
        
        .total-count-display strong {
            color: #007bff;
            font-size: 16px;
        }
        
        /* æ—¶é—´è®¾ç½®æ ·å¼ */
        .time-setting {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }
        
        .time-option {
            display: flex !important;
            align-items: center;
            margin: 0 !important;
            font-weight: normal !important;
            cursor: pointer;
        }
        
        .time-option input[type="radio"] {
            margin-right: 8px;
            transform: scale(1.2);
        }
        
        .time-input-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
            border: 1px solid #dee2e6;
        }
        
        .time-input-group label {
            margin: 0 !important;
            font-weight: normal !important;
            color: #495057;
        }
        
        .time-input-group input {
            width: 80px;
            padding: 6px 10px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
            text-align: center;
        }
        
        .time-input-group input:focus {
             outline: none;
             border-color: #007bff;
             box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
         }
         
         /* è€ƒè¯•æ—¶é—´æ˜¾ç¤ºæ ·å¼ */
         .exam-timer, .exam-duration {
             text-align: center;
             margin: 15px 0;
             padding: 10px;
             background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
             border-radius: 8px;
             box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
         }
         
         .exam-timer {
             background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
         }
         
         .exam-duration {
             background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
         }
         
         .timer-display, .duration-display {
             display: flex;
             justify-content: center;
             align-items: center;
             gap: 10px;
         }
         
         .timer-label, .duration-label {
             color: white;
             font-size: 16px;
             font-weight: 500;
         }
         
         .timer-value, .duration-value {
             color: white;
             font-size: 24px;
             font-weight: bold;
             font-family: 'Courier New', monospace;
             text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
         }
         
         .timer-value.warning {
              color: #fff200;
              text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
              animation: pulse 1s infinite;
          }
          
          .timer-value.danger {
              color: #ffffff;
              text-shadow: 0 2px 6px rgba(0, 0, 0, 0.9);
              animation: pulse 0.5s infinite;
          }
         
         @keyframes pulse {
             0%, 100% { opacity: 1; }
             50% { opacity: 0.7; }
         }

        .no-files-message {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px dashed #ddd;
            margin: 10px 0;
        }
        
        .loading-message {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 20px;
            background: #f0f8ff;
            border-radius: 8px;
            border: 1px solid #e3f2fd;
            margin: 10px 0;
        }

        .status-item {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid #ddd;
            background: white;
        }

        .status-item.answered {
            background: #4CAF50;
            color: white;
            border-color: #4CAF50;
        }

        .status-item.current {
            background: #2196F3;
            color: white;
            border-color: #2196F3;
            transform: scale(1.1);
        }

        .status-item:hover {
            transform: scale(1.05);
        }

        .progress {
            background: #ddd;
            border-radius: 10px;
            height: 10px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-bar {
            background: #4CAF50;
            height: 100%;
            transition: width 0.3s ease;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #4CAF50;
        }

        .stat-label {
            color: #666;
            margin-top: 5px;
        }

        .wrong-questions {
            margin-top: 30px;
        }

        .wrong-question {
            background: #ffebee;
            border-left: 4px solid #f44336;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        
        .correct-questions {
            margin-top: 30px;
        }
        
        .correct-question {
            background: #e8f5e9;
            border-left: 4px solid #4CAF50;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        
        .correct-questions-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .correct-questions-header h3 {
            margin: 0;
        }
        
        .export-buttons {
            display: flex;
            gap: 10px;
        }
        
        .export-buttons .btn {
            background-color: #17a2b8;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .export-buttons .btn:hover {
            background-color: #138496;
        }

        .tab-navigation {
            display: flex;
            margin: 20px 0;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab-btn {
            padding: 12px 24px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .tab-btn.active {
            color: #4CAF50;
            border-bottom-color: #4CAF50;
            font-weight: bold;
        }

        .tab-btn:hover {
            color: #4CAF50;
            background-color: #f5f5f5;
        }

        .tab-content {
            display: none;
            padding: 20px 0;
        }

        .tab-content.active {
            display: block;
        }

        .essay-answers {
            background: #f9f9f9;
            border-radius: 8px;
            padding: 20px;
        }

        .essay-question {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #2196F3;
        }

        .essay-question h4 {
            color: #2196F3;
            margin-bottom: 15px;
        }

        .essay-answer {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
        }

        .user-essay-answer {
            background-color: #fff3cd;
            border-left: 3px solid #ffc107;
        }

        .correct-essay-answer {
            background-color: #d4edda;
            border-left: 3px solid #28a745;
        }

        .confirm-answer-btn {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s ease;
        }

        .confirm-answer-btn:hover {
            background-color: #45a049;
        }

        .answer-result {
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .wrong-questions-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .wrong-questions-header h3 {
            margin: 0;
        }

        #exportWrongBtn {
            background-color: #17a2b8;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        #exportWrongBtn:hover {
            background-color: #138496;
        }

        .answer-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 15px;
        }

        .user-answer, .correct-answer {
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #dee2e6;
        }

        .user-answer {
            background: #fff3cd;
            border-color: #ffeaa7;
        }

        .correct-answer {
            background: #d1ecf1;
            border-color: #bee5eb;
        }

        .answer-label {
            font-weight: bold;
            margin-bottom: 8px;
            display: block;
        }

        .user-answer .answer-label {
            color: #856404;
        }

        .correct-answer .answer-label {
            color: #0c5460;
        }

        @media (max-width: 768px) {
            .answer-comparison {
                grid-template-columns: 1fr;
            }
            
            .tab-navigation {
                flex-direction: column;
            }
            
            .stats {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
            
            .question-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            
            .question-text {
                font-size: 16px;
                line-height: 1.6;
            }
        }

        .hidden {
            display: none;
        }

        .info {
            background: #e3f2fd;
            border: 1px solid #2196F3;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
            color: #1976D2;
        }

        .success {
            background: #e8f5e9;
            border: 1px solid #4CAF50;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
            color: #2e7d32;
        }

        @media (max-width: 600px) {
            .container {
                margin: 5px;
            }
            
            .content {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 24px;
            }
            
            .header p {
                font-size: 14px;
            }
            
            .navigation {
                flex-direction: column;
                gap: 10px;
            }
            
            .btn {
                padding: 12px 20px;
                font-size: 16px;
                min-height: 48px;
                width: 100%;
            }
            
            .btn-secondary {
                padding: 10px 16px;
                font-size: 14px;
                min-height: 44px;
            }
            
            .stats {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .stat-card {
                padding: 15px;
            }
            
            .stat-number {
                font-size: 1.8em;
            }
            
            .question-container {
                padding: 15px;
            }
            
            .question-text {
                font-size: 15px;
                line-height: 1.5;
                margin: 15px 0;
            }
            
            .option {
                padding: 12px;
                margin: 8px 0;
                font-size: 15px;
            }
            
            .option input[type="radio"],
            .option input[type="checkbox"] {
                width: 18px;
                height: 18px;
            }
            
            .answer-input {
                width: 100%;
                max-width: 280px;
                font-size: 16px;
                padding: 12px;
            }
            
            .answer-input::placeholder {
                font-size: 14px;
            }
            
            .question-status {
                padding: 10px;
            }
            
            .status-item {
                width: 28px;
                height: 28px;
                font-size: 11px;
                margin: 2px;
            }
            
            .tab-btn {
                padding: 10px 16px;
                font-size: 14px;
            }
            
            .wrong-question {
                padding: 12px;
                margin: 8px 0;
            }
            
            .answer-comparison {
                gap: 10px;
            }
            
            .user-answer, .correct-answer {
                padding: 12px;
                font-size: 14px;
            }
            
            .progress {
                height: 8px;
                margin: 15px 0;
            }
            
            #questionProgress {
                font-size: 14px;
                padding: 8px 12px;
                background: #f5f5f5;
                border-radius: 20px;
                margin: 0 10px;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                margin: 0;
                border-radius: 0;
            }
            
            .content {
                padding: 10px;
            }
            
            .header {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 20px;
            }
            
            .navigation {
                 gap: 8px;
                 padding: 0 5px;
             }
             
             .btn {
                 padding: 14px 20px;
                 font-size: 16px;
                 border-radius: 8px;
                 flex: 1;
                 max-width: none;
             }
             
             .btn-secondary {
                 flex: 0 0 auto;
                 min-width: 80px;
             }
             
             #questionProgress {
                 flex: 0 0 auto;
                 white-space: nowrap;
                 font-weight: bold;
             }
            
            .question-text {
                font-size: 14px;
            }
            
            .option {
                padding: 10px;
                font-size: 14px;
            }
            
            .status-item {
                 width: 26px;
                 height: 26px;
                 font-size: 10px;
             }
             
             .essay-input {
                 font-size: 16px;
                 padding: 12px;
                 min-height: 120px;
                 border-radius: 8px;
             }
             
             .file-upload input[type="file"] {
                 font-size: 16px;
                 padding: 12px;
             }
             
             .file-upload label {
                 font-size: 16px;
                 padding: 12px 20px;
                 min-height: 48px;
                 display: flex;
                 align-items: center;
                 justify-content: center;
             }
             
             .detected-files h3 {
                 font-size: 16px;
             }
             
             .file-item {
                 padding: 12px;
                 font-size: 14px;
             }
             
             .answer-input {
                 width: 100%;
                 max-width: 250px;
                 font-size: 16px;
                 padding: 10px;
             }
             
             .answer-input::placeholder {
                 font-size: 13px;
             }
             
             .divider {
                 margin: 20px 0;
             }
             
             .divider span {
                 font-size: 14px;
                 padding: 0 15px;
             }
         }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“š é¢˜åº“å¤ä¹ ç³»ç»Ÿ</h1>
            <p>å¯¼å…¥é¢˜åº“ï¼Œå¼€å§‹ä½ çš„å¤ä¹ ä¹‹æ—…</p>
        </div>
        
        <div class="content">
            <!-- æ–‡ä»¶å¯¼å…¥åŒºåŸŸ -->
            <div id="import-section" class="section">
                <h2>ğŸ“ å¯¼å…¥é¢˜åº“</h2>
                
                <!-- è‡ªåŠ¨æ£€æµ‹çš„CSVæ–‡ä»¶åˆ—è¡¨ -->
                <div id="detected-files" class="detected-files">
                    <h3>ğŸ“‹ æ£€æµ‹åˆ°çš„CSVæ–‡ä»¶</h3>
                    <div id="fileList" class="file-list">
                        <p class="loading-text">æ­£åœ¨æ£€æµ‹åŒç›®å½•ä¸‹çš„CSVæ–‡ä»¶...</p>
                    </div>
                </div>
                
                <!-- åˆ†éš”çº¿ -->
                <div class="divider">
                    <span>æˆ–è€…</span>
                </div>
                
                <!-- æ‰‹åŠ¨ä¸Šä¼ æ–‡ä»¶ -->
                <div class="file-upload">
                    <input type="file" id="csvFile" accept=".csv" />
                    <label for="csvFile">æ‰‹åŠ¨ä¸Šä¼ CSVæ–‡ä»¶</label>
                    <p style="margin-top: 15px; color: #666;">æ”¯æŒæ ¼å¼ï¼šç¼–å·,é¢˜ç›®ç±»å‹,é¢˜ç›®,é¢˜ç›®é€‰é¡¹,é¢˜ç›®ç­”æ¡ˆ,ç­”æ¡ˆè¯´æ˜</p>
                </div>
                
                <div id="file-info" class="info hidden">
                    <p>æ–‡ä»¶å·²é€‰æ‹©ï¼Œç‚¹å‡»ä¸‹æ–¹æŒ‰é’®è§£æé¢˜åº“</p>
                </div>
                <button id="parseBtn" class="btn" disabled>è§£æé¢˜åº“</button>
            </div>

            <!-- é¢˜åº“ä¿¡æ¯åŒºåŸŸ -->
            <div id="library-section" class="section hidden">
                <h2>ğŸ“Š é¢˜åº“ä¿¡æ¯</h2>
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-number" id="totalQuestions">0</div>
                        <div class="stat-label">æ€»é¢˜æ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="singleChoice">0</div>
                        <div class="stat-label">å•é€‰é¢˜</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="multiChoice">0</div>
                        <div class="stat-label">å¤šé€‰é¢˜</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="trueOrFalse">0</div>
                        <div class="stat-label">åˆ¤æ–­é¢˜</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="essay">0</div>
                        <div class="stat-label">é—®ç­”é¢˜</div>
                    </div>
                </div>
                
                <!-- è€ƒè¯•è®¾ç½®åŒºåŸŸ -->
                <div id="exam-settings" class="exam-settings" style="display: none;">
                    <h3>ğŸ“ è€ƒè¯•è®¾ç½®</h3>
                    
                    <div class="setting-group">
                        <label>é¢˜åº“ç»Ÿè®¡ï¼š</label>
                        <div class="question-type-selection">
                            <div class="type-info">
                                <span>å•é€‰é¢˜</span>
                                <span class="available-count" id="singleAvailable">(0é¢˜)</span>
                            </div>
                            <div class="type-info">
                                <span>å¤šé€‰é¢˜</span>
                                <span class="available-count" id="multiAvailable">(0é¢˜)</span>
                            </div>
                            <div class="type-info">
                                <span>åˆ¤æ–­é¢˜</span>
                                <span class="available-count" id="trueOrFalseAvailable">(0é¢˜)</span>
                            </div>
                            <div class="type-info">
                                <span>é—®ç­”é¢˜</span>
                                <span class="available-count" id="essayAvailable">(0é¢˜)</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="setting-group">
                        <label>å„é¢˜å‹æ•°é‡è®¾ç½®ï¼š</label>
                        <div class="question-count-settings">
                            <div class="count-input-row">
                                <label for="singleCount">å•é€‰é¢˜ï¼š</label>
                                <input type="number" id="singleCount" min="0" max="100" value="5">
                                <span class="max-hint" id="singleMaxHint">æœ€å¤š 0 é¢˜</span>
                            </div>
                            <div class="count-input-row">
                                <label for="multiCount">å¤šé€‰é¢˜ï¼š</label>
                                <input type="number" id="multiCount" min="0" max="100" value="3">
                                <span class="max-hint" id="multiMaxHint">æœ€å¤š 0 é¢˜</span>
                            </div>
                            <div class="count-input-row">
                                <label for="trueOrFalseCount">åˆ¤æ–­é¢˜ï¼š</label>
                                <input type="number" id="trueOrFalseCount" min="0" max="100" value="2">
                                <span class="max-hint" id="trueOrFalseMaxHint">æœ€å¤š 0 é¢˜</span>
                            </div>
                            <div class="count-input-row">
                                <label for="essayCount">é—®ç­”é¢˜ï¼š</label>
                                <input type="number" id="essayCount" min="0" max="100" value="0">
                                <span class="max-hint" id="essayMaxHint">æœ€å¤š 0 é¢˜</span>
                            </div>
                        </div>
                        <div class="total-count-display">
                            <span>æ€»é¢˜ç›®æ•°ï¼š<strong id="totalQuestionCount">10</strong></span>
                        </div>
                    </div>
                    
                    <div class="setting-group">
                        <label>æ—¶é—´è®¾ç½®ï¼š</label>
                        <div class="time-setting">
                            <label class="time-option">
                                <input type="radio" name="timeMode" id="noTimeLimit" value="none" checked>
                                <span>æ— æ—¶é—´é™åˆ¶</span>
                            </label>
                            <label class="time-option">
                                <input type="radio" name="timeMode" id="hasTimeLimit" value="limited">
                                <span>é™æ—¶è€ƒè¯•</span>
                            </label>
                        </div>
                        <div class="time-input-group" id="timeInputGroup" style="display: none;">
                            <label for="examTimeLimit">è€ƒè¯•æ—¶é•¿ï¼š</label>
                            <input type="number" id="examTimeLimit" min="1" max="300" value="60" placeholder="åˆ†é’Ÿ">
                            <span>åˆ†é’Ÿ</span>
                        </div>
                    </div>
                    
                    <div class="setting-actions">
                        <button id="confirmSettings" class="btn btn-primary">âœ… ç¡®è®¤è®¾ç½®</button>
                        <button id="cancelSettings" class="btn btn-secondary">âŒ å–æ¶ˆ</button>
                    </div>
                </div>
                
                <button id="startExam" class="btn">ğŸš€ å¼€å§‹è€ƒè¯•</button>
            </div>

            <!-- è€ƒè¯•åŒºåŸŸ -->
            <div id="exam-section" class="section hidden">
                <div class="progress">
                    <div class="progress-bar" id="progressBar"></div>
                </div>
                
                <!-- æ—¶é—´æ˜¾ç¤ºåŒºåŸŸ -->
                <div class="exam-timer" id="examTimer" style="display: none;">
                    <div class="timer-display">
                        <span class="timer-label">å‰©ä½™æ—¶é—´ï¼š</span>
                        <span class="timer-value" id="timerValue">60:00</span>
                    </div>
                </div>
                
                <div class="exam-duration" id="examDuration" style="display: none;">
                    <div class="duration-display">
                        <span class="duration-label">è€ƒè¯•ç”¨æ—¶ï¼š</span>
                        <span class="duration-value" id="durationValue">00:00</span>
                    </div>
                </div>
                
                <div style="text-align: center; margin: 15px 0; color: #666;">
                    <span id="answeredCount">å·²ç­”é¢˜: 0</span> / 
                    <span id="totalCount" class="total-count-toggle" onclick="toggleQuestionStatus()">æ€»é¢˜æ•°: 0 <span id="toggleIcon">â–¼</span></span>
                </div>
                <div class="question-status collapsed" id="questionStatus"></div>
                
                <div class="question-container">
                    <div class="question-header">
                        <span class="question-number" id="questionNumber">ç¬¬ 1 é¢˜</span>
                        <span class="question-type" id="questionType">å•é€‰é¢˜</span>
                    </div>
                    
                    <div class="question-text" id="questionText"></div>
                    
                    <div id="optionsContainer" class="options"></div>
                    
                    <div class="navigation">
                        <button id="prevBtn" class="btn btn-secondary" disabled>â¬…ï¸ ä¸Šä¸€é¢˜</button>
                        <span id="questionProgress">1 / 10</span>
                        <button id="nextBtn" class="btn btn-secondary">ä¸‹ä¸€é¢˜ â¡ï¸</button>
                        <button id="submitBtn" class="btn btn-danger hidden">ğŸ“ äº¤å·</button>
                    </div>
                </div>
            </div>

            <!-- ç»“æœåŒºåŸŸ -->
            <div id="result-section" class="section hidden">
                <h2>ğŸ“ˆ è€ƒè¯•ç»“æœ</h2>
                <!-- é¡µç­¾å¯¼èˆª -->
                <div class="tab-navigation">
                    <button class="tab-btn active" onclick="showTab('wrong-questions')">é”™è¯¯é¢˜ç›®å¤ä¹ </button>
                    <button class="tab-btn" onclick="showTab('correct-questions')">æ­£ç¡®é¢˜ç›®å±•ç¤º</button>
                    <button class="tab-btn" onclick="showTab('essay-answers')">é—®ç­”é¢˜ç­”æ¡ˆå¯¹æ¯”</button>
                </div>
                
                <!-- é”™è¯¯é¢˜ç›®é¡µç­¾ -->
                <div id="wrong-questions-tab" class="tab-content active">
                    <div class="stats">
                        <div class="stat-card">
                            <div class="stat-number" id="totalScore">0</div>
                            <div class="stat-label">æ€»åˆ†</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="correctCount">0</div>
                            <div class="stat-label">æ­£ç¡®é¢˜æ•°</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="wrongCount">0</div>
                            <div class="stat-label">é”™è¯¯é¢˜æ•°</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="accuracy">0%</div>
                            <div class="stat-label">æ­£ç¡®ç‡</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="examTime">00:00</div>
                            <div class="stat-label">è€ƒè¯•ç”¨æ—¶</div>
                        </div>
                    </div>
                    
                    <div class="wrong-questions" id="wrongQuestions">
                        <div class="wrong-questions-header">
                            <h3>âŒ é”™è¯¯é¢˜ç›®å¤ä¹ </h3>
                            <button id="exportWrongBtn" class="btn btn-secondary" style="display: none;">ğŸ“¥ å¯¼å‡ºé”™é¢˜</button>
                        </div>
                    </div>
                </div>
                
                <!-- æ­£ç¡®é¢˜ç›®å±•ç¤ºé¡µç­¾ -->
                <div id="correct-questions-tab" class="tab-content">
                    <div class="correct-questions" id="correctQuestions">
                        <div class="correct-questions-header">
                            <h3>âœ… æ­£ç¡®é¢˜ç›®å±•ç¤º</h3>
                            <div class="export-buttons">
                                <button id="exportCorrectBtn" class="btn btn-secondary" style="display: none;">ğŸ“¥ å¯¼å‡ºæ­£ç¡®é¢˜ç›®</button>
                                <button id="exportAllBtn" class="btn btn-secondary" style="display: none;">ğŸ“¥ å¯¼å‡ºå…¨éƒ¨é¢˜ç›®</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- é—®ç­”é¢˜ç­”æ¡ˆå¯¹æ¯”é¡µç­¾ -->
                <div id="essay-answers-tab" class="tab-content">
                    <div class="essay-answers" id="essayAnswers">
                        <h3>ğŸ“ é—®ç­”é¢˜ç­”æ¡ˆå¯¹æ¯”</h3>
                    </div>
                </div>
                
                <button id="restartBtn" class="btn">ğŸ”„ é‡æ–°å¼€å§‹</button>
            </div>
        </div>
    </div>

    <!-- ç­”æ¡ˆä¿å­˜æç¤º -->
    <div id="answerSavedNotification" class="answer-saved">
        âœ“ ç­”æ¡ˆå·²ä¿å­˜
    </div>

    <script>
        class QuestionBank {
            constructor() {
                this.questions = [];
                this.allQuestions = []; // ä¿å­˜å®Œæ•´çš„é¢˜ç›®åˆ—è¡¨
                this.currentQuestionIndex = 0;
                this.userAnswers = [];
                this.wrongQuestionsData = null;
                this.correctQuestionsData = null; // å­˜å‚¨æ­£ç¡®é¢˜ç›®æ•°æ®
                this.answeredQuestions = new Set(); // è®°å½•å·²å›ç­”çš„é¢˜ç›®
                this.selectedFile = null; // å½“å‰é€‰ä¸­çš„æ–‡ä»¶
                this.detectedFiles = []; // æ£€æµ‹åˆ°çš„æ–‡ä»¶åˆ—è¡¨
                
                // æ—¶é—´ç®¡ç†ç›¸å…³å˜é‡
                this.examStartTime = null; // è€ƒè¯•å¼€å§‹æ—¶é—´
                this.examEndTime = null; // è€ƒè¯•ç»“æŸæ—¶é—´
                this.examTimeLimit = null; // è€ƒè¯•æ—¶é—´é™åˆ¶ï¼ˆåˆ†é’Ÿï¼‰
                this.timerInterval = null; // è®¡æ—¶å™¨é—´éš”
                this.isTimeLimited = false; // æ˜¯å¦æœ‰æ—¶é—´é™åˆ¶
                
                this.initEventListeners();
                this.detectCSVFiles(); // è‡ªåŠ¨æ£€æµ‹CSVæ–‡ä»¶
            }

            initEventListeners() {
                document.getElementById('csvFile').addEventListener('change', this.handleFileSelect.bind(this));
                document.getElementById('parseBtn').addEventListener('click', this.parseCSV.bind(this));
                document.getElementById('startExam').addEventListener('click', this.showExamSettings.bind(this));
                document.getElementById('confirmSettings').addEventListener('click', this.startExamWithSettings.bind(this));
                document.getElementById('cancelSettings').addEventListener('click', this.hideExamSettings.bind(this));
                document.getElementById('prevBtn').addEventListener('click', this.previousQuestion.bind(this));
                document.getElementById('nextBtn').addEventListener('click', this.nextQuestion.bind(this));
                document.getElementById('submitBtn').addEventListener('click', this.submitExam.bind(this));
                document.getElementById('restartBtn').addEventListener('click', this.restart.bind(this));
                document.getElementById('exportWrongBtn').addEventListener('click', this.exportWrongQuestions.bind(this));
                document.getElementById('exportCorrectBtn').addEventListener('click', this.exportCorrectQuestions.bind(this));
                document.getElementById('exportAllBtn').addEventListener('click', this.exportAllQuestions.bind(this));
                
                // é¢˜å‹é€‰æ‹©åŠŸèƒ½å·²ç§»é™¤ï¼Œç°åœ¨é€šè¿‡æ•°é‡è®¾ç½®æ¥æ§åˆ¶
                
                // å„é¢˜å‹æ•°é‡è¾“å…¥å˜åŒ–æ—¶éªŒè¯å’Œæ›´æ–°æ€»æ•°
                ['singleCount', 'multiCount', 'trueOrFalseCount', 'essayCount'].forEach(id => {
                    document.getElementById(id).addEventListener('input', this.updateTotalCount.bind(this));
                });
                
                // æ—¶é—´è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
                document.getElementById('noTimeLimit').addEventListener('change', this.toggleTimeInput.bind(this));
                document.getElementById('hasTimeLimit').addEventListener('change', this.toggleTimeInput.bind(this));
            }

            async detectCSVFiles() {
                try {
                    const fileList = document.getElementById('fileList');
                    fileList.innerHTML = '<p class="loading-message">æ­£åœ¨æ£€æµ‹CSVæ–‡ä»¶...</p>';
                    
                    // æ£€æµ‹åŒç›®å½•ä¸‹çš„CSVæ–‡ä»¶
                    // ç”±äºæµè§ˆå™¨CORSé™åˆ¶ï¼Œåªèƒ½æ£€æµ‹é€šè¿‡HTTPæœåŠ¡å™¨è®¿é—®çš„æ–‡ä»¶
                    const knownFiles = ['AIå¯¼å¸ˆè€ƒé¢˜_æ•°æ®è¡¨_è¡¨æ ¼.csv'];
                    const availableFiles = [];
                    
                    for (const fileName of knownFiles) {
                        try {
                            // ä½¿ç”¨HEADè¯·æ±‚æ£€æµ‹æ–‡ä»¶æ˜¯å¦å­˜åœ¨
                            const response = await fetch(fileName, { method: 'HEAD' });
                            if (response.ok) {
                                availableFiles.push(fileName);
                            }
                        } catch (error) {
                            console.log(`æ–‡ä»¶ ${fileName} ä¸å¯è®¿é—®:`, error.message);
                        }
                    }
                    
                    fileList.innerHTML = '';
                    
                    if (availableFiles.length === 0) {
                        fileList.innerHTML = `
                            <div class="no-files-message">
                                <p>âš ï¸ æœªæ£€æµ‹åˆ°å¯è®¿é—®çš„CSVæ–‡ä»¶</p>
                                <p style="font-size: 12px; color: #666; margin-top: 8px;">
                                    æç¤ºï¼šè¯·ç¡®ä¿é€šè¿‡HTTPæœåŠ¡å™¨è®¿é—®æ­¤é¡µé¢ï¼Œæˆ–ä½¿ç”¨ä¸‹æ–¹çš„æ‰‹åŠ¨ä¸Šä¼ åŠŸèƒ½
                                </p>
                            </div>
                        `;
                        return;
                    }
                    
                    availableFiles.forEach(fileName => {
                        const fileItem = document.createElement('div');
                        fileItem.className = 'file-item';
                        fileItem.innerHTML = `
                            <span class="file-name">ğŸ“„ ${fileName}</span>
                            <span class="file-size">âœ… å¯ç”¨</span>
                        `;
                        
                        fileItem.addEventListener('click', () => {
                            this.selectDetectedFile(fileName, fileItem);
                        });
                        
                        fileList.appendChild(fileItem);
                    });
                    
                } catch (error) {
                    console.error('æ£€æµ‹CSVæ–‡ä»¶å¤±è´¥:', error);
                    document.getElementById('fileList').innerHTML = `
                        <div class="no-files-message">
                            <p>âŒ æ£€æµ‹æ–‡ä»¶æ—¶å‡ºé”™</p>
                            <p style="font-size: 12px; color: #666; margin-top: 8px;">
                                è¯·ä½¿ç”¨ä¸‹æ–¹çš„æ‰‹åŠ¨ä¸Šä¼ åŠŸèƒ½
                            </p>
                        </div>
                    `;
                }
            }
            
            selectDetectedFile(fileName, fileElement) {
                // æ¸…é™¤ä¹‹å‰çš„é€‰ä¸­çŠ¶æ€
                document.querySelectorAll('.file-item').forEach(item => {
                    item.classList.remove('selected');
                });
                
                // è®¾ç½®å½“å‰é€‰ä¸­çŠ¶æ€
                fileElement.classList.add('selected');
                this.selectedFile = fileName;
                
                // æ¸…é™¤æ‰‹åŠ¨ä¸Šä¼ çš„æ–‡ä»¶é€‰æ‹©
                document.getElementById('csvFile').value = '';
                
                // æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯å¹¶å¯ç”¨è§£ææŒ‰é’®
                const fileInfo = document.getElementById('file-info');
                fileInfo.querySelector('p').textContent = `å·²é€‰æ‹©æ–‡ä»¶: ${fileName}`;
                fileInfo.classList.remove('hidden');
                document.getElementById('parseBtn').disabled = false;
            }

            handleFileSelect(event) {
                const file = event.target.files[0];
                if (file) {
                    // æ¸…é™¤æ£€æµ‹æ–‡ä»¶çš„é€‰ä¸­çŠ¶æ€
                    document.querySelectorAll('.file-item').forEach(item => {
                        item.classList.remove('selected');
                    });
                    this.selectedFile = null;
                    
                    document.getElementById('file-info').classList.remove('hidden');
                    document.getElementById('file-info').querySelector('p').textContent = 'æ–‡ä»¶å·²é€‰æ‹©ï¼Œç‚¹å‡»ä¸‹æ–¹æŒ‰é’®è§£æé¢˜åº“';
                    document.getElementById('parseBtn').disabled = false;
                }
            }

            async parseCSV() {
                const fileInput = document.getElementById('csvFile');
                const uploadedFile = fileInput.files[0];
                
                if (uploadedFile) {
                    // å¤„ç†æ‰‹åŠ¨ä¸Šä¼ çš„æ–‡ä»¶
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const csv = e.target.result;
                        this.processCSVData(csv);
                    };
                    reader.readAsText(uploadedFile, 'UTF-8');
                } else if (this.selectedFile) {
                    // å¤„ç†æ£€æµ‹åˆ°çš„æ–‡ä»¶
                    try {
                        const response = await fetch(this.selectedFile);
                        if (!response.ok) {
                            throw new Error(`æ— æ³•åŠ è½½æ–‡ä»¶: ${response.status}`);
                        }
                        const csv = await response.text();
                        this.processCSVData(csv);
                    } catch (error) {
                        console.error('åŠ è½½CSVæ–‡ä»¶å¤±è´¥:', error);
                        alert(`åŠ è½½æ–‡ä»¶å¤±è´¥: ${error.message}`);
                    }
                } else {
                    alert('è¯·å…ˆé€‰æ‹©CSVæ–‡ä»¶');
                }
            }

            processCSVData(csv) {
                const lines = csv.split('\n').filter(line => line.trim());
                this.questions = [];
                this.allQuestions = []; // é‡ç½®å®Œæ•´é¢˜ç›®åˆ—è¡¨

                // è·³è¿‡æ ‡é¢˜è¡Œ
                for (let i = 1; i < lines.length; i++) {
                    const columns = this.parseCSVLine(lines[i]);
                    if (columns.length >= 6) {
                        const question = {
                            id: columns[0].trim(),
                            type: columns[1].trim(),
                            question: columns[2].trim(),
                            options: columns[3].trim(),
                            answer: columns[4].trim(),
                            explanation: columns[5].trim()
                        };
                        this.questions.push(question);
                        this.allQuestions.push(question); // åŒæ—¶ä¿å­˜åˆ°å®Œæ•´åˆ—è¡¨
                    }
                }

                this.displayLibraryInfo();
            }

            parseCSVLine(line) {
                const result = [];
                let current = '';
                let inQuotes = false;
                
                for (let i = 0; i < line.length; i++) {
                    const char = line[i];
                    
                    if (char === '"') {
                        inQuotes = !inQuotes;
                    } else if (char === ',' && !inQuotes) {
                        result.push(current);
                        current = '';
                    } else {
                        current += char;
                    }
                }
                
                result.push(current);
                return result;
            }

            displayLibraryInfo() {
                const stats = {
                    total: this.allQuestions.length,
                    single: this.allQuestions.filter(q => q.type === 'å•é€‰é¢˜').length,
                    multi: this.allQuestions.filter(q => q.type === 'å¤šé€‰é¢˜').length,
                    trueOrFalse: this.allQuestions.filter(q => q.type === 'åˆ¤æ–­é¢˜').length,
                    essay: this.allQuestions.filter(q => q.type === 'é—®ç­”é¢˜').length
                };

                // è®¡ç®—å·²ç­”é¢˜ç›®å’Œå‰©ä½™é¢˜ç›®
                const answeredCount = this.answeredQuestions.size;
                const remainingCount = stats.total - answeredCount;
                
                document.getElementById('totalQuestions').textContent = stats.total;
                document.getElementById('singleChoice').textContent = stats.single;
                document.getElementById('multiChoice').textContent = stats.multi;
                document.getElementById('trueOrFalse').textContent = stats.trueOrFalse;
                document.getElementById('essay').textContent = stats.essay;
                
                // æ˜¾ç¤ºç­”é¢˜è¿›åº¦ä¿¡æ¯
                const progressInfo = document.createElement('div');
                progressInfo.className = 'progress-info';
                progressInfo.style.marginTop = '20px';
                progressInfo.style.padding = '15px';
                progressInfo.style.backgroundColor = '#f8f9fa';
                progressInfo.style.borderRadius = '8px';
                progressInfo.style.border = '1px solid #dee2e6';
                
                if (answeredCount > 0) {
                    progressInfo.innerHTML = `
                        <h4 style="margin: 0 0 10px 0; color: #495057;">ğŸ“Š ç­”é¢˜è¿›åº¦</h4>
                        <p style="margin: 5px 0; color: #28a745;">âœ… å·²ç­”é¢˜ç›®ï¼š${answeredCount} é¢˜</p>
                        <p style="margin: 5px 0; color: #007bff;">ğŸ“ å‰©ä½™é¢˜ç›®ï¼š${remainingCount} é¢˜</p>
                        <p style="margin: 5px 0; color: #6c757d;">ğŸ“ˆ å®Œæˆè¿›åº¦ï¼š${Math.round((answeredCount / stats.total) * 100)}%</p>
                    `;
                } else {
                    progressInfo.innerHTML = `
                        <h4 style="margin: 0 0 10px 0; color: #495057;">ğŸš€ å¼€å§‹ç­”é¢˜</h4>
                        <p style="margin: 5px 0; color: #007bff;">å…±æœ‰ ${stats.total} é“é¢˜ç›®ç­‰å¾…æ‚¨æ¥æŒ‘æˆ˜ï¼</p>
                    `;
                }
                
                // ç§»é™¤ä¹‹å‰çš„è¿›åº¦ä¿¡æ¯ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
                const existingProgress = document.querySelector('.progress-info');
                if (existingProgress) {
                    existingProgress.remove();
                }
                
                // åœ¨å¼€å§‹è€ƒè¯•æŒ‰é’®å‰æ’å…¥è¿›åº¦ä¿¡æ¯
                const startBtn = document.getElementById('startExam');
                startBtn.parentNode.insertBefore(progressInfo, startBtn);
                
                // æ›´æ–°è€ƒè¯•è®¾ç½®åŒºåŸŸçš„å¯ç”¨é¢˜ç›®æ•°é‡
                this.updateAvailableQuestions();
                
                // ä¿®æ”¹å¼€å§‹è€ƒè¯•æŒ‰é’®æ–‡æœ¬
                startBtn.textContent = 'âš™ï¸ è€ƒè¯•è®¾ç½®';

                document.getElementById('import-section').classList.add('hidden');
                document.getElementById('library-section').classList.remove('hidden');
            }
            
            showExamSettings() {
                if (this.allQuestions.length === 0) {
                    alert('è¯·å…ˆå¯¼å…¥é¢˜åº“');
                    return;
                }
                
                // æ˜¾ç¤ºè€ƒè¯•è®¾ç½®åŒºåŸŸ
                document.getElementById('exam-settings').style.display = 'block';
                
                // æ›´æ–°å¯ç”¨é¢˜ç›®æ•°é‡
                this.updateAvailableQuestions();
            }
            
            hideExamSettings() {
                document.getElementById('exam-settings').style.display = 'none';
            }
            
            updateAvailableQuestions() {
                // è®¡ç®—å„é¢˜å‹çš„å¯ç”¨é¢˜ç›®æ•°é‡ï¼ˆæ’é™¤å·²ç­”é¢˜ç›®ï¼‰
                const availableQuestions = this.allQuestions.filter(q => !this.answeredQuestions.has(q.id));
                
                const availableStats = {
                    single: availableQuestions.filter(q => q.type === 'å•é€‰é¢˜').length,
                    multi: availableQuestions.filter(q => q.type === 'å¤šé€‰é¢˜').length,
                    trueOrFalse: availableQuestions.filter(q => q.type === 'åˆ¤æ–­é¢˜').length,
                    essay: availableQuestions.filter(q => q.type === 'é—®ç­”é¢˜').length
                };
                
                // æ›´æ–°å¯ç”¨é¢˜ç›®æ•°é‡æ˜¾ç¤º
                document.getElementById('singleAvailable').textContent = `(${availableStats.single}é¢˜)`;
                document.getElementById('multiAvailable').textContent = `(${availableStats.multi}é¢˜)`;
                document.getElementById('trueOrFalseAvailable').textContent = `(${availableStats.trueOrFalse}é¢˜)`;
                document.getElementById('essayAvailable').textContent = `(${availableStats.essay}é¢˜)`;
                
                // æ›´æ–°å„é¢˜å‹çš„æœ€å¤§æ•°é‡æç¤º
                document.getElementById('singleMaxHint').textContent = `æœ€å¤š ${availableStats.single} é¢˜`;
                document.getElementById('multiMaxHint').textContent = `æœ€å¤š ${availableStats.multi} é¢˜`;
                document.getElementById('trueOrFalseMaxHint').textContent = `æœ€å¤š ${availableStats.trueOrFalse} é¢˜`;
                document.getElementById('essayMaxHint').textContent = `æœ€å¤š ${availableStats.essay} é¢˜`;
                
                // è®¾ç½®å„é¢˜å‹è¾“å…¥æ¡†çš„æœ€å¤§å€¼
                document.getElementById('singleCount').max = availableStats.single;
                document.getElementById('multiCount').max = availableStats.multi;
                document.getElementById('trueOrFalseCount').max = availableStats.trueOrFalse;
                document.getElementById('essayCount').max = availableStats.essay;
                
                // éªŒè¯å¹¶è°ƒæ•´å½“å‰è¾“å…¥å€¼
                this.validateAndAdjustCounts(availableStats);
                
                // æ›´æ–°æ€»é¢˜ç›®æ•°
                this.updateTotalCount();
            }
            
            validateAndAdjustCounts(availableStats) {
                // éªŒè¯å¹¶è°ƒæ•´å„é¢˜å‹çš„è¾“å…¥å€¼
                const singleInput = document.getElementById('singleCount');
                const multiInput = document.getElementById('multiCount');
                const trueOrFalseInput = document.getElementById('trueOrFalseCount');
                const essayInput = document.getElementById('essayCount');
                
                // è°ƒæ•´è¶…å‡ºæœ€å¤§å€¼çš„è¾“å…¥
                if (parseInt(singleInput.value) > availableStats.single) {
                    singleInput.value = availableStats.single;
                }
                if (parseInt(multiInput.value) > availableStats.multi) {
                    multiInput.value = availableStats.multi;
                }
                if (parseInt(trueOrFalseInput.value) > availableStats.trueOrFalse) {
                    trueOrFalseInput.value = availableStats.trueOrFalse;
                }
                if (parseInt(essayInput.value) > availableStats.essay) {
                    essayInput.value = availableStats.essay;
                }
            }
            
            updateTotalCount() {
                const singleCount = parseInt(document.getElementById('singleCount').value) || 0;
                const multiCount = parseInt(document.getElementById('multiCount').value) || 0;
                const trueOrFalseCount = parseInt(document.getElementById('trueOrFalseCount').value) || 0;
                const essayCount = parseInt(document.getElementById('essayCount').value) || 0;
                
                const totalCount = singleCount + multiCount + trueOrFalseCount + essayCount;
                document.getElementById('totalQuestionCount').textContent = totalCount;
                
                // æ§åˆ¶ç¡®è®¤æŒ‰é’®çŠ¶æ€
                const confirmBtn = document.getElementById('confirmSettings');
                confirmBtn.disabled = totalCount === 0;
            }
            
            toggleTimeInput() {
                const hasTimeLimit = document.getElementById('hasTimeLimit').checked;
                const timeInputGroup = document.getElementById('timeInputGroup');
                
                if (hasTimeLimit) {
                    timeInputGroup.style.display = 'flex';
                } else {
                    timeInputGroup.style.display = 'none';
                }
            }
            
            startExamWithSettings() {
                const singleCount = parseInt(document.getElementById('singleCount').value) || 0;
                const multiCount = parseInt(document.getElementById('multiCount').value) || 0;
                const trueOrFalseCount = parseInt(document.getElementById('trueOrFalseCount').value) || 0;
                const essayCount = parseInt(document.getElementById('essayCount').value) || 0;
                
                const totalCount = singleCount + multiCount + trueOrFalseCount + essayCount;
                
                if (totalCount === 0) {
                    alert('è¯·è‡³å°‘è®¾ç½®ä¸€ç§é¢˜å‹çš„æ•°é‡ï¼');
                    return;
                }
                
                // æŒ‰é¢˜å‹åˆ†åˆ«è·å–å¯ç”¨é¢˜ç›®
                const availableByType = {
                    'å•é€‰é¢˜': this.allQuestions.filter(q => q.type === 'å•é€‰é¢˜' && !this.answeredQuestions.has(q.id)),
                    'å¤šé€‰é¢˜': this.allQuestions.filter(q => q.type === 'å¤šé€‰é¢˜' && !this.answeredQuestions.has(q.id)),
                    'åˆ¤æ–­é¢˜': this.allQuestions.filter(q => q.type === 'åˆ¤æ–­é¢˜' && !this.answeredQuestions.has(q.id)),
                    'é—®ç­”é¢˜': this.allQuestions.filter(q => q.type === 'é—®ç­”é¢˜' && !this.answeredQuestions.has(q.id))
                };
                
                // éªŒè¯å„é¢˜å‹çš„å¯ç”¨æ•°é‡
                if (singleCount > availableByType['å•é€‰é¢˜'].length) {
                    alert(`å•é€‰é¢˜æ•°é‡ä¸è¶³ï¼æœ€å¤šåªæœ‰ ${availableByType['å•é€‰é¢˜'].length} é¢˜å¯ç”¨`);
                    return;
                }
                if (multiCount > availableByType['å¤šé€‰é¢˜'].length) {
                    alert(`å¤šé€‰é¢˜æ•°é‡ä¸è¶³ï¼æœ€å¤šåªæœ‰ ${availableByType['å¤šé€‰é¢˜'].length} é¢˜å¯ç”¨`);
                    return;
                }
                if (trueOrFalseCount > availableByType['åˆ¤æ–­é¢˜'].length) {
                    alert(`åˆ¤æ–­é¢˜æ•°é‡ä¸è¶³ï¼æœ€å¤šåªæœ‰ ${availableByType['åˆ¤æ–­é¢˜'].length} é¢˜å¯ç”¨`);
                    return;
                }
                if (essayCount > availableByType['é—®ç­”é¢˜'].length) {
                    alert(`é—®ç­”é¢˜æ•°é‡ä¸è¶³ï¼æœ€å¤šåªæœ‰ ${availableByType['é—®ç­”é¢˜'].length} é¢˜å¯ç”¨`);
                    return;
                }
                
                // æŒ‰æŒ‡å®šæ•°é‡é€‰æ‹©å„é¢˜å‹çš„é¢˜ç›®
                this.questions = [];
                
                if (singleCount > 0) {
                    this.shuffleArray(availableByType['å•é€‰é¢˜']);
                    this.questions.push(...availableByType['å•é€‰é¢˜'].slice(0, singleCount));
                }
                if (multiCount > 0) {
                    this.shuffleArray(availableByType['å¤šé€‰é¢˜']);
                    this.questions.push(...availableByType['å¤šé€‰é¢˜'].slice(0, multiCount));
                }
                if (trueOrFalseCount > 0) {
                    this.shuffleArray(availableByType['åˆ¤æ–­é¢˜']);
                    this.questions.push(...availableByType['åˆ¤æ–­é¢˜'].slice(0, trueOrFalseCount));
                }
                if (essayCount > 0) {
                    this.shuffleArray(availableByType['é—®ç­”é¢˜']);
                    this.questions.push(...availableByType['é—®ç­”é¢˜'].slice(0, essayCount));
                }
                
                // æ‰“ä¹±æœ€ç»ˆé¢˜ç›®é¡ºåº
                this.shuffleArray(this.questions);
                
                // è®¡ç®—åˆ†æ•°åˆ†é…ï¼ˆé—®ç­”é¢˜ä¸è®¡åˆ†ï¼‰
                const scoredQuestions = this.questions.filter(q => q.type !== 'é—®ç­”é¢˜');
                const scorePerQuestion = scoredQuestions.length > 0 ? Math.round(100 / scoredQuestions.length) : 0;
                
                // ä¸ºæ¯é“é¢˜åˆ†é…åˆ†æ•°
                this.questions.forEach(q => {
                    q.score = q.type === 'é—®ç­”é¢˜' ? 0 : scorePerQuestion;
                });
                
                // è°ƒæ•´æœ€åä¸€é¢˜çš„åˆ†æ•°ï¼Œç¡®ä¿æ€»åˆ†ä¸º100
                if (scoredQuestions.length > 0) {
                    const totalAssigned = scorePerQuestion * scoredQuestions.length;
                    const lastScoredQuestion = scoredQuestions[scoredQuestions.length - 1];
                    lastScoredQuestion.score += (100 - totalAssigned);
                }
                
                this.currentQuestionIndex = 0;
                this.userAnswers = new Array(this.questions.length).fill(null);
                this.examStarted = true;
                
                // å¤„ç†æ—¶é—´è®¾ç½®
                this.isTimeLimited = document.getElementById('hasTimeLimit').checked;
                if (this.isTimeLimited) {
                    this.examTimeLimit = parseInt(document.getElementById('examTimeLimit').value) || 60;
                }
                
                // éšè—è®¾ç½®åŒºåŸŸï¼Œæ˜¾ç¤ºè€ƒè¯•åŒºåŸŸ
                this.hideExamSettings();
                document.getElementById('library-section').classList.add('hidden');
                document.getElementById('exam-section').classList.remove('hidden');
                
                // å¼€å§‹è®¡æ—¶
                this.startTimer();
                
                this.displayQuestion();
                this.updateQuestionStatus();
            }

            startExam() {
                if (this.allQuestions.length === 0) {
                    alert('è¯·å…ˆå¯¼å…¥é¢˜åº“');
                    return;
                }

                // è¿‡æ»¤æ‰å·²ç»å›ç­”è¿‡çš„é¢˜ç›®
                const availableQuestions = this.allQuestions.filter(question => 
                    !this.answeredQuestions.has(question.id)
                );
                
                if (availableQuestions.length === 0) {
                    alert('æ‰€æœ‰é¢˜ç›®éƒ½å·²ç»ç­”è¿‡äº†ï¼è¯·ç‚¹å‡»"é‡æ–°å¼€å§‹"æ¥é‡ç½®ç­”é¢˜è®°å½•ã€‚');
                    return;
                }
                
                // ä½¿ç”¨è¿‡æ»¤åçš„é¢˜ç›®
                this.questions = [...availableQuestions]; // åˆ›å»ºå‰¯æœ¬ï¼Œé¿å…ä¿®æ”¹åŸæ•°ç»„
                
                // æ‰“ä¹±é¢˜ç›®é¡ºåº
                this.shuffleArray(this.questions);
                this.currentQuestionIndex = 0;
                this.userAnswers = new Array(this.questions.length).fill(null);
                this.examStarted = true;

                document.getElementById('library-section').classList.add('hidden');
                document.getElementById('exam-section').classList.remove('hidden');

                this.displayQuestion();
                this.updateQuestionStatus();
            }

            shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
            }

            displayQuestion() {
                const question = this.questions[this.currentQuestionIndex];
                const questionNumber = this.currentQuestionIndex + 1;
                const totalQuestions = this.questions.length;

                document.getElementById('questionNumber').textContent = `ç¬¬ ${questionNumber} é¢˜`;
                
                // æ˜¾ç¤ºé¢˜ç›®ç±»å‹å’Œåˆ†æ•°
                const typeText = question.score !== undefined ? 
                    `${question.type} (${question.score}åˆ†)` : question.type;
                document.getElementById('questionType').textContent = typeText;
                
                document.getElementById('questionText').textContent = question.question;
                document.getElementById('questionProgress').textContent = `${questionNumber} / ${totalQuestions}`;
                document.getElementById('totalCount').textContent = `æ€»é¢˜æ•°: ${totalQuestions}`;

                // æ›´æ–°è¿›åº¦æ¡
                const progress = (questionNumber / totalQuestions) * 100;
                document.getElementById('progressBar').style.width = `${progress}%`;

                // æ˜¾ç¤ºé€‰é¡¹æˆ–è¾“å…¥æ¡†
                this.displayOptions(question);

                // æ›´æ–°ç­”é¢˜çŠ¶æ€
                this.updateQuestionStatus();

                // æ›´æ–°å¯¼èˆªæŒ‰é’®
                document.getElementById('prevBtn').disabled = this.currentQuestionIndex === 0;
                document.getElementById('nextBtn').classList.toggle('hidden', questionNumber === totalQuestions);
                document.getElementById('submitBtn').classList.toggle('hidden', questionNumber !== totalQuestions);
            }

            displayOptions(question) {
                const container = document.getElementById('optionsContainer');
                container.innerHTML = '';

                if (question.type === 'å•é€‰é¢˜' || question.type === 'å¤šé€‰é¢˜') {
                    // æ˜¾ç¤ºé€‰é¡¹ä¾›å‚è€ƒ
                    const options = question.options.split('|').filter(opt => opt.trim());
                    const optionsDisplay = document.createElement('div');
                    optionsDisplay.className = 'options-display';
                    optionsDisplay.innerHTML = '<h4>é€‰é¡¹ï¼š</h4>';
                    
                    options.forEach((option, index) => {
                        const optionText = document.createElement('div');
                        optionText.className = 'option-text';
                        // å»æ‰é€‰é¡¹ä¸­åŸæœ‰çš„A.ã€B.ç­‰å‰ç¼€
                        let cleanOption = option.trim().replace(/^[A-Z]\. /, '');
                        // ä¸ºBã€Cã€Dç­‰é€‰é¡¹å‰æ·»åŠ æ¢è¡Œç¬¦ï¼ˆå¦‚æœé€‰é¡¹æ–‡æœ¬ä¸­åŒ…å«åˆ†å·åˆ†éš”çš„å¤šä¸ªé€‰é¡¹ï¼‰
                        if (cleanOption.includes('; ')) {
                            cleanOption = cleanOption.replace(/; ([B-Z]\. )/g, '; \n $1');
                        }
                        optionText.innerHTML = `${String.fromCharCode(65 + index)}. ${cleanOption.replace(/\n/g, '<br>')}`;
                        optionsDisplay.appendChild(optionText);
                    });
                    
                    container.appendChild(optionsDisplay);
                    
                    // åˆ›å»ºç­”æ¡ˆè¾“å…¥æ¡†
                    const answerDiv = document.createElement('div');
                    answerDiv.className = 'answer-input-container';
                    
                    const label = document.createElement('label');
                    label.textContent = question.type === 'å•é€‰é¢˜' ? 'è¯·è¾“å…¥ç­”æ¡ˆï¼ˆå¦‚ï¼šAï¼‰ï¼š' : 'è¯·è¾“å…¥ç­”æ¡ˆï¼ˆå¦‚ï¼šABCï¼‰ï¼š';
                    label.className = 'answer-label';
                    
                    const input = document.createElement('input');
                    input.type = 'text';
                    input.className = 'answer-input';
                    input.placeholder = question.type === 'å•é€‰é¢˜' ? 'è¯·è¾“å…¥Aã€Bã€Cã€Dä¸­çš„ä¸€ä¸ª' : 'è¯·è¾“å…¥Aã€Bã€Cã€Dçš„ç»„åˆï¼Œå¦‚ï¼šABC';
                    input.value = this.userAnswers[this.currentQuestionIndex] || '';
                    input.maxLength = question.type === 'å•é€‰é¢˜' ? 1 : 4;
                    
                    // æ·»åŠ è¾“å…¥äº‹ä»¶
                    input.addEventListener('input', () => {
                        let value = input.value.toUpperCase().replace(/[^ABCD]/g, '');
                        
                        if (question.type === 'å•é€‰é¢˜') {
                            // å•é€‰é¢˜åªå…è®¸ä¸€ä¸ªå­—æ¯ï¼Œä¸”å¿…é¡»æ˜¯ABCDä¸­çš„ä¸€ä¸ª
                            value = value.slice(0, 1);
                            if (value && !'ABCD'.includes(value)) {
                                value = '';
                            }
                        } else {
                            // å¤šé€‰é¢˜å»é‡å¹¶æ’åºï¼Œåªå…è®¸ABCD
                            value = [...new Set(value.split(''))].filter(char => 'ABCD'.includes(char)).sort().join('');
                        }
                        
                        input.value = value;
                        this.userAnswers[this.currentQuestionIndex] = value;
                        
                        // æ˜¾ç¤ºæˆ–éšè—ç¡®å®šæŒ‰é’®
                        const confirmBtn = container.querySelector('.confirm-answer-btn');
                        if (value.trim() && !this.answeredQuestions.has(this.currentQuestionIndex)) {
                            confirmBtn.style.display = 'inline-block';
                        } else {
                            confirmBtn.style.display = 'none';
                        }
                    });
                    
                    answerDiv.appendChild(label);
                    answerDiv.appendChild(input);
                    
                    // æ·»åŠ ç¡®å®šæŒ‰é’®
                    const confirmBtn = document.createElement('button');
                    confirmBtn.className = 'btn btn-primary confirm-answer-btn';
                    confirmBtn.textContent = 'âœ“ ç¡®å®š';
                    confirmBtn.style.display = 'none';
                    confirmBtn.style.marginLeft = '10px';
                    
                    confirmBtn.addEventListener('click', () => {
                        this.confirmAnswer(this.currentQuestionIndex, input.value);
                    });
                    
                    answerDiv.appendChild(confirmBtn);
                    
                    // å¦‚æœå·²ç»å›ç­”è¿‡ï¼Œæ˜¾ç¤ºç»“æœ
                    if (this.answeredQuestions.has(this.currentQuestionIndex)) {
                        this.showAnswerResult(this.currentQuestionIndex, container);
                        input.disabled = true;
                        confirmBtn.style.display = 'none';
                    } else if (input.value.trim()) {
                        confirmBtn.style.display = 'inline-block';
                    }
                    
                    container.appendChild(answerDiv);
                } else if (question.type === 'åˆ¤æ–­é¢˜') {
                    const trueOption = this.createJudgeOption('æ­£ç¡®', 'æ­£ç¡®');
                    const falseOption = this.createJudgeOption('é”™è¯¯', 'é”™è¯¯');
                    
                    const savedAnswer = this.userAnswers[this.currentQuestionIndex];
                    if (savedAnswer === 'æ­£ç¡®') {
                        trueOption.classList.add('selected');
                        trueOption.querySelector('input').checked = true;
                    } else if (savedAnswer === 'é”™è¯¯') {
                        falseOption.classList.add('selected');
                        falseOption.querySelector('input').checked = true;
                    }
                    
                    container.appendChild(trueOption);
                    container.appendChild(falseOption);
                    
                    // æ·»åŠ ç¡®å®šæŒ‰é’®
                    const confirmBtnDiv = document.createElement('div');
                    confirmBtnDiv.className = 'confirm-btn-container';
                    confirmBtnDiv.style.marginTop = '15px';
                    
                    const confirmBtn = document.createElement('button');
                    confirmBtn.className = 'btn btn-primary confirm-answer-btn';
                    confirmBtn.textContent = 'âœ“ ç¡®å®š';
                    confirmBtn.style.display = savedAnswer ? 'inline-block' : 'none';
                    
                    confirmBtn.addEventListener('click', () => {
                        const selectedValue = this.userAnswers[this.currentQuestionIndex];
                        if (selectedValue) {
                            this.confirmAnswer(this.currentQuestionIndex, selectedValue);
                        }
                    });
                    
                    confirmBtnDiv.appendChild(confirmBtn);
                    container.appendChild(confirmBtnDiv);
                    
                    // å¦‚æœå·²ç»å›ç­”è¿‡ï¼Œæ˜¾ç¤ºç»“æœå¹¶ç¦ç”¨é€‰é¡¹
                    if (this.answeredQuestions.has(this.currentQuestionIndex)) {
                        this.showAnswerResult(this.currentQuestionIndex, container);
                        trueOption.style.pointerEvents = 'none';
                        falseOption.style.pointerEvents = 'none';
                        confirmBtn.style.display = 'none';
                    }
                } else if (question.type === 'é—®ç­”é¢˜') {
                    const textarea = document.createElement('textarea');
                    textarea.className = 'textarea-answer';
                    textarea.placeholder = 'è¯·è¾“å…¥æ‚¨çš„ç­”æ¡ˆ...';
                    textarea.value = this.userAnswers[this.currentQuestionIndex] || '';
                    
                    let saveTimeout;
                    textarea.addEventListener('input', () => {
                        this.userAnswers[this.currentQuestionIndex] = textarea.value;
                        // é˜²æŠ–ä¿å­˜æç¤º
                        clearTimeout(saveTimeout);
                        saveTimeout = setTimeout(() => {
                            if (textarea.value.trim()) {
                                this.showAnswerSaved();
                            }
                        }, 1000);
                    });
                    
                    container.appendChild(textarea);
                }
            }

            createJudgeOption(text, value) {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option';
                
                const input = document.createElement('input');
                input.type = 'radio';
                input.name = 'judge';
                input.value = value;
                
                const label = document.createElement('label');
                label.textContent = text;
                
                optionDiv.appendChild(input);
                optionDiv.appendChild(label);
                
                optionDiv.addEventListener('click', () => {
                    // å¦‚æœå·²ç»å›ç­”è¿‡ï¼Œä¸å…è®¸å†æ¬¡é€‰æ‹©
                    if (this.answeredQuestions.has(this.currentQuestionIndex)) {
                        return;
                    }
                    
                    document.querySelectorAll('.option').forEach(opt => opt.classList.remove('selected'));
                    optionDiv.classList.add('selected');
                    input.checked = true;
                    this.userAnswers[this.currentQuestionIndex] = value;
                    
                    // æ˜¾ç¤ºç¡®å®šæŒ‰é’®
                    const confirmBtn = document.querySelector('.confirm-answer-btn');
                    if (confirmBtn) {
                        confirmBtn.style.display = 'inline-block';
                    }
                });
                
                return optionDiv;
            }



            previousQuestion() {
                if (this.currentQuestionIndex > 0) {
                    this.currentQuestionIndex--;
                    this.displayQuestion();
                }
            }

            nextQuestion() {
                if (this.currentQuestionIndex < this.questions.length - 1) {
                    this.currentQuestionIndex++;
                    this.displayQuestion();
                }
            }

            submitExam(autoSubmit = false) {
                if (autoSubmit === true) {
                    // è‡ªåŠ¨äº¤å·ï¼Œåœæ­¢è®¡æ—¶å™¨å¹¶ç›´æ¥è®¡ç®—ç»“æœ
                    this.stopTimer();
                    alert('è€ƒè¯•æ—¶é—´åˆ°ï¼ç³»ç»Ÿå°†è‡ªåŠ¨äº¤å·ã€‚');
                    this.calculateResults();
                    return;
                }
                
                // æ‰‹åŠ¨äº¤å·ï¼Œæ£€æŸ¥æœªç­”é¢˜ç›®
                const unansweredQuestions = [];
                this.questions.forEach((question, index) => {
                    const answer = this.userAnswers[index];
                    const hasAnswer = answer !== null && answer !== undefined && answer !== '';
                    if (!hasAnswer || (Array.isArray(answer) && answer.length === 0)) {
                        unansweredQuestions.push(index + 1);
                    }
                });
                
                let confirmMessage = 'ç¡®å®šè¦äº¤å·å—ï¼Ÿäº¤å·åå°†æ— æ³•ä¿®æ”¹ç­”æ¡ˆã€‚';
                if (unansweredQuestions.length > 0) {
                    confirmMessage = `è¿˜æœ‰ ${unansweredQuestions.length} é“é¢˜ç›®æœªä½œç­”ï¼ˆç¬¬ ${unansweredQuestions.join('ã€')} é¢˜ï¼‰ã€‚\n\nç¡®å®šè¦äº¤å·å—ï¼Ÿäº¤å·åå°†æ— æ³•ä¿®æ”¹ç­”æ¡ˆã€‚`;
                }
                
                if (confirm(confirmMessage)) {
                    // ç”¨æˆ·ç¡®è®¤äº¤å·ï¼Œåœæ­¢è®¡æ—¶å™¨å¹¶è®¡ç®—ç»“æœ
                    this.stopTimer();
                    this.calculateResults();
                }
                // å¦‚æœç”¨æˆ·å–æ¶ˆäº¤å·ï¼Œè®¡æ—¶å™¨ç»§ç»­è¿è¡Œï¼Œä¸åšä»»ä½•æ“ä½œ
            }

            calculateResults() {
                let correctCount = 0;
                const wrongQuestions = [];
                const essayQuestions = [];
                let answeredCount = 0;
                
                // å°†æœ¬æ¬¡è€ƒè¯•çš„æ‰€æœ‰é¢˜ç›®IDæ·»åŠ åˆ°å·²ç­”é¢˜ç›®é›†åˆä¸­
                this.questions.forEach(question => {
                    this.answeredQuestions.add(question.id);
                });
                
                // ç»Ÿè®¡éé—®ç­”é¢˜æ•°é‡ç”¨äºåˆ†æ•°è®¡ç®—
                const scoredQuestions = this.questions.filter(q => q.type !== 'é—®ç­”é¢˜');

                this.questions.forEach((question, index) => {
                    const userAnswer = this.userAnswers[index];
                    const correctAnswer = question.answer;
                    
                    // é—®ç­”é¢˜å•ç‹¬å¤„ç†ï¼Œä¸è®¡å…¥è€ƒè¯•ç»“æœ
                    if (question.type === 'é—®ç­”é¢˜') {
                        essayQuestions.push({ question, userAnswer: userAnswer || 'æœªä½œç­”', index: index + 1 });
                        return;
                    }
                    
                    // æ£€æŸ¥æ˜¯å¦å·²ç­”é¢˜
                    const hasAnswer = userAnswer !== null && userAnswer !== undefined && userAnswer !== '';
                    if (!hasAnswer) {
                        // æœªç­”é¢˜ï¼Œç›´æ¥åŠ å…¥é”™è¯¯é¢˜ç›®åˆ—è¡¨
                        wrongQuestions.push({ question, userAnswer: 'æœªä½œç­”', index: index + 1 });
                        return;
                    }
                    
                    answeredCount++;
                    let isCorrect = false;

                    if (question.type === 'å•é€‰é¢˜' || question.type === 'å¤šé€‰é¢˜') {
                        // æå–æ­£ç¡®ç­”æ¡ˆä¸­çš„å­—æ¯éƒ¨åˆ†
                        let correctLetters = '';
                        if (question.type === 'å•é€‰é¢˜') {
                            // å•é€‰é¢˜ï¼šæå–ç¬¬ä¸€ä¸ªå­—æ¯
                            const match = correctAnswer.match(/^([A-D])/);
                            correctLetters = match ? match[1] : '';
                        } else {
                            // å¤šé€‰é¢˜ï¼šæ”¯æŒä¸¤ç§æ ¼å¼
                            if (/^[A-D]+$/.test(correctAnswer.trim())) {
                                // æ ¼å¼1ï¼šç›´æ¥æ˜¯å­—æ¯ç»„åˆ
                                correctLetters = correctAnswer.trim().split('').sort().join('');
                            } else {
                                // æ ¼å¼2ï¼šæå–æ‰€æœ‰å­—æ¯å¹¶æ’åº
                                const matches = correctAnswer.match(/([A-D])\./g);
                                if (matches) {
                                    correctLetters = matches.map(m => m.charAt(0)).sort().join('');
                                }
                            }
                        }
                        
                        // æ¯”è¾ƒå­—æ¯ç­”æ¡ˆ
                        if (question.type === 'å¤šé€‰é¢˜') {
                            const userLetters = userAnswer ? userAnswer.split('').sort().join('') : '';
                            isCorrect = userLetters === correctLetters;
                            console.log(`å¤šé€‰é¢˜æ¯”è¾ƒ: ç”¨æˆ·ç­”æ¡ˆ="${userLetters}", æ­£ç¡®ç­”æ¡ˆ="${correctLetters}", åŒ¹é…=${isCorrect}`);
                        } else {
                            isCorrect = userAnswer === correctLetters;
                            console.log(`å•é€‰é¢˜æ¯”è¾ƒ: ç”¨æˆ·ç­”æ¡ˆ="${userAnswer}", æ­£ç¡®ç­”æ¡ˆ="${correctLetters}", åŒ¹é…=${isCorrect}`);
                        }
                    } else {
                        isCorrect = userAnswer === correctAnswer;
                    }

                    if (isCorrect) {
                        correctCount++;
                    } else {
                        wrongQuestions.push({ question, userAnswer, index: index + 1 });
                    }
                });

                // è®¡ç®—åˆ†æ•°ï¼šä½¿ç”¨é¢˜ç›®çš„åˆ†æ•°å±æ€§
                let totalScore = 0;
                this.questions.forEach((question, index) => {
                    if (question.type === 'é—®ç­”é¢˜') return; // é—®ç­”é¢˜ä¸è®¡åˆ†
                    
                    const userAnswer = this.userAnswers[index];
                    const hasAnswer = userAnswer !== null && userAnswer !== undefined && userAnswer !== '';
                    if (!hasAnswer) return; // æœªç­”é¢˜ä¸å¾—åˆ†
                    
                    let isCorrect = false;
                    const correctAnswer = question.answer;
                    
                    if (question.type === 'å•é€‰é¢˜' || question.type === 'å¤šé€‰é¢˜') {
                        let correctLetters = '';
                        if (question.type === 'å•é€‰é¢˜') {
                            const match = correctAnswer.match(/^([A-D])/);
                            correctLetters = match ? match[1] : '';
                        } else {
                            if (/^[A-D]+$/.test(correctAnswer.trim())) {
                                correctLetters = correctAnswer.trim().split('').sort().join('');
                            } else {
                                const matches = correctAnswer.match(/([A-D])\./g);
                                if (matches) {
                                    correctLetters = matches.map(m => m.charAt(0)).sort().join('');
                                }
                            }
                        }
                        
                        if (question.type === 'å¤šé€‰é¢˜') {
                            const userLetters = userAnswer ? userAnswer.split('').sort().join('') : '';
                            isCorrect = userLetters === correctLetters;
                        } else {
                            isCorrect = userAnswer === correctLetters;
                        }
                    } else {
                        isCorrect = userAnswer === correctAnswer;
                    }
                    
                    if (isCorrect && question.score !== undefined) {
                        totalScore += question.score;
                    }
                });
                
                // å¦‚æœæ²¡æœ‰è®¾ç½®åˆ†æ•°å±æ€§ï¼Œåˆ™ä½¿ç”¨åŸæ¥çš„å¹³å‡åˆ†é…æ–¹å¼
                if (totalScore === 0 && correctCount > 0 && scoredQuestions.length > 0) {
                    totalScore = parseFloat(((100 / scoredQuestions.length) * correctCount).toFixed(1));
                }
                
                console.log(`ç­”é¢˜ç»Ÿè®¡: è®¡åˆ†é¢˜ç›®${scoredQuestions.length}é¢˜ï¼Œå·²ç­”é¢˜${answeredCount}é¢˜ï¼Œæ­£ç¡®${correctCount}é¢˜ï¼Œæ€»åˆ†${totalScore}åˆ†`);
                console.log(`åˆ†æ•°è®¡ç®—: 100 / ${scoredQuestions.length} * ${correctCount} = ${totalScore}`);
                this.displayResults(correctCount, wrongQuestions, essayQuestions, totalScore, scoredQuestions.length);
            }

            displayResults(correctCount, wrongQuestions, essayQuestions, totalScore, scoredQuestionsCount) {
                const wrongCount = scoredQuestionsCount - correctCount;
                const accuracy = scoredQuestionsCount > 0 ? Math.round((correctCount / scoredQuestionsCount) * 100) : 0;

                document.getElementById('totalScore').textContent = totalScore;
                document.getElementById('correctCount').textContent = correctCount;
                document.getElementById('wrongCount').textContent = wrongCount;
                document.getElementById('accuracy').textContent = `${accuracy}%`;
                document.getElementById('examTime').textContent = this.getExamDuration();
                
                // è®¡ç®—æ­£ç¡®é¢˜ç›®
                const correctQuestions = [];
                const wrongQuestionIndexes = new Set(wrongQuestions.map(wq => wq.index - 1)); // è½¬æ¢ä¸º0åŸºç´¢å¼•
                
                this.questions.forEach((question, index) => {
                    if (!wrongQuestionIndexes.has(index) && this.userAnswers[index] !== null && this.userAnswers[index] !== undefined && this.userAnswers[index] !== '') {
                        // æ’é™¤é—®ç­”é¢˜ï¼Œå› ä¸ºé—®ç­”é¢˜ä¸å‚ä¸æ­£ç¡®/é”™è¯¯åˆ¤æ–­
                        if (question.type !== 'é—®ç­”é¢˜') {
                            correctQuestions.push({
                                question: question,
                                userAnswer: this.userAnswers[index],
                                index: index + 1
                            });
                        }
                    }
                });

                // æ˜¾ç¤ºé”™è¯¯é¢˜ç›®
                const wrongQuestionsContainer = document.getElementById('wrongQuestions');
                wrongQuestionsContainer.innerHTML = `
                    <div class="wrong-questions-header">
                        <h3>âŒ é”™è¯¯é¢˜ç›®å¤ä¹ </h3>
                        <button id="exportWrongBtn" class="btn btn-secondary" style="display: ${wrongQuestions.length > 0 ? 'block' : 'none'};">ğŸ“¥ å¯¼å‡ºé”™é¢˜</button>
                    </div>
                `;

                if (wrongQuestions.length === 0) {
                    wrongQuestionsContainer.innerHTML += '<p style="color: #4CAF50; font-weight: bold;">ğŸ‰ æ­å–œï¼å…¨éƒ¨ç­”å¯¹äº†ï¼</p>';
                } else {
                    // å­˜å‚¨é”™é¢˜æ•°æ®ä¾›å¯¼å‡ºä½¿ç”¨
                    this.wrongQuestionsData = wrongQuestions;
                    
                    wrongQuestions.forEach(({ question, userAnswer, index }) => {
                        const wrongDiv = document.createElement('div');
                        wrongDiv.className = 'wrong-question';
                        
                        let userAnswerText = userAnswer;
                        if (Array.isArray(userAnswer)) {
                            userAnswerText = userAnswer.join(', ');
                        }
                        if (!userAnswerText) {
                            userAnswerText = 'æœªä½œç­”';
                        }
                        
                        wrongDiv.innerHTML = `
                            <h4>ç¬¬${index}é¢˜ (${question.type})</h4>
                            <p><strong>é¢˜ç›®ï¼š</strong>${question.question}</p>
                            ${question.options ? `<p><strong>é€‰é¡¹ï¼š</strong>${question.options.replace(/\|/g, ' | ')}</p>` : ''}
                            <p><strong>æ‚¨çš„ç­”æ¡ˆï¼š</strong><span style="color: #f44336;">${userAnswerText}</span></p>
                            <p><strong>æ­£ç¡®ç­”æ¡ˆï¼š</strong><span style="color: #4CAF50;">${question.answer}</span></p>
                            <p><strong>ç­”æ¡ˆè¯´æ˜ï¼š</strong>${question.explanation}</p>
                        `;
                        
                        wrongQuestionsContainer.appendChild(wrongDiv);
                    });
                    
                    // é‡æ–°ç»‘å®šå¯¼å‡ºæŒ‰é’®äº‹ä»¶
                    document.getElementById('exportWrongBtn').addEventListener('click', this.exportWrongQuestions.bind(this));
                }
                
                // æ˜¾ç¤ºæ­£ç¡®é¢˜ç›®
                const correctQuestionsContainer = document.getElementById('correctQuestions');
                correctQuestionsContainer.innerHTML = `
                    <div class="correct-questions-header">
                        <h3>âœ… æ­£ç¡®é¢˜ç›®å±•ç¤º</h3>
                        <div class="export-buttons">
                            <button id="exportCorrectBtn" class="btn btn-secondary" style="display: ${correctQuestions.length > 0 ? 'block' : 'none'};">ğŸ“¥ å¯¼å‡ºæ­£ç¡®é¢˜ç›®</button>
                            <button id="exportAllBtn" class="btn btn-secondary" style="display: ${this.questions.length > 0 ? 'block' : 'none'};">ğŸ“¥ å¯¼å‡ºå…¨éƒ¨é¢˜ç›®</button>
                        </div>
                    </div>
                `;
                
                if (correctQuestions.length === 0) {
                    correctQuestionsContainer.innerHTML += '<p style="color: #ff9800; font-weight: bold;">ğŸ˜” æœ¬æ¬¡è€ƒè¯•æ²¡æœ‰ç­”å¯¹çš„é¢˜ç›®ï¼Œç»§ç»­åŠªåŠ›ï¼</p>';
                } else {
                    // å­˜å‚¨æ­£ç¡®é¢˜ç›®æ•°æ®ä¾›å¯¼å‡ºä½¿ç”¨
                    this.correctQuestionsData = correctQuestions;
                    
                    correctQuestions.forEach(({ question, userAnswer, index }) => {
                        const correctDiv = document.createElement('div');
                        correctDiv.className = 'correct-question';
                        
                        let userAnswerText = userAnswer;
                        if (Array.isArray(userAnswer)) {
                            userAnswerText = userAnswer.join(', ');
                        }
                        
                        correctDiv.innerHTML = `
                            <h4>ç¬¬${index}é¢˜ (${question.type})</h4>
                            <p><strong>é¢˜ç›®ï¼š</strong>${question.question}</p>
                            ${question.options ? `<p><strong>é€‰é¡¹ï¼š</strong>${question.options.replace(/\|/g, ' | ')}</p>` : ''}
                            <p><strong>æ‚¨çš„ç­”æ¡ˆï¼š</strong><span style="color: #4CAF50;">${userAnswerText}</span></p>
                            <p><strong>æ­£ç¡®ç­”æ¡ˆï¼š</strong><span style="color: #4CAF50;">${question.answer}</span></p>
                            <p><strong>ç­”æ¡ˆè¯´æ˜ï¼š</strong>${question.explanation}</p>
                        `;
                        
                        correctQuestionsContainer.appendChild(correctDiv);
                    });
                    
                    // é‡æ–°ç»‘å®šå¯¼å‡ºæŒ‰é’®äº‹ä»¶
                    document.getElementById('exportCorrectBtn').addEventListener('click', this.exportCorrectQuestions.bind(this));
                    document.getElementById('exportAllBtn').addEventListener('click', this.exportAllQuestions.bind(this));
                }

                // æ˜¾ç¤ºé—®ç­”é¢˜ç­”æ¡ˆå¯¹æ¯”
                const essayAnswersContainer = document.getElementById('essayAnswers');
                essayAnswersContainer.innerHTML = '<h3>ğŸ“ é—®ç­”é¢˜ç­”æ¡ˆå¯¹æ¯”</h3>';

                if (essayQuestions.length === 0) {
                    essayAnswersContainer.innerHTML += '<p style="color: #666;">æœ¬æ¬¡è€ƒè¯•æ²¡æœ‰é—®ç­”é¢˜ã€‚</p>';
                } else {
                    essayQuestions.forEach(({ question, userAnswer, index }) => {
                        const essayDiv = document.createElement('div');
                        essayDiv.className = 'essay-question';
                        
                        let userAnswerText = userAnswer || 'æœªä½œç­”';
                        
                        essayDiv.innerHTML = `
                            <h4>ç¬¬${index}é¢˜ (${question.type})</h4>
                            <p><strong>é¢˜ç›®ï¼š</strong>${question.question}</p>
                            <div class="essay-answer user-essay-answer">
                                <strong>æ‚¨çš„ç­”æ¡ˆï¼š</strong><br>${userAnswerText}
                            </div>
                            <div class="essay-answer correct-essay-answer">
                                <strong>å‚è€ƒç­”æ¡ˆï¼š</strong><br>${question.answer}
                            </div>
                        `;
                        
                        essayAnswersContainer.appendChild(essayDiv);
                    });
                }

                document.getElementById('exam-section').classList.add('hidden');
                document.getElementById('result-section').classList.remove('hidden');
            }



            updateQuestionStatus() {
                const statusContainer = document.getElementById('questionStatus');
                // ä¿å­˜å½“å‰æŠ˜å çŠ¶æ€
                const isCollapsed = statusContainer.classList.contains('collapsed');
                statusContainer.innerHTML = '';
                // æ¢å¤æŠ˜å çŠ¶æ€
                if (isCollapsed) {
                    statusContainer.classList.add('collapsed');
                }
                let answeredCount = 0;
                
                this.questions.forEach((_, index) => {
                    const statusItem = document.createElement('div');
                    statusItem.className = 'status-item';
                    statusItem.textContent = index + 1;
                    
                    // æ£€æŸ¥æ˜¯å¦å·²ç­”é¢˜
                    const hasAnswer = this.userAnswers[index] !== null && this.userAnswers[index] !== undefined && this.userAnswers[index] !== '';
                    if (hasAnswer) {
                        if (Array.isArray(this.userAnswers[index])) {
                            if (this.userAnswers[index].length > 0) {
                                statusItem.classList.add('answered');
                                answeredCount++;
                            }
                        } else {
                            statusItem.classList.add('answered');
                            answeredCount++;
                        }
                    }
                    
                    // æ ‡è®°å½“å‰é¢˜ç›®
                    if (index === this.currentQuestionIndex) {
                        statusItem.classList.add('current');
                    }
                    
                    // æ·»åŠ ç‚¹å‡»è·³è½¬åŠŸèƒ½
                    statusItem.addEventListener('click', () => {
                        this.currentQuestionIndex = index;
                        this.displayQuestion();
                    });
                    
                    statusContainer.appendChild(statusItem);
                });
                
                // æ›´æ–°å·²ç­”é¢˜æ•°é‡æ˜¾ç¤º
                document.getElementById('answeredCount').textContent = `å·²ç­”é¢˜: ${answeredCount}`;
            }

            showAnswerSaved() {
                const notification = document.getElementById('answerSavedNotification');
                notification.classList.add('show');
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 2000);
                // æ›´æ–°ç­”é¢˜çŠ¶æ€
                this.updateQuestionStatus();
            }

            confirmAnswer(questionIndex, userAnswer) {
                const question = this.questions[questionIndex];
                const correctAnswer = question.answer;
                
                // æ ‡è®°é¢˜ç›®å·²å›ç­”
                this.answeredQuestions.add(questionIndex);
                
                // åˆ¤æ–­ç­”æ¡ˆæ˜¯å¦æ­£ç¡®
                let isCorrect = false;
                
                if (question.type === 'å•é€‰é¢˜' || question.type === 'å¤šé€‰é¢˜') {
                    // æå–æ­£ç¡®ç­”æ¡ˆä¸­çš„å­—æ¯éƒ¨åˆ†
                    let correctLetters = '';
                    if (question.type === 'å•é€‰é¢˜') {
                        const match = correctAnswer.match(/^([A-D])/);
                        correctLetters = match ? match[1] : '';
                    } else {
                        if (/^[A-D]+$/.test(correctAnswer.trim())) {
                            correctLetters = correctAnswer.trim().split('').sort().join('');
                        } else {
                            const matches = correctAnswer.match(/([A-D])\./g);
                            if (matches) {
                                correctLetters = matches.map(m => m.charAt(0)).sort().join('');
                            }
                        }
                    }
                    
                    if (question.type === 'å¤šé€‰é¢˜') {
                        const userLetters = userAnswer ? userAnswer.split('').sort().join('') : '';
                        isCorrect = userLetters === correctLetters;
                    } else {
                        isCorrect = userAnswer === correctLetters;
                    }
                } else {
                    isCorrect = userAnswer === correctAnswer;
                }
                
                // æ˜¾ç¤ºç»“æœ
                this.showAnswerResult(questionIndex, document.getElementById('optionsContainer'), isCorrect);
                
                // ç¦ç”¨è¾“å…¥
                const container = document.getElementById('optionsContainer');
                const inputs = container.querySelectorAll('input, textarea');
                inputs.forEach(input => input.disabled = true);
                
                // éšè—ç¡®å®šæŒ‰é’®
                const confirmBtn = container.querySelector('.confirm-answer-btn');
                if (confirmBtn) {
                    confirmBtn.style.display = 'none';
                }
                
                // ç¦ç”¨åˆ¤æ–­é¢˜é€‰é¡¹ç‚¹å‡»
                const options = container.querySelectorAll('.option');
                options.forEach(option => {
                    option.style.pointerEvents = 'none';
                });
            }

            showAnswerResult(questionIndex, container, isCorrect = null) {
                const question = this.questions[questionIndex];
                const userAnswer = this.userAnswers[questionIndex];
                
                // å¦‚æœæ²¡æœ‰ä¼ å…¥isCorrectï¼Œé‡æ–°è®¡ç®—
                if (isCorrect === null) {
                    const correctAnswer = question.answer;
                    
                    if (question.type === 'å•é€‰é¢˜' || question.type === 'å¤šé€‰é¢˜') {
                        let correctLetters = '';
                        if (question.type === 'å•é€‰é¢˜') {
                            const match = correctAnswer.match(/^([A-D])/);
                            correctLetters = match ? match[1] : '';
                        } else {
                            if (/^[A-D]+$/.test(correctAnswer.trim())) {
                                correctLetters = correctAnswer.trim().split('').sort().join('');
                            } else {
                                const matches = correctAnswer.match(/([A-D])\./g);
                                if (matches) {
                                    correctLetters = matches.map(m => m.charAt(0)).sort().join('');
                                }
                            }
                        }
                        
                        if (question.type === 'å¤šé€‰é¢˜') {
                            const userLetters = userAnswer ? userAnswer.split('').sort().join('') : '';
                            isCorrect = userLetters === correctLetters;
                        } else {
                            isCorrect = userAnswer === correctLetters;
                        }
                    } else {
                        isCorrect = userAnswer === correctAnswer;
                    }
                }
                
                // ç§»é™¤ä¹‹å‰çš„ç»“æœæ˜¾ç¤º
                const existingResult = container.querySelector('.answer-result');
                if (existingResult) {
                    existingResult.remove();
                }
                
                // åˆ›å»ºç»“æœæ˜¾ç¤º
                const resultDiv = document.createElement('div');
                resultDiv.className = 'answer-result';
                resultDiv.style.marginTop = '15px';
                resultDiv.style.padding = '15px';
                resultDiv.style.borderRadius = '8px';
                resultDiv.style.fontWeight = 'bold';
                
                if (isCorrect) {
                    resultDiv.style.backgroundColor = '#d4edda';
                    resultDiv.style.color = '#155724';
                    resultDiv.style.border = '1px solid #c3e6cb';
                    let correctContent = 'âœ… <strong>æ­£ç¡®ï¼</strong>';
                    if (question.explanation && question.explanation.trim()) {
                        correctContent += `<br><span style="margin-top: 8px; display: block; font-weight: normal;">ç­”æ¡ˆè¯´æ˜ï¼š${question.explanation}</span>`;
                    }
                    resultDiv.innerHTML = correctContent;
                } else {
                    resultDiv.style.backgroundColor = '#f8d7da';
                    resultDiv.style.color = '#721c24';
                    resultDiv.style.border = '1px solid #f5c6cb';
                    let errorContent = `âŒ <strong>é”™è¯¯ï¼</strong><br><span style="margin-top: 8px; display: block;">æ­£ç¡®ç­”æ¡ˆï¼š${question.answer}</span>`;
                    if (question.explanation && question.explanation.trim()) {
                        errorContent += `<br><span style="margin-top: 8px; display: block; font-weight: normal;">ç­”æ¡ˆè¯´æ˜ï¼š${question.explanation}</span>`;
                    }
                    resultDiv.innerHTML = errorContent;
                }
                
                container.appendChild(resultDiv);
            }

            exportWrongQuestions() {
                if (!this.wrongQuestionsData || this.wrongQuestionsData.length === 0) {
                    alert('æ²¡æœ‰é”™é¢˜å¯ä»¥å¯¼å‡º');
                    return;
                }

                // æ„å»ºCSVå†…å®¹
                let csvContent = 'é¢˜ç›®ç¼–å·,é¢˜ç›®ç±»å‹,é¢˜ç›®å†…å®¹,é€‰é¡¹,æ­£ç¡®ç­”æ¡ˆ,ç­”æ¡ˆè¯´æ˜,é”™è¯¯ç­”æ¡ˆ\n';
                
                this.wrongQuestionsData.forEach(({ question, userAnswer }) => {
                    let userAnswerText = userAnswer;
                    if (Array.isArray(userAnswer)) {
                        userAnswerText = userAnswer.join('');
                    }
                    if (!userAnswerText) {
                        userAnswerText = 'æœªä½œç­”';
                    }
                    
                    // è½¬ä¹‰CSVå­—æ®µä¸­çš„ç‰¹æ®Šå­—ç¬¦
                    const escapeCSV = (field) => {
                        if (typeof field !== 'string') field = String(field);
                        if (field.includes(',') || field.includes('"') || field.includes('\n')) {
                            return '"' + field.replace(/"/g, '""') + '"';
                        }
                        return field;
                    };
                    
                    csvContent += [
                        escapeCSV(question.id),
                        escapeCSV(question.type),
                        escapeCSV(question.question),
                        escapeCSV(question.options),
                        escapeCSV(question.answer),
                        escapeCSV(question.explanation),
                        escapeCSV(userAnswerText)
                    ].join(',') + '\n';
                });

                // åˆ›å»ºä¸‹è½½é“¾æ¥
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', `é”™é¢˜é›†_${new Date().toISOString().slice(0, 10)}.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                alert(`å·²å¯¼å‡º ${this.wrongQuestionsData.length} é“é”™é¢˜`);
            }
            
            exportCorrectQuestions() {
                if (!this.correctQuestionsData || this.correctQuestionsData.length === 0) {
                    alert('æ²¡æœ‰æ­£ç¡®é¢˜ç›®å¯ä»¥å¯¼å‡º');
                    return;
                }

                // æ„å»ºCSVå†…å®¹
                let csvContent = 'é¢˜ç›®ç¼–å·,é¢˜ç›®ç±»å‹,é¢˜ç›®å†…å®¹,é€‰é¡¹,æ­£ç¡®ç­”æ¡ˆ,ç­”æ¡ˆè¯´æ˜,æ‚¨çš„ç­”æ¡ˆ\n';
                
                this.correctQuestionsData.forEach(({ question, userAnswer }) => {
                    let userAnswerText = userAnswer;
                    if (Array.isArray(userAnswer)) {
                        userAnswerText = userAnswer.join('');
                    }
                    
                    // è½¬ä¹‰CSVå­—æ®µä¸­çš„ç‰¹æ®Šå­—ç¬¦
                    const escapeCSV = (field) => {
                        if (typeof field !== 'string') field = String(field);
                        if (field.includes(',') || field.includes('"') || field.includes('\n')) {
                            return '"' + field.replace(/"/g, '""') + '"';
                        }
                        return field;
                    };
                    
                    csvContent += [
                        escapeCSV(question.id),
                        escapeCSV(question.type),
                        escapeCSV(question.question),
                        escapeCSV(question.options),
                        escapeCSV(question.answer),
                        escapeCSV(question.explanation),
                        escapeCSV(userAnswerText)
                    ].join(',') + '\n';
                });

                // åˆ›å»ºä¸‹è½½é“¾æ¥
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', `æ­£ç¡®é¢˜ç›®_${new Date().toISOString().slice(0, 10)}.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                alert(`å·²å¯¼å‡º ${this.correctQuestionsData.length} é“æ­£ç¡®é¢˜ç›®`);
            }
            
            exportAllQuestions() {
                if (!this.questions || this.questions.length === 0) {
                    alert('æ²¡æœ‰é¢˜ç›®å¯ä»¥å¯¼å‡º');
                    return;
                }

                // æ„å»ºCSVå†…å®¹
                let csvContent = 'é¢˜ç›®ç¼–å·,é¢˜ç›®ç±»å‹,é¢˜ç›®å†…å®¹,é€‰é¡¹,æ­£ç¡®ç­”æ¡ˆ,ç­”æ¡ˆè¯´æ˜,æ‚¨çš„ç­”æ¡ˆ,ç­”é¢˜çŠ¶æ€\n';
                
                this.questions.forEach((question, index) => {
                    let userAnswer = this.userAnswers[index];
                    let userAnswerText = '';
                    let answerStatus = 'æœªä½œç­”';
                    
                    if (userAnswer !== null && userAnswer !== undefined && userAnswer !== '') {
                        if (Array.isArray(userAnswer)) {
                            userAnswerText = userAnswer.join('');
                        } else {
                            userAnswerText = userAnswer;
                        }
                        
                        // åˆ¤æ–­ç­”é¢˜çŠ¶æ€
                        if (question.type === 'é—®ç­”é¢˜') {
                            answerStatus = 'å·²ä½œç­”';
                        } else {
                            // åˆ¤æ–­æ˜¯å¦æ­£ç¡®
                            const wrongQuestionIndexes = this.wrongQuestionsData ? 
                                new Set(this.wrongQuestionsData.map(wq => wq.index - 1)) : new Set();
                            answerStatus = wrongQuestionIndexes.has(index) ? 'é”™è¯¯' : 'æ­£ç¡®';
                        }
                    }
                    
                    // è½¬ä¹‰CSVå­—æ®µä¸­çš„ç‰¹æ®Šå­—ç¬¦
                    const escapeCSV = (field) => {
                        if (typeof field !== 'string') field = String(field);
                        if (field.includes(',') || field.includes('"') || field.includes('\n')) {
                            return '"' + field.replace(/"/g, '""') + '"';
                        }
                        return field;
                    };
                    
                    csvContent += [
                        escapeCSV(question.id),
                        escapeCSV(question.type),
                        escapeCSV(question.question),
                        escapeCSV(question.options),
                        escapeCSV(question.answer),
                        escapeCSV(question.explanation),
                        escapeCSV(userAnswerText),
                        escapeCSV(answerStatus)
                    ].join(',') + '\n';
                });

                // åˆ›å»ºä¸‹è½½é“¾æ¥
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', `å…¨éƒ¨é¢˜ç›®_${new Date().toISOString().slice(0, 10)}.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                alert(`å·²å¯¼å‡º ${this.questions.length} é“é¢˜ç›®`);
            }

            // æ—¶é—´ç®¡ç†æ–¹æ³•
            startTimer() {
                this.examStartTime = new Date();
                
                if (this.isTimeLimited) {
                    // æ˜¾ç¤ºå€’è®¡æ—¶
                    document.getElementById('examTimer').style.display = 'block';
                    document.getElementById('examDuration').style.display = 'none';
                    
                    this.timerInterval = setInterval(() => {
                        this.updateCountdownTimer();
                    }, 1000);
                } else {
                    // æ˜¾ç¤ºç”¨æ—¶ç»Ÿè®¡
                    document.getElementById('examTimer').style.display = 'none';
                    document.getElementById('examDuration').style.display = 'block';
                    
                    this.timerInterval = setInterval(() => {
                        this.updateDurationTimer();
                    }, 1000);
                }
            }
            
            updateCountdownTimer() {
                const now = new Date();
                const elapsed = Math.floor((now - this.examStartTime) / 1000); // å·²ç”¨ç§’æ•°
                const totalSeconds = this.examTimeLimit * 60; // æ€»ç§’æ•°
                const remaining = totalSeconds - elapsed; // å‰©ä½™ç§’æ•°
                
                if (remaining <= 0) {
                    // æ—¶é—´åˆ°ï¼Œè‡ªåŠ¨äº¤å·
                    this.stopTimer();
                    this.submitExam(true); // ä¼ å…¥trueè¡¨ç¤ºè‡ªåŠ¨äº¤å·
                    return;
                }
                
                const minutes = Math.floor(remaining / 60);
                const seconds = remaining % 60;
                const timeStr = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                const timerValue = document.getElementById('timerValue');
                timerValue.textContent = timeStr;
                
                // æ ¹æ®å‰©ä½™æ—¶é—´æ·»åŠ è­¦å‘Šæ ·å¼
                timerValue.className = 'timer-value';
                if (remaining <= 60) { // æœ€å1åˆ†é’Ÿ
                    timerValue.classList.add('danger');
                } else if (remaining <= 300) { // æœ€å5åˆ†é’Ÿ
                    timerValue.classList.add('warning');
                }
            }
            
            updateDurationTimer() {
                const now = new Date();
                const elapsed = Math.floor((now - this.examStartTime) / 1000);
                
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                const timeStr = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                document.getElementById('durationValue').textContent = timeStr;
            }
            
            stopTimer() {
                if (this.timerInterval) {
                    clearInterval(this.timerInterval);
                    this.timerInterval = null;
                }
                this.examEndTime = new Date();
            }
            
            getExamDuration() {
                if (!this.examStartTime) return '00:00';
                
                const endTime = this.examEndTime || new Date();
                const elapsed = Math.floor((endTime - this.examStartTime) / 1000);
                
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }

            restart() {
                this.questions = [];
                this.currentQuestionIndex = 0;
                this.userAnswers = [];
                this.examStarted = false;
                this.wrongQuestionsData = null;
                this.correctQuestionsData = null; // æ¸…ç©ºæ­£ç¡®é¢˜ç›®æ•°æ®
                this.answeredQuestions.clear(); // æ¸…ç©ºå·²å›ç­”é¢˜ç›®è®°å½•
                this.selectedFile = null; // æ¸…é™¤é€‰ä¸­çš„æ–‡ä»¶
                
                // é‡ç½®æ—¶é—´ç›¸å…³å˜é‡
                this.stopTimer();
                this.examStartTime = null;
                this.examEndTime = null;
                this.examTimeLimit = null;
                this.isTimeLimited = false;

                document.getElementById('result-section').classList.add('hidden');
                document.getElementById('import-section').classList.remove('hidden');
                document.getElementById('csvFile').value = '';
                document.getElementById('file-info').classList.add('hidden');
                document.getElementById('parseBtn').disabled = true;
                
                // éšè—æ—¶é—´æ˜¾ç¤ºåŒºåŸŸ
                document.getElementById('examTimer').style.display = 'none';
                document.getElementById('examDuration').style.display = 'none';
                
                // æ¸…é™¤æ–‡ä»¶é€‰ä¸­çŠ¶æ€
                document.querySelectorAll('.file-item').forEach(item => {
                    item.classList.remove('selected');
                });
                
                // é‡æ–°æ£€æµ‹CSVæ–‡ä»¶
                this.detectCSVFiles();
            }
        }

        // é¡µç­¾åˆ‡æ¢å‡½æ•°
        function showTab(tabName) {
            // éšè—æ‰€æœ‰é¡µç­¾å†…å®¹
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // ç§»é™¤æ‰€æœ‰æŒ‰é’®çš„activeçŠ¶æ€
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // æ˜¾ç¤ºé€‰ä¸­çš„é¡µç­¾
            if (tabName === 'wrong-questions') {
                document.getElementById('wrong-questions-tab').classList.add('active');
                document.querySelector('button[onclick="showTab(\'wrong-questions\')"]').classList.add('active');
            } else if (tabName === 'correct-questions') {
                document.getElementById('correct-questions-tab').classList.add('active');
                document.querySelector('button[onclick="showTab(\'correct-questions\')"]').classList.add('active');
            } else if (tabName === 'essay-answers') {
                document.getElementById('essay-answers-tab').classList.add('active');
                document.querySelector('button[onclick="showTab(\'essay-answers\')"]').classList.add('active');
            }
        }

        // åˆå§‹åŒ–åº”ç”¨
        const app = new QuestionBank();

        // é¢˜ç›®çŠ¶æ€åŒºåŸŸæŠ˜å /å±•å¼€åŠŸèƒ½
        function toggleQuestionStatus() {
            const statusContainer = document.getElementById('questionStatus');
            const toggleIcon = document.getElementById('toggleIcon');
            
            statusContainer.classList.toggle('collapsed');
            
            // æ›´æ–°å›¾æ ‡æ—‹è½¬çŠ¶æ€
            if (statusContainer.classList.contains('collapsed')) {
                toggleIcon.style.transform = 'rotate(0deg)';
            } else {
                toggleIcon.style.transform = 'rotate(180deg)';
            }
        }
    </script>
</body>
</html>