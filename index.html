<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>È¢òÂ∫ìÂ§ç‰π†Á≥ªÁªü</title>
    <!-- SheetJSÂ∫ìÁî®‰∫éExcelÊñá‰ª∂Ëß£Êûê -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        /* Ëß¶Êë∏ËÆæÂ§á‰ºòÂåñ */
        @media (hover: none) and (pointer: coarse) {
            .btn, .option, .status-item, .file-item, .tab-btn {
                min-height: 44px;
            }
            
            .option {
                padding: 14px;
            }
            
            .status-item {
                min-width: 44px;
                min-height: 44px;
            }
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            -webkit-overflow-scrolling: touch;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            /* Èò≤Ê≠¢ÁßªÂä®Á´Ø‰∏ãÊãâÂà∑Êñ∞ */
            overscroll-behavior: none;
            overscroll-behavior-y: none;
        }
        
        /* ÂÖÅËÆ∏ÊñáÊú¨ÈÄâÊã©ÁöÑÂÖÉÁ¥† */
        .question-text, .option-text, .essay-input, input[type="text"], textarea {
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .version-tag {
            font-size: 0.4em;
            background: rgba(255, 255, 255, 0.2);
            padding: 4px 8px;
            border-radius: 12px;
            margin-left: 10px;
            font-weight: normal;
            vertical-align: middle;
        }

        .content {
            padding: 30px;
        }

        .section {
            margin-bottom: 30px;
        }

        .section h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        .file-upload {
            border: 2px dashed #ddd;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .file-upload:hover {
            border-color: #4CAF50;
            background-color: #f9f9f9;
        }

        .file-upload input[type="file"] {
            display: none;
        }

        .file-upload label {
            display: inline-block;
            padding: 12px 24px;
            background: #4CAF50;
            color: white;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .file-upload label:hover {
            background: #45a049;
        }

        .btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn:hover {
            background: #45a049;
            transform: translateY(-2px);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: #2196F3;
        }

        .btn-secondary:hover {
            background: #1976D2;
        }

        .btn-danger {
            background: #f44336;
        }

        .btn-danger:hover {
            background: #d32f2f;
        }

        .question-container {
            background: #f9f9f9;
            border-radius: 10px;
            padding: 25px;
            margin: 20px 0;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .question-number {
            background: #4CAF50;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
        }

        .question-type {
            background: #2196F3;
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 14px;
        }

        .question-text {
            font-size: 18px;
            line-height: 1.6;
            margin-bottom: 20px;
            color: #333;
        }

        .options {
            margin: 15px 0;
        }

        .option {
            margin: 10px 0;
            padding: 12px;
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .option:hover {
            border-color: #4CAF50;
            background: #f0f8f0;
        }

        .option.selected {
            border-color: #4CAF50;
            background: #e8f5e8;
            box-shadow: 0 2px 8px rgba(76, 175, 80, 0.3);
        }

        .answer-saved {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4CAF50;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
        }

        .answer-saved.show {
            opacity: 1;
            transform: translateX(0);
        }

        .option input[type="radio"], .option input[type="checkbox"] {
            margin-right: 10px;
        }

        .textarea-answer {
            width: 100%;
            min-height: 120px;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            font-family: inherit;
            resize: vertical;
            transition: border-color 0.3s ease;
        }

        .textarea-answer:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
        }

        .options-display {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .options-display h4 {
            margin: 0 0 10px 0;
            color: #495057;
            font-size: 16px;
        }

        .option-text {
              padding: 10px 0;
              color: #6c757d;
              font-size: 15px;
              line-height: 1.5;
              border-bottom: 1px solid #e9ecef;
              display: block;
              width: 100%;
          }

          .option-text:last-child {
              border-bottom: none;
          }
 
          .option-text:not(:first-child) {
              margin-top: 8px;
          }

        .answer-input-container {
            margin-top: 20px;
        }

        .answer-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #495057;
            font-size: 16px;
        }

        .answer-input {
            width: 320px;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            text-align: center;
            text-transform: uppercase;
            transition: all 0.3s ease;
        }

        .answer-input:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
            transform: scale(1.02);
        }

        .answer-input::placeholder {
            color: #adb5bd;
            font-weight: normal;
            text-transform: none;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
        }

        .question-status {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 20px 0;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 10px;
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .question-status.collapsed {
            max-height: 0;
            padding: 0 15px;
            margin: 0;
            opacity: 0;
        }

        .total-count-toggle {
            cursor: pointer;
            user-select: none;
            transition: color 0.3s ease;
        }

        .total-count-toggle:hover {
            color: #4CAF50;
        }

        #toggleIcon {
            font-size: 12px;
            margin-left: 5px;
            transition: transform 0.3s ease;
        }

        .question-status:not(.collapsed) ~ * #toggleIcon,
        .question-status.expanded #toggleIcon {
            transform: rotate(180deg);
        }

        .detected-files {
            margin-bottom: 20px;
        }

        .detected-files h3 {
            color: #4CAF50;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .file-list {
            background: #f9f9f9;
            border-radius: 8px;
            padding: 15px;
            min-height: 60px;
        }

        .loading-text {
            color: #666;
            font-style: italic;
            text-align: center;
            margin: 0;
        }

        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            margin: 8px 0;
            background: white;
            border-radius: 6px;
            border: 1px solid #ddd;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .file-item:hover {
            border-color: #4CAF50;
            box-shadow: 0 2px 8px rgba(76, 175, 80, 0.2);
        }

        .file-item.selected {
            border-color: #4CAF50;
            background: #e8f5e8;
        }

        .file-name {
            font-weight: 500;
            color: #333;
        }

        .file-size {
            color: #666;
            font-size: 14px;
        }

        .divider {
            text-align: center;
            margin: 25px 0;
            position: relative;
        }

        .divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: #ddd;
        }

        .divider span {
            background: white;
            padding: 0 20px;
            color: #666;
            font-size: 14px;
        }
        
        /* ËÄÉËØïËÆæÁΩÆÊ†∑Âºè */
        .exam-settings {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .exam-settings h3 {
            margin: 0 0 20px 0;
            color: #495057;
            font-size: 18px;
        }
        
        .setting-group {
            margin-bottom: 20px;
        }
        
        .setting-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #495057;
        }
        
        .question-type-selection {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        
        .type-info {
            display: flex !important;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            font-weight: normal !important;
            margin-bottom: 0 !important;
        }
        
        .available-count {
            margin-left: auto;
            font-size: 12px;
            color: #6c757d;
        }
        
        .number-input-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .number-input-group input {
            width: 100px;
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 16px;
        }
        
        .max-count-hint {
            font-size: 12px;
            color: #6c757d;
        }
        
        .setting-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }
        
        .setting-actions .btn {
            min-width: 120px;
        }
        
        /* È¢òÂûãÊï∞ÈáèËÆæÁΩÆÊ†∑Âºè */
        .question-count-settings {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 15px;
            margin-top: 10px;
        }
        
        .count-input-row {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            gap: 10px;
        }
        
        .count-input-row:last-child {
            margin-bottom: 0;
        }
        
        .count-input-row label {
            min-width: 80px;
            margin: 0 !important;
            font-weight: normal !important;
            color: #495057;
        }
        
        .count-input-row input {
            width: 80px;
            padding: 6px 10px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
            text-align: center;
        }
        
        .count-input-row input:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
        }
        
        .max-hint {
            font-size: 12px;
            color: #6c757d;
            margin-left: auto;
        }
        
        .total-count-display {
            margin-top: 15px;
            padding: 10px;
            background: #e9ecef;
            border-radius: 4px;
            text-align: center;
            font-size: 14px;
            color: #495057;
        }
        
        .total-count-display strong {
            color: #007bff;
            font-size: 16px;
        }
        
        /* Êó∂Èó¥ËÆæÁΩÆÊ†∑Âºè */
        .time-setting {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }
        
        .time-option {
            display: flex !important;
            align-items: center;
            margin: 0 !important;
            font-weight: normal !important;
            cursor: pointer;
        }
        
        .time-option input[type="radio"] {
            margin-right: 8px;
            transform: scale(1.2);
        }
        
        .time-input-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
            border: 1px solid #dee2e6;
        }
        
        .time-input-group label {
            margin: 0 !important;
            font-weight: normal !important;
            color: #495057;
        }
        
        .time-input-group input {
            width: 80px;
            padding: 6px 10px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
            text-align: center;
        }
        
        .time-input-group input:focus {
             outline: none;
             border-color: #007bff;
             box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
         }
         
         /* ËÄÉËØïÊó∂Èó¥ÊòæÁ§∫Ê†∑Âºè */
         .exam-timer, .exam-duration {
             text-align: center;
             margin: 15px 0;
             padding: 10px;
             background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
             border-radius: 8px;
             box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
         }
         
         .exam-timer {
             background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
         }
         
         .exam-duration {
             background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
         }
         
         .timer-display, .duration-display {
             display: flex;
             justify-content: center;
             align-items: center;
             gap: 10px;
         }
         
         .timer-label, .duration-label {
             color: white;
             font-size: 16px;
             font-weight: 500;
         }
         
         .timer-value, .duration-value {
             color: white;
             font-size: 24px;
             font-weight: bold;
             font-family: 'Courier New', monospace;
             text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
         }
         
         .timer-value.warning {
              color: #fff200;
              text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
              animation: pulse 1s infinite;
          }
          
          .timer-value.danger {
              color: #ffffff;
              text-shadow: 0 2px 6px rgba(0, 0, 0, 0.9);
              animation: pulse 0.5s infinite;
          }
         
         @keyframes pulse {
             0%, 100% { opacity: 1; }
             50% { opacity: 0.7; }
         }
         
         .pause-resume-btn {
             background: rgba(255, 255, 255, 0.2);
             border: 1px solid rgba(255, 255, 255, 0.3);
             color: white;
             padding: 6px 12px;
             border-radius: 6px;
             cursor: pointer;
             font-size: 14px;
             font-weight: 500;
             transition: all 0.3s ease;
             backdrop-filter: blur(10px);
             margin-left: 10px;
         }
         
         .pause-resume-btn:hover {
             background: rgba(255, 255, 255, 0.3);
             transform: translateY(-1px);
             box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
         }
         
         .pause-resume-btn:active {
             transform: translateY(0);
         }
         
         .pause-resume-btn.paused {
             background: rgba(255, 193, 7, 0.8);
             border-color: rgba(255, 193, 7, 0.9);
         }
         
         .pause-resume-btn.paused:hover {
             background: rgba(255, 193, 7, 0.9);
         }

        .no-files-message {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px dashed #ddd;
            margin: 10px 0;
        }
        
        .loading-message {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 20px;
            background: #f0f8ff;
            border-radius: 8px;
            border: 1px solid #e3f2fd;
            margin: 10px 0;
        }

        .status-item {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid #ddd;
            background: white;
        }

        .status-item.answered {
            background: #4CAF50;
            color: white;
            border-color: #4CAF50;
        }

        .status-item.current {
            background: #2196F3;
            color: white;
            border-color: #2196F3;
            transform: scale(1.1);
        }

        .status-item:hover {
            transform: scale(1.05);
        }

        .progress {
            background: #ddd;
            border-radius: 10px;
            height: 10px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-bar {
            background: #4CAF50;
            height: 100%;
            transition: width 0.3s ease;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #4CAF50;
        }

        .stat-label {
            color: #666;
            margin-top: 5px;
        }

        .wrong-questions {
            margin-top: 30px;
        }

        .wrong-question {
            background: #ffebee;
            border-left: 4px solid #f44336;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        
        .correct-questions {
            margin-top: 30px;
        }
        
        .correct-question {
            background: #e8f5e9;
            border-left: 4px solid #4CAF50;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        
        .correct-questions-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .correct-questions-header h3 {
            margin: 0;
            white-space: nowrap;
            flex-shrink: 0;
        }
        
        .export-buttons {
            display: flex;
            gap: 10px;
        }
        
        .export-buttons .btn {
            background-color: #17a2b8;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .export-buttons .btn:hover {
            background-color: #138496;
        }

        .tab-navigation {
            display: flex;
            margin: 20px 0;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab-btn {
            padding: 12px 24px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .tab-btn.active {
            color: #4CAF50;
            border-bottom-color: #4CAF50;
            font-weight: bold;
        }

        .tab-btn:hover {
            color: #4CAF50;
            background-color: #f5f5f5;
        }

        .tab-content {
            display: none;
            padding: 20px 0;
        }

        .tab-content.active {
            display: block;
        }

        .essay-answers {
            background: #f9f9f9;
            border-radius: 8px;
            padding: 20px;
        }

        .essay-question {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #2196F3;
        }

        .essay-question h4 {
            color: #2196F3;
            margin-bottom: 15px;
        }

        .essay-answer {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
        }

        .user-essay-answer {
            background-color: #fff3cd;
            border-left: 3px solid #ffc107;
        }

        .correct-essay-answer {
            background-color: #d4edda;
            border-left: 3px solid #28a745;
        }

        .confirm-answer-btn {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s ease;
        }

        .confirm-answer-btn:hover {
            background-color: #45a049;
        }

        .answer-result {
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .wrong-questions-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: nowrap;
            gap: 15px;
        }

        .wrong-questions-header h3 {
            margin: 0;
            white-space: nowrap;
            flex-shrink: 0;
        }

        #exportWrongBtn {
            background-color: #17a2b8;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        #exportWrongBtn:hover {
            background-color: #138496;
        }

        .answer-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 15px;
        }

        .user-answer, .correct-answer {
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #dee2e6;
        }

        .user-answer {
            background: #fff3cd;
            border-color: #ffeaa7;
        }

        .correct-answer {
            background: #d1ecf1;
            border-color: #bee5eb;
        }

        .answer-label {
            font-weight: bold;
            margin-bottom: 8px;
            display: block;
        }

        .user-answer .answer-label {
            color: #856404;
        }

        .correct-answer .answer-label {
            color: #0c5460;
        }

        @media (max-width: 768px) {
            .answer-comparison {
                grid-template-columns: 1fr;
            }
            
            .tab-navigation {
                flex-direction: column;
            }
            
            .stats {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
            
            .question-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            
            .question-text {
                font-size: 16px;
                line-height: 1.6;
            }
        }

        .hidden {
            display: none;
        }

        .info {
            background: #e3f2fd;
            border: 1px solid #2196F3;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
            color: #1976D2;
        }

        .success {
            background: #e8f5e9;
            border: 1px solid #4CAF50;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
            color: #2e7d32;
        }

        @media (max-width: 600px) {
            .container {
                margin: 5px;
            }
            
            .content {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 24px;
            }
            
            .header p {
                font-size: 14px;
            }
            
            .navigation {
                flex-direction: column;
                gap: 10px;
            }
            
            .btn {
                padding: 12px 20px;
                font-size: 16px;
                min-height: 48px;
                width: 100%;
            }
            
            .btn-secondary {
                padding: 10px 16px;
                font-size: 14px;
                min-height: 44px;
            }
            
            .stats {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .stat-card {
                padding: 15px;
            }
            
            .stat-number {
                font-size: 1.8em;
            }
            
            .question-container {
                padding: 15px;
            }
            
            .question-text {
                font-size: 15px;
                line-height: 1.5;
                margin: 15px 0;
            }
            
            .option {
                padding: 12px;
                margin: 8px 0;
                font-size: 15px;
            }
            
            .option input[type="radio"],
            .option input[type="checkbox"] {
                width: 18px;
                height: 18px;
            }
            
            .answer-input {
                width: 100%;
                max-width: 280px;
                font-size: 16px;
                padding: 12px;
            }
            
            .answer-input::placeholder {
                font-size: 14px;
            }
            
            .question-status {
                padding: 10px;
            }
            
            .status-item {
                width: 28px;
                height: 28px;
                font-size: 11px;
                margin: 2px;
            }
            
            .tab-btn {
                padding: 10px 16px;
                font-size: 14px;
            }
            
            .wrong-question {
                padding: 12px;
                margin: 8px 0;
            }
            
            .answer-comparison {
                gap: 10px;
            }
            
            .user-answer, .correct-answer {
                padding: 12px;
                font-size: 14px;
            }
            
            .progress {
                height: 8px;
                margin: 15px 0;
            }
            
            #questionProgress {
                font-size: 14px;
                padding: 8px 12px;
                background: #f5f5f5;
                border-radius: 20px;
                margin: 0 10px;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                margin: 0;
                border-radius: 0;
            }
            
            .content {
                padding: 10px;
            }
            
            .header {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 20px;
            }
            
            .navigation {
                 gap: 8px;
                 padding: 0 5px;
             }
             
             .btn {
                 padding: 14px 20px;
                 font-size: 16px;
                 border-radius: 8px;
                 flex: 1;
                 max-width: none;
             }
             
             .btn-secondary {
                 flex: 0 0 auto;
                 min-width: 80px;
             }
             
             #questionProgress {
                 flex: 0 0 auto;
                 white-space: nowrap;
                 font-weight: bold;
             }
            
            .question-text {
                font-size: 14px;
            }
            
            .option {
                padding: 10px;
                font-size: 14px;
            }
            
            .status-item {
                 width: 26px;
                 height: 26px;
                 font-size: 10px;
             }
             
             .essay-input {
                 font-size: 16px;
                 padding: 12px;
                 min-height: 120px;
                 border-radius: 8px;
             }
             
             .file-upload input[type="file"] {
                 font-size: 16px;
                 padding: 12px;
             }
             
             .file-upload label {
                 font-size: 16px;
                 padding: 12px 20px;
                 min-height: 48px;
                 display: flex;
                 align-items: center;
                 justify-content: center;
             }
             
             .detected-files h3 {
                 font-size: 16px;
             }
             
             .file-item {
                 padding: 12px;
                 font-size: 14px;
             }
             
             .answer-input {
                 width: 100%;
                 max-width: 250px;
                 font-size: 16px;
                 padding: 10px;
             }
             
             .answer-input::placeholder {
                 font-size: 13px;
             }
             
             .divider {
                 margin: 20px 0;
             }
             
             .divider span {
                 font-size: 14px;
                 padding: 0 15px;
             }
             
             /* ‰øÆÂ§çÂºÄÂßãÁ≠îÈ¢òÊåâÈíÆÊ†∑Âºè */
             .setting-actions {
                 flex-direction: column;
                 gap: 15px;
                 align-items: stretch;
             }
             
             .setting-actions .btn {
                 min-width: auto;
                 width: 100%;
                 padding: 16px 20px;
                 font-size: 18px;
             }
             
             #startExam {
                 width: 100%;
                 padding: 16px 20px;
                 font-size: 18px;
                 margin: 10px 0;
             }
             
             /* ÈÄâÈ°πÊ†∑Âºè‰ºòÂåñ */
             .option-item {
                 padding: 12px 15px !important;
                 margin: 6px 0 !important;
                 font-size: 15px !important;
                 line-height: 1.4 !important;
             }
             
             .options-container .answer-label {
                 font-size: 16px !important;
                 margin-bottom: 12px !important;
             }
         }
         
         /* ÂØºÂá∫Êéß‰ª∂Ê†∑Âºè */
         .export-controls {
             display: flex;
             align-items: center;
             gap: 8px;
             margin-left: 15px;
             flex-wrap: nowrap;
             white-space: nowrap;
         }
         
         .format-selector {
             padding: 8px 10px;
             border: 2px solid #e1e5e9;
             border-radius: 6px;
             background-color: white;
             font-size: 13px;
             color: #333;
             cursor: pointer;
             transition: all 0.3s ease;
             min-width: 110px;
             max-width: 130px;
             flex-shrink: 0;
         }
         
         .format-selector:focus {
             outline: none;
             border-color: #667eea;
             box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
         }
         
         .format-selector:hover {
             border-color: #667eea;
         }
         
         .export-btn {
             background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
             color: white;
             border: none;
             padding: 8px 16px;
             border-radius: 6px;
             cursor: pointer;
             font-size: 13px;
             font-weight: 500;
             transition: all 0.3s ease;
             box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
             white-space: nowrap;
             flex-shrink: 0;
         }
         
         .export-btn:hover {
             transform: translateY(-2px);
             box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
         }
         
         .export-buttons {
             display: flex;
             gap: 12px;
             align-items: center;
             flex-wrap: nowrap;
             margin-top: 15px;
             margin-bottom: 20px;
         }
         
         .wrong-actions {
                display: flex;
                gap: 15px;
                align-items: center;
                flex-wrap: nowrap;
                margin-top: 15px;
                margin-bottom: 20px;
            }
            
            .retake-btn {
                background: linear-gradient(135deg, #ff6b6b, #ee5a24);
                color: white;
                border: none;
                padding: 8px 16px;
                border-radius: 6px;
                cursor: pointer;
                font-size: 13px;
                font-weight: 500;
                transition: all 0.3s ease;
                white-space: nowrap;
                flex-shrink: 0;
                min-width: 80px;
                box-shadow: 0 2px 4px rgba(255, 107, 107, 0.2);
            }
            
            .retake-btn:hover {
                background: linear-gradient(135deg, #ee5a24, #ff6b6b);
                transform: translateY(-1px);
                box-shadow: 0 4px 8px rgba(255, 107, 107, 0.3);
            }
            
            .retake-btn:active {
                transform: translateY(0);
                box-shadow: 0 2px 4px rgba(255, 107, 107, 0.2);
            }
         
         /* ÂìçÂ∫îÂºèËÆæËÆ° */
         @media (max-width: 768px) {
             .export-controls {
                 gap: 6px;
                 margin-left: 8px;
                 margin-top: 8px;
             }
             
             .format-selector {
                 min-width: 90px;
                 max-width: 110px;
                 font-size: 12px;
                 padding: 6px 8px;
             }
             
             .export-btn {
                 padding: 6px 12px;
                 font-size: 12px;
             }
             
             .export-buttons {
                 gap: 8px;
             }
         }
         
         @media (max-width: 480px) {
             .export-controls {
                 flex-direction: column;
                 gap: 6px;
                 margin-left: 0;
                 margin-top: 8px;
                 align-items: flex-start;
             }
             
             .format-selector {
                 min-width: 100px;
                 max-width: 120px;
             }
             
             .export-buttons {
                 flex-direction: column;
                 gap: 8px;
                 width: 100%;
             }
             
             .wrong-actions {
                 flex-direction: column;
                 align-items: stretch;
                 gap: 10px;
             }
             
             .retake-btn {
                 width: 100%;
                 min-width: auto;
             }
         }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìö È¢òÂ∫ìÂ§ç‰π†Á≥ªÁªü <span id="version-display" class="version-tag"></span></h1>
            <p>ÂØºÂÖ•È¢òÂ∫ìÔºåÂºÄÂßã‰Ω†ÁöÑÂ§ç‰π†‰πãÊóÖ</p>
        </div>
        
        <div class="content">
            <!-- Êñá‰ª∂ÂØºÂÖ•Âå∫Âüü -->
            <div id="import-section" class="section">
                <h2>üìÅ ÂØºÂÖ•È¢òÂ∫ì</h2>
                
                <!-- Ëá™Âä®Ê£ÄÊµãÁöÑÈ¢òÂ∫ìÊñá‰ª∂ÂàóË°® -->
                <div id="detected-files" class="detected-files">
                    <h3>üìã Ê£ÄÊµãÂà∞ÁöÑÈ¢òÂ∫ìÊñá‰ª∂</h3>
                    <div id="fileList" class="file-list">
                        <p class="loading-text">Ê≠£Âú®Ê£ÄÊµãÂêåÁõÆÂΩï‰∏ãÁöÑÈ¢òÂ∫ìÊñá‰ª∂...</p>
                    </div>
                </div>
                
                <!-- ÂàÜÈöîÁ∫ø -->
                <div class="divider">
                    <span>ÊàñËÄÖ</span>
                </div>
                
                <!-- ÊâãÂä®‰∏ä‰º†Êñá‰ª∂ -->
                <div class="file-upload">
                    <input type="file" id="csvFile" accept=".csv,.xlsx" />
                    <label for="csvFile">ÊâãÂä®‰∏ä‰º†È¢òÂ∫ìÊñá‰ª∂</label>
                    <p style="margin-top: 15px; color: #666;">ÊîØÊåÅÊ†ºÂºèÔºöCSV„ÄÅExcel (.xlsx)<br>Ê†ºÂºèË¶ÅÊ±ÇÔºöÁºñÂè∑,È¢òÁõÆÁ±ªÂûã,È¢òÁõÆ,È¢òÁõÆÈÄâÈ°π,È¢òÁõÆÁ≠îÊ°à,Á≠îÊ°àËØ¥Êòé</p>
                </div>
                
                <div id="file-info" class="info hidden">
                    <p>Êñá‰ª∂Â∑≤ÈÄâÊã©ÔºåÁÇπÂáª‰∏ãÊñπÊåâÈíÆËß£ÊûêÈ¢òÂ∫ì</p>
                </div>
                <button id="parseBtn" class="btn" disabled style="display: none;">Ëß£ÊûêÈ¢òÂ∫ì</button>
            </div>

            <!-- È¢òÂ∫ì‰ø°ÊÅØÂå∫Âüü -->
            <div id="library-section" class="section hidden">
                <h2>üìä È¢òÂ∫ì‰ø°ÊÅØ</h2>
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-number" id="totalQuestions">0</div>
                        <div class="stat-label">ÊÄªÈ¢òÊï∞</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="singleChoice">0</div>
                        <div class="stat-label">ÂçïÈÄâÈ¢ò</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="multiChoice">0</div>
                        <div class="stat-label">Â§öÈÄâÈ¢ò</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="trueOrFalse">0</div>
                        <div class="stat-label">Âà§Êñ≠È¢ò</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="essay">0</div>
                        <div class="stat-label">ÈóÆÁ≠îÈ¢ò</div>
                    </div>
                </div>
                
                <!-- ËÄÉËØïËÆæÁΩÆÂå∫Âüü -->
                <div id="exam-settings" class="exam-settings" style="display: none;">
                    <h3>üìù ËÄÉËØïËÆæÁΩÆ</h3>
                    
                    <div class="setting-group">
                        <label>È¢òÂ∫ìÁªüËÆ°Ôºö</label>
                        <div class="question-type-selection">
                            <div class="type-info">
                                <span>ÂçïÈÄâÈ¢ò</span>
                                <span class="available-count" id="singleAvailable">(0È¢ò)</span>
                            </div>
                            <div class="type-info">
                                <span>Â§öÈÄâÈ¢ò</span>
                                <span class="available-count" id="multiAvailable">(0È¢ò)</span>
                            </div>
                            <div class="type-info">
                                <span>Âà§Êñ≠È¢ò</span>
                                <span class="available-count" id="trueOrFalseAvailable">(0È¢ò)</span>
                            </div>
                            <div class="type-info">
                                <span>ÈóÆÁ≠îÈ¢ò</span>
                                <span class="available-count" id="essayAvailable">(0È¢ò)</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="setting-group">
                        <label>ÂêÑÈ¢òÂûãÊï∞ÈáèËÆæÁΩÆÔºö</label>
                        <div class="question-count-settings">
                            <div class="count-input-row">
                                <label for="singleCount">ÂçïÈÄâÈ¢òÔºö</label>
                                <input type="number" id="singleCount" min="0" max="100" value="5">
                                <span class="max-hint" id="singleMaxHint">ÊúÄÂ§ö 0 È¢ò</span>
                            </div>
                            <div class="count-input-row">
                                <label for="multiCount">Â§öÈÄâÈ¢òÔºö</label>
                                <input type="number" id="multiCount" min="0" max="100" value="3">
                                <span class="max-hint" id="multiMaxHint">ÊúÄÂ§ö 0 È¢ò</span>
                            </div>
                            <div class="count-input-row">
                                <label for="trueOrFalseCount">Âà§Êñ≠È¢òÔºö</label>
                                <input type="number" id="trueOrFalseCount" min="0" max="100" value="2">
                                <span class="max-hint" id="trueOrFalseMaxHint">ÊúÄÂ§ö 0 È¢ò</span>
                            </div>
                            <div class="count-input-row">
                                <label for="essayCount">ÈóÆÁ≠îÈ¢òÔºö</label>
                                <input type="number" id="essayCount" min="0" max="100" value="0">
                                <span class="max-hint" id="essayMaxHint">ÊúÄÂ§ö 0 È¢ò</span>
                            </div>
                        </div>
                        <div class="total-count-display">
                            <span>ÊÄªÈ¢òÁõÆÊï∞Ôºö<strong id="totalQuestionCount">10</strong></span>
                        </div>
                    </div>
                    
                    <div class="setting-group">
                        <label>Êó∂Èó¥ËÆæÁΩÆÔºö</label>
                        <div class="time-setting">
                            <label class="time-option">
                                <input type="radio" name="timeMode" id="noTimeLimit" value="none" checked>
                                <span>Êó†Êó∂Èó¥ÈôêÂà∂</span>
                            </label>
                            <label class="time-option">
                                <input type="radio" name="timeMode" id="hasTimeLimit" value="limited">
                                <span>ÈôêÊó∂ËÄÉËØï</span>
                            </label>
                        </div>
                        <div class="time-input-group" id="timeInputGroup" style="display: none;">
                            <label for="examTimeLimit">ËÄÉËØïÊó∂ÈïøÔºö</label>
                            <input type="number" id="examTimeLimit" min="1" max="300" value="60" placeholder="ÂàÜÈíü">
                            <span>ÂàÜÈíü</span>
                        </div>
                    </div>
                    
                    <div class="setting-actions">
                        <button id="confirmSettings" class="btn btn-primary">‚úÖ ÂºÄÂßãÁ≠îÈ¢ò</button>
                        <button id="cancelSettings" class="btn btn-secondary">‚ùå ÂèñÊ∂à</button>
                    </div>
                </div>
                
                <button id="startExam" class="btn">üöÄ ÂºÄÂßãËÄÉËØï</button>
            </div>

            <!-- ËÄÉËØïÂå∫Âüü -->
            <div id="exam-section" class="section hidden">
                <div class="progress">
                    <div class="progress-bar" id="progressBar"></div>
                </div>
                
                <!-- Êó∂Èó¥ÊòæÁ§∫Âå∫Âüü -->
                <div class="exam-timer" id="examTimer" style="display: none;">
                    <div class="timer-display">
                        <span class="timer-label">Ââ©‰ΩôÊó∂Èó¥Ôºö</span>
                        <span class="timer-value" id="timerValue">60:00</span>
                        <button id="pauseResumeBtn" class="pause-resume-btn" onclick="app.togglePauseResume()">‚è∏Ô∏è ÊöÇÂÅú</button>
                    </div>
                </div>
                
                <div class="exam-duration" id="examDuration" style="display: none;">
                    <div class="duration-display">
                        <span class="duration-label">ËÄÉËØïÁî®Êó∂Ôºö</span>
                        <span class="duration-value" id="durationValue">00:00</span>
                        <button id="pauseResumeBtn2" class="pause-resume-btn" onclick="app.togglePauseResume()">‚è∏Ô∏è ÊöÇÂÅú</button>
                    </div>
                </div>
                
                <div style="text-align: center; margin: 15px 0; color: #666;">
                    <span id="answeredCount">Â∑≤Á≠îÈ¢ò: 0</span> / 
                    <span id="totalCount" class="total-count-toggle" onclick="toggleQuestionStatus()">ÊÄªÈ¢òÊï∞: 0 <span id="toggleIcon">‚ñº</span></span>
                </div>
                <div class="question-status collapsed" id="questionStatus"></div>
                
                <div class="question-container">
                    <div class="question-header">
                        <span class="question-number" id="questionNumber">Á¨¨ 1 È¢ò</span>
                        <span class="question-type" id="questionType">ÂçïÈÄâÈ¢ò</span>
                    </div>
                    
                    <div class="question-text" id="questionText"></div>
                    
                    <div id="optionsContainer" class="options"></div>
                    
                    <div class="navigation">
                        <button id="prevBtn" class="btn btn-secondary" disabled>‚¨ÖÔ∏è ‰∏ä‰∏ÄÈ¢ò</button>
                        <span id="questionProgress">1 / 10</span>
                        <button id="nextBtn" class="btn btn-secondary">‰∏ã‰∏ÄÈ¢ò ‚û°Ô∏è</button>
                        <button id="submitBtn" class="btn btn-danger hidden">üìù ‰∫§Âç∑</button>
                    </div>
                </div>
            </div>

            <!-- ÁªìÊûúÂå∫Âüü -->
            <div id="result-section" class="section hidden">
                <h2>üìà ËÄÉËØïÁªìÊûú</h2>
                <!-- È°µÁ≠æÂØºËà™ -->
                <div class="tab-navigation">
                    <button class="tab-btn active" onclick="showTab('wrong-questions')">ÈîôËØØÈ¢òÁõÆÂ§ç‰π†</button>
                    <button class="tab-btn" onclick="showTab('correct-questions')">Ê≠£Á°ÆÈ¢òÁõÆÂ±ïÁ§∫</button>
                    <button class="tab-btn" onclick="showTab('essay-answers')">ÈóÆÁ≠îÈ¢òÁ≠îÊ°àÂØπÊØî</button>
                </div>
                
                <!-- ÈîôËØØÈ¢òÁõÆÈ°µÁ≠æ -->
                <div id="wrong-questions-tab" class="tab-content active">
                    <div class="stats">
                        <div class="stat-card">
                            <div class="stat-number" id="totalScore">0</div>
                            <div class="stat-label">ÊÄªÂàÜ</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="correctCount">0</div>
                            <div class="stat-label">Ê≠£Á°ÆÈ¢òÊï∞</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="wrongCount">0</div>
                            <div class="stat-label">ÈîôËØØÈ¢òÊï∞</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="accuracy">0%</div>
                            <div class="stat-label">Ê≠£Á°ÆÁéá</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="examTime">00:00</div>
                            <div class="stat-label">ËÄÉËØïÁî®Êó∂</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="avgTimePerQuestion">00:00</div>
                            <div class="stat-label">Âπ≥ÂùáÁî®Êó∂</div>
                        </div>
                    </div>
                    
                    <!-- ‰øùÂ≠òÊï∞ÊçÆÂà∞Â§öÁª¥Ë°®ÊåâÈíÆ -->
                    <div class="save-to-table-container" style="margin: 20px 0; text-align: center;">
                        <button id="saveToTableBtn" class="btn" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; padding: 12px 24px; font-size: 16px; border: none; border-radius: 8px; cursor: pointer; box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3); transition: all 0.3s ease; margin-right: 10px;">üìä ‰øùÂ≠òÂà∞Â§öÁª¥Ë°®</button>
                        <button id="viewTableBtn" class="btn" style="background: linear-gradient(135deg, #007bff 0%, #0056b3 100%); color: white; padding: 12px 24px; font-size: 16px; border: none; border-radius: 8px; cursor: pointer; box-shadow: 0 2px 8px rgba(0, 123, 255, 0.3); transition: all 0.3s ease;">üëÅÔ∏è Êü•ÁúãÂ§öÁª¥Ë°®</button>
                    </div>
                    
                    <div class="wrong-questions" id="wrongQuestions">
                        <div class="wrong-questions-header">
                            <h3>‚ùå ÈîôËØØÈ¢òÁõÆÂ§ç‰π†</h3>
                        </div>
                        <div class="wrong-actions" style="display: none;" id="wrongActions">
                            <div class="export-controls" id="exportWrongControls">
                                <select id="wrongExportFormat" class="format-selector">
                                    <option value="csv">üìÑ CSVÊ†ºÂºè</option>
                                    <option value="xlsx">üìä ExcelÊ†ºÂºè</option>
                                </select>
                                <button id="exportWrongBtn" class="export-btn btn btn-secondary">üì• ÂØºÂá∫ÈîôÈ¢ò</button>
                            </div>
                            <button id="retakeWrongBtn" class="export-btn btn btn-primary" style="background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);">üîÑ ÈîôÈ¢òÈáçËÄÉ</button>
                        </div>
                    </div>
                </div>
                
                <!-- Ê≠£Á°ÆÈ¢òÁõÆÂ±ïÁ§∫È°µÁ≠æ -->
                <div id="correct-questions-tab" class="tab-content">
                    <div class="correct-questions" id="correctQuestions">
                        <div class="correct-questions-header">
                            <h3>‚úÖ Ê≠£Á°ÆÈ¢òÁõÆÂ±ïÁ§∫</h3>
                        </div>
                        <div class="export-buttons">
                            <div class="export-controls" style="display: none;" id="exportCorrectControls">
                                <select id="correctExportFormat" class="format-selector">
                                    <option value="csv">üìÑ CSVÊ†ºÂºè</option>
                                    <option value="xlsx">üìä ExcelÊ†ºÂºè</option>
                                </select>
                                <button id="exportCorrectBtn" class="export-btn btn btn-secondary">üì• ÂØºÂá∫Ê≠£Á°ÆÈ¢òÁõÆ</button>
                            </div>
                            <div class="export-controls" style="display: none;" id="exportAllControls">
                                <select id="allExportFormat" class="format-selector">
                                    <option value="csv">üìÑ CSVÊ†ºÂºè</option>
                                    <option value="xlsx">üìä ExcelÊ†ºÂºè</option>
                                </select>
                                <button id="exportAllBtn" class="export-btn btn btn-secondary">üì• ÂØºÂá∫ÂÖ®ÈÉ®È¢òÁõÆ</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ÈóÆÁ≠îÈ¢òÁ≠îÊ°àÂØπÊØîÈ°µÁ≠æ -->
                <div id="essay-answers-tab" class="tab-content">
                    <div class="essay-answers" id="essayAnswers">
                        <h3>üìù ÈóÆÁ≠îÈ¢òÁ≠îÊ°àÂØπÊØî</h3>
                    </div>
                </div>
                
                <button id="restartBtn" class="btn">üîÑ ÈáçÊñ∞ÂºÄÂßã</button>
            </div>
        </div>
    </div>

    <!-- Á≠îÊ°à‰øùÂ≠òÊèêÁ§∫ -->
    <div id="answerSavedNotification" class="answer-saved">
        ‚úì Á≠îÊ°àÂ∑≤‰øùÂ≠ò
    </div>

    <!-- ‰øùÂ≠òÂà∞Â§öÁª¥Ë°®ÂºπÁ™ó -->
    <div id="saveToTableModal" class="modal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5);">
        <div class="modal-content" style="background-color: #fefefe; margin: 15% auto; padding: 20px; border: none; border-radius: 12px; width: 90%; max-width: 400px; box-shadow: 0 4px 20px rgba(0,0,0,0.3);">
            <div class="modal-header" style="text-align: center; margin-bottom: 20px;">
                <h3 style="margin: 0; color: #333; font-size: 20px;">üìä ‰øùÂ≠òÊï∞ÊçÆÂà∞Â§öÁª¥Ë°®</h3>
            </div>
            <div class="modal-body">
                <label for="userName" style="display: block; margin-bottom: 8px; font-weight: bold; color: #555;">ËØ∑ËæìÂÖ•Áî®Êà∑ÂêçÁß∞Ôºö</label>
                <input type="text" id="userName" placeholder="ËØ∑ËæìÂÖ•ÊÇ®ÁöÑÂßìÂêç" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 6px; font-size: 16px; box-sizing: border-box; margin-bottom: 20px;" />
            </div>
            <div class="modal-footer" style="text-align: center;">
                <button id="confirmSaveBtn" class="btn" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; padding: 10px 20px; margin-right: 10px; border: none; border-radius: 6px; cursor: pointer; font-size: 14px;">‚úì Á°ÆËÆ§‰øùÂ≠ò</button>
                <button id="cancelSaveBtn" class="btn" style="background: #6c757d; color: white; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-size: 14px;">‚úï ÂèñÊ∂à</button>
            </div>
        </div>
    </div>

    <script>
        class QuestionBank {
            constructor() {
                // ÁâàÊú¨‰ø°ÊÅØ
                this.version = "v3.5.5"; // ÂèØÊâãÂä®‰øÆÊîπÁâàÊú¨Âè∑
                
                this.questions = [];
                this.allQuestions = []; // ‰øùÂ≠òÂÆåÊï¥ÁöÑÈ¢òÁõÆÂàóË°®
                this.currentQuestionIndex = 0;
                this.userAnswers = [];
                this.wrongQuestionsData = null;
                this.correctQuestionsData = null; // Â≠òÂÇ®Ê≠£Á°ÆÈ¢òÁõÆÊï∞ÊçÆ
                this.answeredQuestions = new Set(); // ËÆ∞ÂΩïÂ∑≤ÂõûÁ≠îÁöÑÈ¢òÁõÆ
                this.selectedFile = null; // ÂΩìÂâçÈÄâ‰∏≠ÁöÑÊñá‰ª∂
                this.detectedFiles = []; // Ê£ÄÊµãÂà∞ÁöÑÊñá‰ª∂ÂàóË°®
                
                // Êó∂Èó¥ÁÆ°ÁêÜÁõ∏ÂÖ≥ÂèòÈáè
                this.examStartTime = null; // ËÄÉËØïÂºÄÂßãÊó∂Èó¥
                this.examEndTime = null; // ËÄÉËØïÁªìÊùüÊó∂Èó¥
                this.examTimeLimit = null; // ËÄÉËØïÊó∂Èó¥ÈôêÂà∂ÔºàÂàÜÈíüÔºâ
                this.timerInterval = null; // ËÆ°Êó∂Âô®Èó¥Èöî
                this.isTimeLimited = false; // ÊòØÂê¶ÊúâÊó∂Èó¥ÈôêÂà∂
                
                // ÊöÇÂÅúÂäüËÉΩÁõ∏ÂÖ≥ÂèòÈáè
                this.isPaused = false; // ÊòØÂê¶ÊöÇÂÅú
                this.pausedTime = 0; // Á¥ØËÆ°ÊöÇÂÅúÊó∂Èó¥ÔºàÊØ´ÁßíÔºâ
                this.pauseStartTime = null; // ÊöÇÂÅúÂºÄÂßãÊó∂Èó¥
                
                // ÈîôÈ¢òÈáçËÄÉÁõ∏ÂÖ≥ÂèòÈáè
                this.isRetakeMode = false; // ÊòØÂê¶‰∏∫ÈîôÈ¢òÈáçËÄÉÊ®°Âºè
                this.retakeQuestions = null; // ÈîôÈ¢òÈáçËÄÉÁöÑÈ¢òÁõÆÂàóË°®
                
                this.initEventListeners();
                this.detectCSVFiles(); // Ëá™Âä®Ê£ÄÊµãCSVÊñá‰ª∂
                this.displayVersion(); // ÊòæÁ§∫ÁâàÊú¨Âè∑
            }

            initEventListeners() {
                document.getElementById('csvFile').addEventListener('change', this.handleFileSelect.bind(this));
                document.getElementById('parseBtn').addEventListener('click', this.parseCSV.bind(this));
                document.getElementById('startExam').addEventListener('click', this.showExamSettings.bind(this));
                document.getElementById('confirmSettings').addEventListener('click', this.startExamWithSettings.bind(this));
                document.getElementById('cancelSettings').addEventListener('click', this.hideExamSettings.bind(this));
                document.getElementById('prevBtn').addEventListener('click', this.previousQuestion.bind(this));
                document.getElementById('nextBtn').addEventListener('click', this.nextQuestion.bind(this));
                document.getElementById('submitBtn').addEventListener('click', this.submitExam.bind(this));
                document.getElementById('restartBtn').addEventListener('click', this.restart.bind(this));
                // ÂØºÂá∫‰∏ãÊãâËèúÂçï‰∫ã‰ª∂ÁõëÂê¨Âô®
                this.initExportEventListeners();
                
                // È¢òÂûãÈÄâÊã©ÂäüËÉΩÂ∑≤ÁßªÈô§ÔºåÁé∞Âú®ÈÄöËøáÊï∞ÈáèËÆæÁΩÆÊù•ÊéßÂà∂
                
                // ÂêÑÈ¢òÂûãÊï∞ÈáèËæìÂÖ•ÂèòÂåñÊó∂È™åËØÅÂíåÊõ¥Êñ∞ÊÄªÊï∞
                ['singleCount', 'multiCount', 'trueOrFalseCount', 'essayCount'].forEach(id => {
                    document.getElementById(id).addEventListener('input', this.updateTotalCount.bind(this));
                });
                
                // Êó∂Èó¥ËÆæÁΩÆ‰∫ã‰ª∂ÁõëÂê¨Âô®
                document.getElementById('noTimeLimit').addEventListener('change', this.toggleTimeInput.bind(this));
                document.getElementById('hasTimeLimit').addEventListener('change', this.toggleTimeInput.bind(this));
                
                // Èò≤Ê≠¢ÁßªÂä®Á´Ø‰∏ãÊãâÂà∑Êñ∞ÁöÑ‰∫ã‰ª∂ÁõëÂê¨Âô®
                this.initTouchPreventListeners();
                
                // ‰øùÂ≠òÂà∞Â§öÁª¥Ë°®‰∫ã‰ª∂ÁõëÂê¨Âô®
                this.initSaveToTableListeners();
            }
            
            initTouchPreventListeners() {
                // Èò≤Ê≠¢ÁßªÂä®Á´Ø‰∏ãÊãâÂà∑Êñ∞
                let startY = 0;
                
                document.addEventListener('touchstart', (e) => {
                    startY = e.touches[0].clientY;
                }, { passive: false });
                
                document.addEventListener('touchmove', (e) => {
                    const currentY = e.touches[0].clientY;
                    const scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
                    
                    // Â¶ÇÊûúÂú®È°µÈù¢È°∂ÈÉ®‰∏îÂêë‰∏ãÊªëÂä®ÔºåÈòªÊ≠¢ÈªòËÆ§Ë°å‰∏∫
                    if (scrollTop === 0 && currentY > startY) {
                        e.preventDefault();
                    }
                    
                    // Â¶ÇÊûúÂú®È°µÈù¢Â∫ïÈÉ®‰∏îÂêë‰∏äÊªëÂä®ÔºåÈòªÊ≠¢ÈªòËÆ§Ë°å‰∏∫
                    const scrollHeight = document.documentElement.scrollHeight || document.body.scrollHeight;
                    const clientHeight = document.documentElement.clientHeight || window.innerHeight;
                    if (scrollTop + clientHeight >= scrollHeight && currentY < startY) {
                        e.preventDefault();
                    }
                }, { passive: false });
            }
            
            initExportEventListeners() {
                // ÈîôÈ¢òÂØºÂá∫‰∫ã‰ª∂ÁõëÂê¨Âô®
                const exportWrongBtn = document.getElementById('exportWrongBtn');
                if (exportWrongBtn) {
                    exportWrongBtn.addEventListener('click', () => {
                        const formatSelector = document.getElementById('wrongExportFormat');
                        const format = formatSelector ? formatSelector.value : 'csv';
                        this.exportWrongQuestions(format);
                    });
                }
                
                // ÈîôÈ¢òÈáçËÄÉ‰∫ã‰ª∂ÁõëÂê¨Âô®
                const retakeWrongBtn = document.getElementById('retakeWrongBtn');
                if (retakeWrongBtn) {
                    retakeWrongBtn.addEventListener('click', () => {
                        this.retakeWrongQuestions();
                    });
                }
                
                // Ê≠£Á°ÆÈ¢òÁõÆÂØºÂá∫‰∫ã‰ª∂ÁõëÂê¨Âô®
                const exportCorrectBtn = document.getElementById('exportCorrectBtn');
                if (exportCorrectBtn) {
                    exportCorrectBtn.addEventListener('click', () => {
                        const formatSelector = document.getElementById('correctExportFormat');
                        const format = formatSelector ? formatSelector.value : 'csv';
                        this.exportCorrectQuestions(format);
                    });
                }
                
                // ÂÖ®ÈÉ®È¢òÁõÆÂØºÂá∫‰∫ã‰ª∂ÁõëÂê¨Âô®
                const exportAllBtn = document.getElementById('exportAllBtn');
                if (exportAllBtn) {
                    exportAllBtn.addEventListener('click', () => {
                        const formatSelector = document.getElementById('allExportFormat');
                        const format = formatSelector ? formatSelector.value : 'csv';
                        this.exportAllQuestions(format);
                    });
                }
            }
            
            initSaveToTableListeners() {
                // ‰øùÂ≠òÂà∞Â§öÁª¥Ë°®ÊåâÈíÆ‰∫ã‰ª∂ÁõëÂê¨Âô®
                const saveToTableBtn = document.getElementById('saveToTableBtn');
                if (saveToTableBtn) {
                    saveToTableBtn.addEventListener('click', () => {
                        this.showSaveToTableModal();
                    });
                }
                
                // Êü•ÁúãÂ§öÁª¥Ë°®ÊåâÈíÆ‰∫ã‰ª∂ÁõëÂê¨Âô®
                const viewTableBtn = document.getElementById('viewTableBtn');
                if (viewTableBtn) {
                    viewTableBtn.addEventListener('click', () => {
                        // È£û‰π¶Â§öÁª¥Ë°®ÈìæÊé•Âú∞ÂùÄÔºåÂèØÂú®Ê≠§Â§Ñ‰øÆÊîπ
                        const tableUrl = 'https://more2.feishu.cn/wiki/NEXXw0M6Micnfikr6MEcvZe1nXr?table=tbljG2LmtiCazz1W&view=vewAKqlLr5';
                        window.open(tableUrl, '_blank');
                    });
                }
                
                // Á°ÆËÆ§‰øùÂ≠òÊåâÈíÆ‰∫ã‰ª∂ÁõëÂê¨Âô®
                const confirmSaveBtn = document.getElementById('confirmSaveBtn');
                if (confirmSaveBtn) {
                    confirmSaveBtn.addEventListener('click', () => {
                        this.saveToFeishuTable();
                    });
                }
                
                // ÂèñÊ∂à‰øùÂ≠òÊåâÈíÆ‰∫ã‰ª∂ÁõëÂê¨Âô®
                const cancelSaveBtn = document.getElementById('cancelSaveBtn');
                if (cancelSaveBtn) {
                    cancelSaveBtn.addEventListener('click', () => {
                        this.hideSaveToTableModal();
                    });
                }
                
                // ÁÇπÂáªÂºπÁ™óÂ§ñÈÉ®ÂÖ≥Èó≠ÂºπÁ™ó
                const modal = document.getElementById('saveToTableModal');
                if (modal) {
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) {
                            this.hideSaveToTableModal();
                        }
                    });
                }
                
                // Áî®Êà∑ÂêçËæìÂÖ•Ê°ÜÂõûËΩ¶ÈîÆÁ°ÆËÆ§
                const userNameInput = document.getElementById('userName');
                if (userNameInput) {
                    userNameInput.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            this.saveToFeishuTable();
                        }
                    });
                }
            }
            
            showSaveToTableModal() {
                const modal = document.getElementById('saveToTableModal');
                const userNameInput = document.getElementById('userName');
                if (modal && userNameInput) {
                    modal.style.display = 'block';
                    userNameInput.value = '';
                    userNameInput.focus();
                }
            }
            
            hideSaveToTableModal() {
                const modal = document.getElementById('saveToTableModal');
                if (modal) {
                    modal.style.display = 'none';
                }
            }
            
            async saveToFeishuTable() {
                const userNameInput = document.getElementById('userName');
                const userName = userNameInput.value.trim();
                
                if (!userName) {
                    alert('ËØ∑ËæìÂÖ•Áî®Êà∑ÂêçÁß∞');
                    userNameInput.focus();
                    return;
                }
                
                // Ëé∑ÂèñËÄÉËØïÊï∞ÊçÆ
                const totalScore = document.getElementById('totalScore').textContent;
                const correctCount = document.getElementById('correctCount').textContent;
                const wrongCount = document.getElementById('wrongCount').textContent;
                const accuracy = document.getElementById('accuracy').textContent;
                const examTime = document.getElementById('examTime').textContent;
                
                // ÂáÜÂ§áÂèëÈÄÅÁöÑÊï∞ÊçÆ
                const avgTimePerQuestion = this.getAverageTimePerQuestion();
                const data = {
                    Áî®Êà∑ÂêçÁß∞: userName,
                    ÊÄªÂàÜ: totalScore,
                    Ê≠£Á°ÆÈ¢òÊï∞: correctCount,
                    ÈîôËØØÈ¢òÊï∞: wrongCount,
                    Ê≠£Á°ÆÁéá: accuracy,
                    ËÄÉËØïÁî®Êó∂: examTime,
                    Âπ≥ÂùáÁî®Êó∂: avgTimePerQuestion,
                    Êèê‰∫§Êó∂Èó¥: new Date().toLocaleString('zh-CN')
                };
                
                try {
                    // ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅ
                    const confirmBtn = document.getElementById('confirmSaveBtn');
                    const originalText = confirmBtn.textContent;
                    confirmBtn.textContent = '‰øùÂ≠ò‰∏≠...';
                    confirmBtn.disabled = true;
                    
                    // ‰ΩøÁî®‰ª£ÁêÜÊúçÂä°Âô®Ëß£ÂÜ≥CORSÈóÆÈ¢ò
                    const proxyUrl = 'https://cors-anywhere.herokuapp.com/';
                    const webhookUrl = 'https://more2.feishu.cn/base/automation/webhook/event/XVQuaSLWZw3cAKhOUULcAnpHnJh';
                    
                    // Â∞ùËØïÁõ¥Êé•ÂèëÈÄÅÔºåÂ¶ÇÊûúÂ§±Ë¥•Âàô‰ΩøÁî®Â§áÁî®ÊñπÊ°à
                    let response;
                    try {
                        response = await fetch(webhookUrl, {
                            method: 'POST',
                            mode: 'no-cors',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(data)
                        });
                        
                        // no-corsÊ®°Âºè‰∏ãÊó†Ê≥ïËé∑ÂèñÂìçÂ∫îÁä∂ÊÄÅÔºåÂÅáËÆæÊàêÂäü
                         alert('Êï∞ÊçÆÂ∑≤ÂèëÈÄÅÔºÅ');
                        this.hideSaveToTableModal();
                        
                    } catch (error) {
                        // Â¶ÇÊûúÁõ¥Êé•ÂèëÈÄÅÂ§±Ë¥•ÔºåÂ∞ùËØï‰ΩøÁî®‰ª£ÁêÜ
                        console.log('Áõ¥Êé•ÂèëÈÄÅÂ§±Ë¥•ÔºåÂ∞ùËØï‰ΩøÁî®‰ª£ÁêÜÊúçÂä°Âô®...');
                        response = await fetch(proxyUrl + webhookUrl, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-Requested-With': 'XMLHttpRequest'
                            },
                            body: JSON.stringify(data)
                        });
                        
                        if (response.ok) {
                            alert('Êï∞ÊçÆ‰øùÂ≠òÊàêÂäüÔºÅ');
                            this.hideSaveToTableModal();
                        } else {
                            throw new Error(`‰øùÂ≠òÂ§±Ë¥•: ${response.status}`);
                        }
                    }
                    
                } catch (error) {
                    console.error('‰øùÂ≠òÊï∞ÊçÆÂà∞Â§öÁª¥Ë°®Â§±Ë¥•:', error);
                    
                    // Êèê‰æõÂ§áÁî®ÊñπÊ°àÔºöÂ§çÂà∂Êï∞ÊçÆÂà∞Ââ™Ë¥¥Êùø
                    const dataText = `Áî®Êà∑ÂêçÁß∞: ${userName}\nÊÄªÂàÜ: ${totalScore}\nÊ≠£Á°ÆÈ¢òÊï∞: ${correctCount}\nÈîôËØØÈ¢òÊï∞: ${wrongCount}\nÊ≠£Á°ÆÁéá: ${accuracy}\nËÄÉËØïÁî®Êó∂: ${examTime}\nÂπ≥ÂùáÁî®Êó∂: ${avgTimePerQuestion}\nÊèê‰∫§Êó∂Èó¥: ${new Date().toLocaleString('zh-CN')}`;
                    
                    try {
                        await navigator.clipboard.writeText(dataText);
                        alert('Áî±‰∫éÁΩëÁªúÈôêÂà∂ÔºåÊï∞ÊçÆÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥ÊùøÔºåËØ∑ÊâãÂä®Á≤òË¥¥Âà∞È£û‰π¶Â§öÁª¥Ë°®‰∏≠„ÄÇ');
                        this.hideSaveToTableModal();
                    } catch (clipboardError) {
                        alert(`‰øùÂ≠òÂ§±Ë¥•: ${error.message}\n\nËØ∑ÊâãÂä®ËÆ∞ÂΩï‰ª•‰∏ãÊï∞ÊçÆÔºö\n${dataText}`);
                    }
                } finally {
                    // ÊÅ¢Â§çÊåâÈíÆÁä∂ÊÄÅ
                    const confirmBtn = document.getElementById('confirmSaveBtn');
                    confirmBtn.textContent = '‚úì Á°ÆËÆ§‰øùÂ≠ò';
                    confirmBtn.disabled = false;
                }
            }

            async detectCSVFiles() {
                try {
                    const fileList = document.getElementById('fileList');
                    fileList.innerHTML = '<p class="loading-message">Ê≠£Âú®Ê£ÄÊµãÈ¢òÂ∫ìÊñá‰ª∂...</p>';
                    
                    // Ê£ÄÊµãÂêåÁõÆÂΩï‰∏ãÁöÑÈ¢òÂ∫ìÊñá‰ª∂ÔºàCSVÂíåExcelÔºâ
                    // Áî±‰∫éÊµèËßàÂô®CORSÈôêÂà∂ÔºåÂè™ËÉΩÊ£ÄÊµãÈÄöËøáHTTPÊúçÂä°Âô®ËÆøÈóÆÁöÑÊñá‰ª∂
                    const knownFiles = [
                        'AIÂØºÂ∏àËÄÉÈ¢ò_Êï∞ÊçÆË°®_Ë°®Ê†º.csv',
                        'AIÂØºÂ∏àËÄÉÈ¢ò_Êï∞ÊçÆË°®_Ë°®Ê†º.xlsx',
                        'È¢òÂ∫ì.csv',
                        'È¢òÂ∫ì.xlsx'
                    ];
                    const availableFiles = [];
                    
                    for (const fileName of knownFiles) {
                        try {
                            // ‰ΩøÁî®HEADËØ∑Ê±ÇÊ£ÄÊµãÊñá‰ª∂ÊòØÂê¶Â≠òÂú®
                            const response = await fetch(fileName, { method: 'HEAD' });
                            if (response.ok) {
                                availableFiles.push(fileName);
                            }
                        } catch (error) {
                            console.log(`Êñá‰ª∂ ${fileName} ‰∏çÂèØËÆøÈóÆ:`, error.message);
                        }
                    }
                    
                    fileList.innerHTML = '';
                    
                    if (availableFiles.length === 0) {
                        fileList.innerHTML = `
                            <div class="no-files-message">
                                <p>‚ö†Ô∏è Êú™Ê£ÄÊµãÂà∞ÂèØËÆøÈóÆÁöÑÈ¢òÂ∫ìÊñá‰ª∂</p>
                                <p style="font-size: 12px; color: #666; margin-top: 8px;">
                                    ÊèêÁ§∫ÔºöËØ∑Á°Æ‰øùÈÄöËøáHTTPÊúçÂä°Âô®ËÆøÈóÆÊ≠§È°µÈù¢ÔºåÊàñ‰ΩøÁî®‰∏ãÊñπÁöÑÊâãÂä®‰∏ä‰º†ÂäüËÉΩ
                                </p>
                            </div>
                        `;
                        return;
                    }
                    
                    availableFiles.forEach(fileName => {
                        const fileItem = document.createElement('div');
                        fileItem.className = 'file-item';
                        const fileIcon = fileName.toLowerCase().endsWith('.xlsx') ? 'üìä' : 'üìÑ';
                        fileItem.innerHTML = `
                            <span class="file-name">${fileIcon} ${fileName}</span>
                            <span class="file-size">‚úÖ ÂèØÁî®</span>
                        `;
                        
                        fileItem.addEventListener('click', () => {
                            this.selectDetectedFile(fileName, fileItem);
                        });
                        
                        fileList.appendChild(fileItem);
                    });
                    
                } catch (error) {
                    console.error('Ê£ÄÊµãÈ¢òÂ∫ìÊñá‰ª∂Â§±Ë¥•:', error);
                    document.getElementById('fileList').innerHTML = `
                        <div class="no-files-message">
                            <p>‚ùå Ê£ÄÊµãÊñá‰ª∂Êó∂Âá∫Èîô</p>
                            <p style="font-size: 12px; color: #666; margin-top: 8px;">
                                ËØ∑‰ΩøÁî®‰∏ãÊñπÁöÑÊâãÂä®‰∏ä‰º†ÂäüËÉΩ
                            </p>
                        </div>
                    `;
                }
            }
            
            selectDetectedFile(fileName, fileElement) {
                // Ê∏ÖÈô§‰πãÂâçÁöÑÈÄâ‰∏≠Áä∂ÊÄÅ
                document.querySelectorAll('.file-item').forEach(item => {
                    item.classList.remove('selected');
                });
                
                // ËÆæÁΩÆÂΩìÂâçÈÄâ‰∏≠Áä∂ÊÄÅ
                fileElement.classList.add('selected');
                this.selectedFile = fileName;
                
                // Ê∏ÖÈô§ÊâãÂä®‰∏ä‰º†ÁöÑÊñá‰ª∂ÈÄâÊã©
                document.getElementById('csvFile').value = '';
                
                // ÊòæÁ§∫Êñá‰ª∂‰ø°ÊÅØ
                const fileInfo = document.getElementById('file-info');
                fileInfo.querySelector('p').textContent = `Ê≠£Âú®Ëß£ÊûêÊñá‰ª∂: ${fileName}...`;
                fileInfo.classList.remove('hidden');
                
                // Ëá™Âä®Ëß£ÊûêÊñá‰ª∂
                this.parseCSV();
            }

            handleFileSelect(event) {
                const file = event.target.files[0];
                if (file) {
                    // Ê∏ÖÈô§Ê£ÄÊµãÊñá‰ª∂ÁöÑÈÄâ‰∏≠Áä∂ÊÄÅ
                    document.querySelectorAll('.file-item').forEach(item => {
                        item.classList.remove('selected');
                    });
                    this.selectedFile = null;
                    
                    document.getElementById('file-info').classList.remove('hidden');
                    document.getElementById('file-info').querySelector('p').textContent = `Ê≠£Âú®Ëß£ÊûêÊñá‰ª∂: ${file.name}...`;
                    
                    // Ëá™Âä®Ëß£ÊûêÊñá‰ª∂
                    this.parseCSV();
                }
            }

            displayVersion() {
                // Âú®È°µÈù¢‰∏äÊòæÁ§∫ÁâàÊú¨Âè∑
                const versionElement = document.getElementById('version-display');
                if (versionElement) {
                    versionElement.textContent = this.version;
                }
            }

            async parseCSV() {
                const fileInput = document.getElementById('csvFile');
                const uploadedFile = fileInput.files[0];
                
                if (uploadedFile) {
                    // Â§ÑÁêÜÊâãÂä®‰∏ä‰º†ÁöÑÊñá‰ª∂
                    const fileName = uploadedFile.name.toLowerCase();
                    
                    if (fileName.endsWith('.xlsx')) {
                        // Â§ÑÁêÜExcelÊñá‰ª∂
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            try {
                                const data = new Uint8Array(e.target.result);
                                const workbook = XLSX.read(data, { type: 'array' });
                                const firstSheetName = workbook.SheetNames[0];
                                const worksheet = workbook.Sheets[firstSheetName];
                                const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                                this.processExcelData(jsonData);
                            } catch (error) {
                                console.error('Ëß£ÊûêExcelÊñá‰ª∂Â§±Ë¥•:', error);
                                alert(`Ëß£ÊûêExcelÊñá‰ª∂Â§±Ë¥•: ${error.message}`);
                            }
                        };
                        reader.readAsArrayBuffer(uploadedFile);
                    } else if (fileName.endsWith('.csv')) {
                        // Â§ÑÁêÜCSVÊñá‰ª∂
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            const csv = e.target.result;
                            this.processCSVData(csv);
                        };
                        reader.readAsText(uploadedFile, 'UTF-8');
                    } else {
                        alert('‰∏çÊîØÊåÅÁöÑÊñá‰ª∂Ê†ºÂºèÔºåËØ∑ÈÄâÊã©CSVÊàñExcelÊñá‰ª∂');
                        return;
                    }
                } else if (this.selectedFile) {
                    // Â§ÑÁêÜÊ£ÄÊµãÂà∞ÁöÑÊñá‰ª∂ÔºàCSVÊàñExcelÔºâ
                    try {
                        const fileName = this.selectedFile.toLowerCase();
                        const response = await fetch(this.selectedFile);
                        if (!response.ok) {
                            throw new Error(`Êó†Ê≥ïÂä†ËΩΩÊñá‰ª∂: ${response.status}`);
                        }
                        
                        if (fileName.endsWith('.xlsx')) {
                            // Â§ÑÁêÜExcelÊñá‰ª∂
                            const arrayBuffer = await response.arrayBuffer();
                            const data = new Uint8Array(arrayBuffer);
                            const workbook = XLSX.read(data, { type: 'array' });
                            const firstSheetName = workbook.SheetNames[0];
                            const worksheet = workbook.Sheets[firstSheetName];
                            const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                            this.processExcelData(jsonData);
                        } else {
                            // Â§ÑÁêÜCSVÊñá‰ª∂
                            const csv = await response.text();
                            this.processCSVData(csv);
                        }
                    } catch (error) {
                        console.error('Âä†ËΩΩÊñá‰ª∂Â§±Ë¥•:', error);
                        alert(`Âä†ËΩΩÊñá‰ª∂Â§±Ë¥•: ${error.message}`);
                    }
                } else {
                    alert('ËØ∑ÂÖàÈÄâÊã©È¢òÂ∫ìÊñá‰ª∂');
                }
            }

            processCSVData(csv) {
                const lines = csv.split('\n').filter(line => line.trim());
                this.questions = [];
                this.allQuestions = []; // ÈáçÁΩÆÂÆåÊï¥È¢òÁõÆÂàóË°®

                // Ë∑≥ËøáÊ†áÈ¢òË°å
                for (let i = 1; i < lines.length; i++) {
                    const columns = this.parseCSVLine(lines[i]);
                    if (columns.length >= 6) {
                        const question = {
                            id: columns[0].trim(),
                            type: columns[1].trim(),
                            question: columns[2].trim(),
                            options: columns[3].trim(),
                            answer: columns[4].trim(),
                            explanation: columns[5].trim()
                        };
                        this.questions.push(question);
                        this.allQuestions.push(question); // ÂêåÊó∂‰øùÂ≠òÂà∞ÂÆåÊï¥ÂàóË°®
                    }
                }

                this.displayLibraryInfo();
            }

            processExcelData(jsonData) {
                this.questions = [];
                this.allQuestions = []; // ÈáçÁΩÆÂÆåÊï¥È¢òÁõÆÂàóË°®

                console.log('ExcelÊï∞ÊçÆËß£ÊûêÂºÄÂßãÔºåÊÄªË°åÊï∞:', jsonData.length);
                console.log('Ê†áÈ¢òË°å:', jsonData[0]);
                console.log('Ââç5Ë°åÂéüÂßãÊï∞ÊçÆ:', jsonData.slice(0, 5));

                // Ë∑≥ËøáÊ†áÈ¢òË°åÔºàÁ¨¨‰∏ÄË°åÔºâ
                for (let i = 1; i < jsonData.length; i++) {
                    const row = jsonData[i];
                    console.log(`Á¨¨${i}Ë°åÂéüÂßãÊï∞ÊçÆ:`, row);
                    
                    if (row && row.length >= 5) {
                        // Â¶ÇÊûúÂè™Êúâ5ÂàóÔºåË°•ÂÖÖÁ¨¨6Âàó‰∏∫Á©∫Â≠óÁ¨¶‰∏≤
                        if (row.length === 5) {
                            row.push('');
                            console.log(`Á¨¨${i}Ë°åË°•ÂÖÖÁ¨¨6Âàó‰∏∫Á©∫Â≠óÁ¨¶‰∏≤`);
                        }
                        
                        const question = {
                            id: String(row[0] || '').trim(),
                            type: String(row[1] || '').trim(),
                            question: String(row[2] || '').trim(),
                            options: String(row[3] || '').trim(),
                            answer: String(row[4] || '').trim(),
                            explanation: String(row[5] || '').trim()
                        };
                        
                        // Ë∞ÉËØïËæìÂá∫ÔºöÊòæÁ§∫È¢òÁõÆÁ±ªÂûã
                        console.log(`Á¨¨${i}Ë°å - ÂéüÂßãÁ±ªÂûã: "${row[1]}", Â§ÑÁêÜÂêéÁ±ªÂûã: "${question.type}"`);
                        console.log(`Á¨¨${i}Ë°åÂÆåÊï¥È¢òÁõÆÂØπË±°:`, question);
                        
                        // Á°Æ‰øùÂøÖË¶ÅÂ≠óÊÆµ‰∏ç‰∏∫Á©∫
                        if (question.id && question.type && question.question) {
                            this.questions.push(question);
                            this.allQuestions.push(question); // ÂêåÊó∂‰øùÂ≠òÂà∞ÂÆåÊï¥ÂàóË°®
                            console.log(`Á¨¨${i}Ë°åÈ¢òÁõÆÂ∑≤Ê∑ªÂä†ÔºåÂΩìÂâçÊÄªÊï∞: ${this.allQuestions.length}`);
                        } else {
                            console.log(`Á¨¨${i}Ë°åÊï∞ÊçÆ‰∏çÂÆåÊï¥ÔºåË∑≥Ëøá:`, question);
                        }
                    } else {
                        console.log(`Á¨¨${i}Ë°åÊï∞ÊçÆÊ†ºÂºè‰∏çÊ≠£Á°ÆÔºåÂàóÊï∞:`, row ? row.length : 0);
                    }
                }

                // ÁªüËÆ°ÂêÑÈ¢òÂûãÊï∞Èáè
                const typeStats = {};
                this.allQuestions.forEach(q => {
                    typeStats[q.type] = (typeStats[q.type] || 0) + 1;
                });
                console.log('È¢òÂûãÁªüËÆ°:', typeStats);
                console.log('ÈóÆÁ≠îÈ¢òÂàóË°®:', this.allQuestions.filter(q => q.type === 'ÈóÆÁ≠îÈ¢ò'));

                this.displayLibraryInfo();
            }

            parseCSVLine(line) {
                const result = [];
                let current = '';
                let inQuotes = false;
                
                for (let i = 0; i < line.length; i++) {
                    const char = line[i];
                    
                    if (char === '"') {
                        inQuotes = !inQuotes;
                    } else if (char === ',' && !inQuotes) {
                        result.push(current);
                        current = '';
                    } else {
                        current += char;
                    }
                }
                
                result.push(current);
                return result;
            }

            displayLibraryInfo() {
                const stats = {
                    total: this.allQuestions.length,
                    single: this.allQuestions.filter(q => q.type === 'ÂçïÈÄâÈ¢ò').length,
                    multi: this.allQuestions.filter(q => q.type === 'Â§öÈÄâÈ¢ò').length,
                    trueOrFalse: this.allQuestions.filter(q => q.type === 'Âà§Êñ≠È¢ò').length,
                    essay: this.allQuestions.filter(q => q.type === 'ÈóÆÁ≠îÈ¢ò').length
                };

                // ËÆ°ÁÆóÂ∑≤Á≠îÈ¢òÁõÆÂíåÂâ©‰ΩôÈ¢òÁõÆ
                const answeredCount = this.answeredQuestions.size;
                const remainingCount = stats.total - answeredCount;
                
                document.getElementById('totalQuestions').textContent = stats.total;
                document.getElementById('singleChoice').textContent = stats.single;
                document.getElementById('multiChoice').textContent = stats.multi;
                document.getElementById('trueOrFalse').textContent = stats.trueOrFalse;
                document.getElementById('essay').textContent = stats.essay;
                
                // ÁßªÈô§‰πãÂâçÁöÑËøõÂ∫¶‰ø°ÊÅØÔºàÂ¶ÇÊûúÂ≠òÂú®Ôºâ
                const existingProgress = document.querySelector('.progress-info');
                if (existingProgress) {
                    existingProgress.remove();
                }
                
                // Êõ¥Êñ∞ËÄÉËØïËÆæÁΩÆÂå∫ÂüüÁöÑÂèØÁî®È¢òÁõÆÊï∞Èáè
                this.updateAvailableQuestions();
                
                // ÈöêËóèÂºÄÂßãËÄÉËØïÊåâÈíÆÔºåÂõ†‰∏∫Áõ¥Êé•ËøõÂÖ•ËÄÉËØïËÆæÁΩÆ
                const startBtn = document.getElementById('startExam');
                if (startBtn) {
                    startBtn.style.display = 'none';
                }

                document.getElementById('import-section').classList.add('hidden');
                document.getElementById('library-section').classList.remove('hidden');
                
                // Áõ¥Êé•ÊòæÁ§∫ËÄÉËØïËÆæÁΩÆÁïåÈù¢ÔºåË∑≥ËøáÁÇπÂáªËÄÉËØïËÆæÁΩÆÊåâÈíÆÁöÑÁéØËäÇ
                this.showExamSettingsDirectly();
            }
            
            showExamSettingsDirectly() {
                // Áõ¥Êé•ÊòæÁ§∫ËÄÉËØïËÆæÁΩÆÂå∫ÂüüÔºå‰∏çÈúÄË¶ÅÊ£ÄÊü•È¢òÂ∫ìÊòØÂê¶Â≠òÂú®ÔºàÂ∑≤Âú®displayLibraryInfo‰∏≠Á°Æ‰øùÔºâ
                document.getElementById('exam-settings').style.display = 'block';
                
                // ÊòæÁ§∫ÂèñÊ∂àÊåâÈíÆÔºåÂÖÅËÆ∏Áî®Êà∑ËøîÂõûÂØºÂÖ•ÁïåÈù¢
                const cancelBtn = document.getElementById('cancelSettings');
                if (cancelBtn) {
                    cancelBtn.style.display = 'inline-block';
                }
                
                // Êõ¥Êñ∞ÂèØÁî®È¢òÁõÆÊï∞Èáè
                this.updateAvailableQuestions();
            }
            
            showExamSettings() {
                if (this.allQuestions.length === 0) {
                    alert('ËØ∑ÂÖàÂØºÂÖ•È¢òÂ∫ì');
                    return;
                }
                
                // ÊòæÁ§∫ËÄÉËØïËÆæÁΩÆÂå∫Âüü
                document.getElementById('exam-settings').style.display = 'block';
                
                // ÈöêËóèÂºÄÂßãÁ≠îÈ¢òÊèêÁ§∫Âå∫ÂüüÔºå‰ΩøÁïåÈù¢Êõ¥ÁÆÄÊ¥Å
                const progressInfo = document.querySelector('.progress-info');
                if (progressInfo) {
                    progressInfo.style.display = 'none';
                }
                
                // ÈöêËóèËÄÉËØïËÆæÁΩÆÊåâÈíÆ
                const startExamBtn = document.getElementById('startExam');
                if (startExamBtn) {
                    startExamBtn.style.display = 'none';
                }
                
                // Êõ¥Êñ∞ÂèØÁî®È¢òÁõÆÊï∞Èáè
                this.updateAvailableQuestions();
            }
            
            hideExamSettings() {
                document.getElementById('exam-settings').style.display = 'none';
                
                // ËøîÂõûÂà∞ÂØºÂÖ•È¢òÂ∫ìÁïåÈù¢
                document.getElementById('library-section').classList.add('hidden');
                document.getElementById('import-section').classList.remove('hidden');
                
                // Ê∏ÖÁ©∫ÂΩìÂâçÈ¢òÂ∫ìÊï∞ÊçÆÔºåÂÖÅËÆ∏ÈáçÊñ∞ÂØºÂÖ•
                this.allQuestions = [];
                this.questions = [];
                this.answeredQuestions = new Set();
                this.currentQuestionIndex = 0;
                this.score = 0;
                this.examStartTime = null;
                this.examTimeLimit = null;
                this.examTimer = null;
                
                // ÈáçÁΩÆÊñá‰ª∂ËæìÂÖ•
                const fileInput = document.getElementById('csvFile');
                if (fileInput) {
                    fileInput.value = '';
                }
                
                // ÈáçÁΩÆÊñá‰ª∂‰ø°ÊÅØÊòæÁ§∫Áä∂ÊÄÅ
                const fileInfo = document.getElementById('file-info');
                if (fileInfo) {
                    fileInfo.classList.add('hidden');
                    fileInfo.querySelector('p').textContent = 'Êñá‰ª∂Â∑≤ÈÄâÊã©ÔºåÁÇπÂáª‰∏ãÊñπÊåâÈíÆËß£ÊûêÈ¢òÂ∫ì';
                }
                
                // Ê∏ÖÈô§Ê£ÄÊµãÊñá‰ª∂ÁöÑÈÄâ‰∏≠Áä∂ÊÄÅ
                document.querySelectorAll('.file-item').forEach(item => {
                    item.classList.remove('selected');
                });
                
                // ÈáçÁΩÆÈÄâ‰∏≠Êñá‰ª∂ÂèòÈáè
                this.selectedFile = null;
            }
            
            updateAvailableQuestions() {
                // ËÆ°ÁÆóÂêÑÈ¢òÂûãÁöÑÂèØÁî®È¢òÁõÆÊï∞ÈáèÔºàÊéíÈô§Â∑≤Á≠îÈ¢òÁõÆÔºâ
                const availableQuestions = this.allQuestions.filter(q => !this.answeredQuestions.has(q.id));
                
                const availableStats = {
                    single: availableQuestions.filter(q => q.type === 'ÂçïÈÄâÈ¢ò').length,
                    multi: availableQuestions.filter(q => q.type === 'Â§öÈÄâÈ¢ò').length,
                    trueOrFalse: availableQuestions.filter(q => q.type === 'Âà§Êñ≠È¢ò').length,
                    essay: availableQuestions.filter(q => q.type === 'ÈóÆÁ≠îÈ¢ò').length
                };
                
                // Êõ¥Êñ∞ÂèØÁî®È¢òÁõÆÊï∞ÈáèÊòæÁ§∫
                document.getElementById('singleAvailable').textContent = `(${availableStats.single}È¢ò)`;
                document.getElementById('multiAvailable').textContent = `(${availableStats.multi}È¢ò)`;
                document.getElementById('trueOrFalseAvailable').textContent = `(${availableStats.trueOrFalse}È¢ò)`;
                document.getElementById('essayAvailable').textContent = `(${availableStats.essay}È¢ò)`;
                
                // Êõ¥Êñ∞ÂêÑÈ¢òÂûãÁöÑÊúÄÂ§ßÊï∞ÈáèÊèêÁ§∫
                document.getElementById('singleMaxHint').textContent = `ÊúÄÂ§ö ${availableStats.single} È¢ò`;
                document.getElementById('multiMaxHint').textContent = `ÊúÄÂ§ö ${availableStats.multi} È¢ò`;
                document.getElementById('trueOrFalseMaxHint').textContent = `ÊúÄÂ§ö ${availableStats.trueOrFalse} È¢ò`;
                document.getElementById('essayMaxHint').textContent = `ÊúÄÂ§ö ${availableStats.essay} È¢ò`;
                
                // ËÆæÁΩÆÂêÑÈ¢òÂûãËæìÂÖ•Ê°ÜÁöÑÊúÄÂ§ßÂÄº
                document.getElementById('singleCount').max = availableStats.single;
                document.getElementById('multiCount').max = availableStats.multi;
                document.getElementById('trueOrFalseCount').max = availableStats.trueOrFalse;
                document.getElementById('essayCount').max = availableStats.essay;
                
                // È™åËØÅÂπ∂Ë∞ÉÊï¥ÂΩìÂâçËæìÂÖ•ÂÄº
                this.validateAndAdjustCounts(availableStats);
                
                // Êõ¥Êñ∞ÊÄªÈ¢òÁõÆÊï∞
                this.updateTotalCount();
            }
            
            validateAndAdjustCounts(availableStats) {
                // È™åËØÅÂπ∂Ë∞ÉÊï¥ÂêÑÈ¢òÂûãÁöÑËæìÂÖ•ÂÄº
                const singleInput = document.getElementById('singleCount');
                const multiInput = document.getElementById('multiCount');
                const trueOrFalseInput = document.getElementById('trueOrFalseCount');
                const essayInput = document.getElementById('essayCount');
                
                // Ë∞ÉÊï¥Ë∂ÖÂá∫ÊúÄÂ§ßÂÄºÁöÑËæìÂÖ•
                if (parseInt(singleInput.value) > availableStats.single) {
                    singleInput.value = availableStats.single;
                }
                if (parseInt(multiInput.value) > availableStats.multi) {
                    multiInput.value = availableStats.multi;
                }
                if (parseInt(trueOrFalseInput.value) > availableStats.trueOrFalse) {
                    trueOrFalseInput.value = availableStats.trueOrFalse;
                }
                if (parseInt(essayInput.value) > availableStats.essay) {
                    essayInput.value = availableStats.essay;
                }
            }
            
            updateTotalCount() {
                const singleCount = parseInt(document.getElementById('singleCount').value) || 0;
                const multiCount = parseInt(document.getElementById('multiCount').value) || 0;
                const trueOrFalseCount = parseInt(document.getElementById('trueOrFalseCount').value) || 0;
                const essayCount = parseInt(document.getElementById('essayCount').value) || 0;
                
                const totalCount = singleCount + multiCount + trueOrFalseCount + essayCount;
                document.getElementById('totalQuestionCount').textContent = totalCount;
                
                // ÊéßÂà∂Á°ÆËÆ§ÊåâÈíÆÁä∂ÊÄÅ
                const confirmBtn = document.getElementById('confirmSettings');
                confirmBtn.disabled = totalCount === 0;
            }
            
            toggleTimeInput() {
                const hasTimeLimit = document.getElementById('hasTimeLimit').checked;
                const timeInputGroup = document.getElementById('timeInputGroup');
                
                if (hasTimeLimit) {
                    timeInputGroup.style.display = 'flex';
                } else {
                    timeInputGroup.style.display = 'none';
                }
            }
            
            startExamWithSettings() {
                const singleCount = parseInt(document.getElementById('singleCount').value) || 0;
                const multiCount = parseInt(document.getElementById('multiCount').value) || 0;
                const trueOrFalseCount = parseInt(document.getElementById('trueOrFalseCount').value) || 0;
                const essayCount = parseInt(document.getElementById('essayCount').value) || 0;
                
                const totalCount = singleCount + multiCount + trueOrFalseCount + essayCount;
                
                if (totalCount === 0) {
                    alert('ËØ∑Ëá≥Â∞ëËÆæÁΩÆ‰∏ÄÁßçÈ¢òÂûãÁöÑÊï∞ÈáèÔºÅ');
                    return;
                }
                
                // Ê†πÊçÆÊòØÂê¶‰∏∫ÈîôÈ¢òÈáçËÄÉÊ®°ÂºèÈÄâÊã©È¢òÁõÆÊ∫ê
                const sourceQuestions = this.isRetakeMode ? this.retakeQuestions : this.allQuestions;
                
                // ÊåâÈ¢òÂûãÂàÜÂà´Ëé∑ÂèñÂèØÁî®È¢òÁõÆ
                let availableByType;
                if (this.isRetakeMode) {
                    // ÈîôÈ¢òÈáçËÄÉÊ®°ÂºèÔºöÁõ¥Êé•‰ΩøÁî®ÈîôÈ¢òÊï∞ÊçÆÔºå‰∏çËøáÊª§Â∑≤Á≠îÈ¢òÁõÆ
                    availableByType = {
                        'ÂçïÈÄâÈ¢ò': sourceQuestions.filter(q => q.type === 'ÂçïÈÄâÈ¢ò'),
                        'Â§öÈÄâÈ¢ò': sourceQuestions.filter(q => q.type === 'Â§öÈÄâÈ¢ò'),
                        'Âà§Êñ≠È¢ò': sourceQuestions.filter(q => q.type === 'Âà§Êñ≠È¢ò'),
                        'ÈóÆÁ≠îÈ¢ò': sourceQuestions.filter(q => q.type === 'ÈóÆÁ≠îÈ¢ò')
                    };
                } else {
                    // Ê≠£Â∏∏Ê®°ÂºèÔºöËøáÊª§Â∑≤Á≠îÈ¢òÁõÆ
                    availableByType = {
                        'ÂçïÈÄâÈ¢ò': sourceQuestions.filter(q => q.type === 'ÂçïÈÄâÈ¢ò' && !this.answeredQuestions.has(q.id)),
                        'Â§öÈÄâÈ¢ò': sourceQuestions.filter(q => q.type === 'Â§öÈÄâÈ¢ò' && !this.answeredQuestions.has(q.id)),
                        'Âà§Êñ≠È¢ò': sourceQuestions.filter(q => q.type === 'Âà§Êñ≠È¢ò' && !this.answeredQuestions.has(q.id)),
                        'ÈóÆÁ≠îÈ¢ò': sourceQuestions.filter(q => q.type === 'ÈóÆÁ≠îÈ¢ò' && !this.answeredQuestions.has(q.id))
                    };
                }
                
                // È™åËØÅÂêÑÈ¢òÂûãÁöÑÂèØÁî®Êï∞Èáè
                if (singleCount > availableByType['ÂçïÈÄâÈ¢ò'].length) {
                    alert(`ÂçïÈÄâÈ¢òÊï∞Èáè‰∏çË∂≥ÔºÅÊúÄÂ§öÂè™Êúâ ${availableByType['ÂçïÈÄâÈ¢ò'].length} È¢òÂèØÁî®`);
                    return;
                }
                if (multiCount > availableByType['Â§öÈÄâÈ¢ò'].length) {
                    alert(`Â§öÈÄâÈ¢òÊï∞Èáè‰∏çË∂≥ÔºÅÊúÄÂ§öÂè™Êúâ ${availableByType['Â§öÈÄâÈ¢ò'].length} È¢òÂèØÁî®`);
                    return;
                }
                if (trueOrFalseCount > availableByType['Âà§Êñ≠È¢ò'].length) {
                    alert(`Âà§Êñ≠È¢òÊï∞Èáè‰∏çË∂≥ÔºÅÊúÄÂ§öÂè™Êúâ ${availableByType['Âà§Êñ≠È¢ò'].length} È¢òÂèØÁî®`);
                    return;
                }
                if (essayCount > availableByType['ÈóÆÁ≠îÈ¢ò'].length) {
                    alert(`ÈóÆÁ≠îÈ¢òÊï∞Èáè‰∏çË∂≥ÔºÅÊúÄÂ§öÂè™Êúâ ${availableByType['ÈóÆÁ≠îÈ¢ò'].length} È¢òÂèØÁî®`);
                    return;
                }
                
                // ÊåâÊåáÂÆöÊï∞ÈáèÈÄâÊã©ÂêÑÈ¢òÂûãÁöÑÈ¢òÁõÆ
                this.questions = [];
                
                if (singleCount > 0) {
                    this.shuffleArray(availableByType['ÂçïÈÄâÈ¢ò']);
                    this.questions.push(...availableByType['ÂçïÈÄâÈ¢ò'].slice(0, singleCount));
                }
                if (multiCount > 0) {
                    this.shuffleArray(availableByType['Â§öÈÄâÈ¢ò']);
                    this.questions.push(...availableByType['Â§öÈÄâÈ¢ò'].slice(0, multiCount));
                }
                if (trueOrFalseCount > 0) {
                    this.shuffleArray(availableByType['Âà§Êñ≠È¢ò']);
                    this.questions.push(...availableByType['Âà§Êñ≠È¢ò'].slice(0, trueOrFalseCount));
                }
                if (essayCount > 0) {
                    this.shuffleArray(availableByType['ÈóÆÁ≠îÈ¢ò']);
                    this.questions.push(...availableByType['ÈóÆÁ≠îÈ¢ò'].slice(0, essayCount));
                }
                
                // Êâì‰π±ÊúÄÁªàÈ¢òÁõÆÈ°∫Â∫è
                this.shuffleArray(this.questions);
                
                // ËÆ°ÁÆóÂàÜÊï∞ÂàÜÈÖçÔºàÈóÆÁ≠îÈ¢ò‰∏çËÆ°ÂàÜÔºâ
                const scoredQuestions = this.questions.filter(q => q.type !== 'ÈóÆÁ≠îÈ¢ò');
                const scorePerQuestion = scoredQuestions.length > 0 ? Math.round(100 / scoredQuestions.length) : 0;
                
                // ‰∏∫ÊØèÈÅìÈ¢òÂàÜÈÖçÂàÜÊï∞
                this.questions.forEach(q => {
                    q.score = q.type === 'ÈóÆÁ≠îÈ¢ò' ? 0 : scorePerQuestion;
                });
                
                // Ë∞ÉÊï¥ÊúÄÂêé‰∏ÄÈ¢òÁöÑÂàÜÊï∞ÔºåÁ°Æ‰øùÊÄªÂàÜ‰∏∫100
                if (scoredQuestions.length > 0) {
                    const totalAssigned = scorePerQuestion * scoredQuestions.length;
                    const lastScoredQuestion = scoredQuestions[scoredQuestions.length - 1];
                    lastScoredQuestion.score += (100 - totalAssigned);
                }
                
                this.currentQuestionIndex = 0;
                this.userAnswers = new Array(this.questions.length).fill(null);
                this.examStarted = true;
                
                // Â§ÑÁêÜÊó∂Èó¥ËÆæÁΩÆ
                this.isTimeLimited = document.getElementById('hasTimeLimit').checked;
                if (this.isTimeLimited) {
                    this.examTimeLimit = parseInt(document.getElementById('examTimeLimit').value) || 60;
                }
                
                // ÈáçÁΩÆËÄÉËØïÁä∂ÊÄÅ
                this.wrongQuestionsData = null;
                this.correctQuestionsData = null;
                this.answeredQuestions.clear(); // Ê∏ÖÈô§Â∑≤ÂõûÁ≠îÈ¢òÁõÆËÆ∞ÂΩïÔºåÈÅøÂÖçÊòæÁ§∫‰πãÂâçÁöÑÁ≠îÊ°àÁªìÊûú
                
                // ÈáçÁΩÆÊöÇÂÅúÁõ∏ÂÖ≥ÂèòÈáè
                this.isPaused = false;
                this.pausedTime = 0;
                this.pauseStartTime = null;
                
                // ÈöêËóèËÆæÁΩÆÂå∫ÂüüÔºåÊòæÁ§∫ËÄÉËØïÂå∫Âüü
                document.getElementById('exam-settings').style.display = 'none';
                document.getElementById('library-section').classList.add('hidden');
                document.getElementById('exam-section').classList.remove('hidden');
                
                // ÈáçÁΩÆÈîôÈ¢òÈáçËÄÉÊ®°ÂºèÁõ∏ÂÖ≥Áä∂ÊÄÅ
                if (this.isRetakeMode) {
                    this.isRetakeMode = false;
                    this.retakeQuestions = null;
                    
                    // ÊÅ¢Â§çÂºÄÂßãËÄÉËØïÊåâÈíÆÂíåËÆæÁΩÆÈ°µÈù¢Ê†áÈ¢ò
                    const startExamBtn = document.getElementById('startExam');
                    if (startExamBtn) {
                        startExamBtn.style.display = 'block';
                    }
                    
                    const settingsTitle = document.querySelector('#exam-settings h3');
                    if (settingsTitle) {
                        settingsTitle.textContent = 'üìù ËÄÉËØïËÆæÁΩÆ';
                    }
                    
                    const confirmBtn = document.getElementById('confirmSettings');
                    if (confirmBtn) {
                        confirmBtn.textContent = '‚úÖ ÂºÄÂßãËÄÉËØï';
                    }
                    
                    alert('ÈîôÈ¢òÈáçËÄÉÂ∑≤ÂºÄÂßãÔºÅ');
                } else {
                    alert('ËÄÉËØïÂ∑≤ÂºÄÂßãÔºÅ');
                }
                
                // ÂºÄÂßãËÆ°Êó∂
                this.startTimer();
                
                this.displayQuestion();
                this.updateQuestionStatus();
            }

            startExam() {
                if (this.allQuestions.length === 0) {
                    alert('ËØ∑ÂÖàÂØºÂÖ•È¢òÂ∫ì');
                    return;
                }

                // ËøáÊª§ÊéâÂ∑≤ÁªèÂõûÁ≠îËøáÁöÑÈ¢òÁõÆ
                const availableQuestions = this.allQuestions.filter(question => 
                    !this.answeredQuestions.has(question.id)
                );
                
                if (availableQuestions.length === 0) {
                    alert('ÊâÄÊúâÈ¢òÁõÆÈÉΩÂ∑≤ÁªèÁ≠îËøá‰∫ÜÔºÅËØ∑ÁÇπÂáª"ÈáçÊñ∞ÂºÄÂßã"Êù•ÈáçÁΩÆÁ≠îÈ¢òËÆ∞ÂΩï„ÄÇ');
                    return;
                }
                
                // ‰ΩøÁî®ËøáÊª§ÂêéÁöÑÈ¢òÁõÆ
                this.questions = [...availableQuestions]; // ÂàõÂª∫ÂâØÊú¨ÔºåÈÅøÂÖç‰øÆÊîπÂéüÊï∞ÁªÑ
                
                // Êâì‰π±È¢òÁõÆÈ°∫Â∫è
                this.shuffleArray(this.questions);
                
                // ËÆ°ÁÆóÂàÜÊï∞ÂàÜÈÖçÔºàÈóÆÁ≠îÈ¢ò‰∏çËÆ°ÂàÜÔºâ
                const scoredQuestions = this.questions.filter(q => q.type !== 'ÈóÆÁ≠îÈ¢ò');
                const scorePerQuestion = scoredQuestions.length > 0 ? Math.round(100 / scoredQuestions.length) : 0;
                
                // ‰∏∫ÊØèÈÅìÈ¢òÂàÜÈÖçÂàÜÊï∞
                this.questions.forEach(q => {
                    q.score = q.type === 'ÈóÆÁ≠îÈ¢ò' ? 0 : scorePerQuestion;
                });
                
                // Ë∞ÉÊï¥ÊúÄÂêé‰∏ÄÈ¢òÁöÑÂàÜÊï∞ÔºåÁ°Æ‰øùÊÄªÂàÜ‰∏∫100
                if (scoredQuestions.length > 0) {
                    const totalAssigned = scorePerQuestion * scoredQuestions.length;
                    const lastScoredQuestion = scoredQuestions[scoredQuestions.length - 1];
                    lastScoredQuestion.score += (100 - totalAssigned);
                }
                
                this.currentQuestionIndex = 0;
                this.userAnswers = new Array(this.questions.length).fill(null);
                this.examStarted = true;

                document.getElementById('library-section').classList.add('hidden');
                document.getElementById('exam-section').classList.remove('hidden');

                this.displayQuestion();
                this.updateQuestionStatus();
            }

            shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
            }

            displayQuestion() {
                const question = this.questions[this.currentQuestionIndex];
                const questionNumber = this.currentQuestionIndex + 1;
                const totalQuestions = this.questions.length;

                document.getElementById('questionNumber').textContent = `Á¨¨ ${questionNumber} È¢ò`;
                
                // ÊòæÁ§∫È¢òÁõÆÁ±ªÂûãÂíåÂàÜÊï∞
                const typeText = question.score !== undefined ? 
                    `${question.type} (${question.score}ÂàÜ)` : question.type;
                document.getElementById('questionType').textContent = typeText;
                
                document.getElementById('questionText').textContent = question.question;
                document.getElementById('questionProgress').textContent = `${questionNumber} / ${totalQuestions}`;
                document.getElementById('totalCount').textContent = `ÊÄªÈ¢òÊï∞: ${totalQuestions}`;

                // Êõ¥Êñ∞ËøõÂ∫¶Êù°
                const progress = (questionNumber / totalQuestions) * 100;
                document.getElementById('progressBar').style.width = `${progress}%`;

                // ÊòæÁ§∫ÈÄâÈ°πÊàñËæìÂÖ•Ê°Ü
                this.displayOptions(question);

                // Êõ¥Êñ∞Á≠îÈ¢òÁä∂ÊÄÅ
                this.updateQuestionStatus();

                // Êõ¥Êñ∞ÂØºËà™ÊåâÈíÆ
                document.getElementById('prevBtn').disabled = this.currentQuestionIndex === 0;
                document.getElementById('nextBtn').classList.toggle('hidden', questionNumber === totalQuestions);
                document.getElementById('submitBtn').classList.toggle('hidden', questionNumber !== totalQuestions);
            }

            displayOptions(question) {
                const container = document.getElementById('optionsContainer');
                container.innerHTML = '';

                if (question.type === 'ÂçïÈÄâÈ¢ò' || question.type === 'Â§öÈÄâÈ¢ò') {
                    // ÂÖàÂ∞ùËØïÁî®ÂàÜÂè∑ÂàÜÂâ≤ÔºåÂ¶ÇÊûúÊ≤°ÊúâÂàÜÂè∑ÂàôÁî®ÁÆ°ÈÅìÁ¨¶ÂàÜÂâ≤
                    let options;
                    if (question.options.includes(';')) {
                        options = question.options.split(';').filter(opt => opt.trim());
                    } else {
                        options = question.options.split('|').filter(opt => opt.trim());
                    }

                    const optionsContainer = document.createElement('div');
                    optionsContainer.className = 'options-container';
                    
                    const label = document.createElement('label');
                    label.textContent = question.type === 'ÂçïÈÄâÈ¢ò' ? 'ËØ∑ÈÄâÊã©Á≠îÊ°àÔºö' : 'ËØ∑ÈÄâÊã©Á≠îÊ°àÔºàÂèØÂ§öÈÄâÔºâÔºö';
                    label.className = 'answer-label';
                    label.style.cssText = 'display: block; margin-bottom: 15px; font-weight: bold; color: #333;';
                    optionsContainer.appendChild(label);
                    
                    const savedAnswer = this.userAnswers[this.currentQuestionIndex] || '';
                    const selectedOptions = savedAnswer.split('');
                    
                    options.forEach((option, index) => {
                        if (index < 4) { // ÊúÄÂ§öÊòæÁ§∫4‰∏™ÈÄâÈ°π
                            const letter = String.fromCharCode(65 + index); // A, B, C, D
                            const optionDiv = document.createElement('div');
                            optionDiv.className = 'option-item';
                            optionDiv.dataset.value = letter;
                            
                            // ÂéªÊéâÈÄâÈ°π‰∏≠ÂéüÊúâÁöÑA.„ÄÅB.Á≠âÂâçÁºÄ
                            let cleanOption = option.trim().replace(/^[A-Z]\. /, '');
                            // ‰∏∫B„ÄÅC„ÄÅDÁ≠âÈÄâÈ°πÂâçÊ∑ªÂä†Êç¢Ë°åÁ¨¶ÔºàÂ¶ÇÊûúÈÄâÈ°πÊñáÊú¨‰∏≠ÂåÖÂê´ÂàÜÂè∑ÂàÜÈöîÁöÑÂ§ö‰∏™ÈÄâÈ°πÔºâ
                            if (cleanOption.includes('; ')) {
                                cleanOption = cleanOption.replace(/; ([B-Z]\. )/g, '; \n $1');
                            }
                            
                            optionDiv.innerHTML = `${letter}. ${cleanOption.replace(/\n/g, '<br>')}`;
                            
                            // ËÆæÁΩÆÈÄâÈ°πÊ†∑Âºè
                            optionDiv.style.cssText = `
                                padding: 15px 20px;
                                margin: 8px 0;
                                border: 2px solid #ddd;
                                background: white;
                                border-radius: 8px;
                                cursor: pointer;
                                font-size: 16px;
                                line-height: 1.5;
                                transition: all 0.3s ease;
                                user-select: none;
                            `;
                            
                            // Â¶ÇÊûúÂ∑≤ÈÄâ‰∏≠ÔºåÊ∑ªÂä†ÈÄâ‰∏≠Ê†∑Âºè
                            if (selectedOptions.includes(letter)) {
                                optionDiv.classList.add('selected');
                                optionDiv.style.backgroundColor = '#007bff';
                                optionDiv.style.color = 'white';
                                optionDiv.style.borderColor = '#007bff';
                            }
                            
                            // Ê∑ªÂä†ÁÇπÂáª‰∫ã‰ª∂
                            optionDiv.addEventListener('click', () => {
                                // Â¶ÇÊûúÂ∑≤ÁªèÂõûÁ≠îËøáÔºå‰∏çÂÖÅËÆ∏ÂÜçÊ¨°ÈÄâÊã©
                                if (this.answeredQuestions.has(this.currentQuestionIndex)) {
                                    return;
                                }
                                
                                if (question.type === 'ÂçïÈÄâÈ¢ò') {
                                    // ÂçïÈÄâÈ¢òÔºöÊ∏ÖÈô§ÂÖ∂‰ªñÈÄâÊã©ÔºåÂè™ÈÄâ‰∏≠ÂΩìÂâçÈÄâÈ°π
                                    optionsContainer.querySelectorAll('.option-item').forEach(item => {
                                        item.classList.remove('selected');
                                        item.style.backgroundColor = 'white';
                                        item.style.color = 'black';
                                        item.style.borderColor = '#ddd';
                                    });
                                    
                                    optionDiv.classList.add('selected');
                                    optionDiv.style.backgroundColor = '#007bff';
                                    optionDiv.style.color = 'white';
                                    optionDiv.style.borderColor = '#007bff';
                                    
                                    this.userAnswers[this.currentQuestionIndex] = letter;
                                } else {
                                    // Â§öÈÄâÈ¢òÔºöÂàáÊç¢ÈÄâ‰∏≠Áä∂ÊÄÅ
                                    if (optionDiv.classList.contains('selected')) {
                                        optionDiv.classList.remove('selected');
                                        optionDiv.style.backgroundColor = 'white';
                                        optionDiv.style.color = 'black';
                                        optionDiv.style.borderColor = '#ddd';
                                    } else {
                                        optionDiv.classList.add('selected');
                                        optionDiv.style.backgroundColor = '#007bff';
                                        optionDiv.style.color = 'white';
                                        optionDiv.style.borderColor = '#007bff';
                                    }
                                    
                                    // Êõ¥Êñ∞Á≠îÊ°à
                                    const selectedItems = optionsContainer.querySelectorAll('.option-item.selected');
                                    const selectedValues = Array.from(selectedItems).map(item => item.dataset.value).sort().join('');
                                    this.userAnswers[this.currentQuestionIndex] = selectedValues;
                                }
                                
                                // ÊòæÁ§∫ÊàñÈöêËóèÁ°ÆÂÆöÊåâÈíÆ
                                const confirmBtn = container.querySelector('.confirm-answer-btn');
                                const currentAnswer = this.userAnswers[this.currentQuestionIndex];
                                if (currentAnswer && currentAnswer.trim() && !this.answeredQuestions.has(this.currentQuestionIndex)) {
                                    confirmBtn.style.display = 'inline-block';
                                } else {
                                    confirmBtn.style.display = 'none';
                                }
                            });
                            
                            // Ê∑ªÂä†ÊÇ¨ÂÅúÊïàÊûú
                            optionDiv.addEventListener('mouseenter', () => {
                                if (!optionDiv.classList.contains('selected') && !this.answeredQuestions.has(this.currentQuestionIndex)) {
                                    optionDiv.style.backgroundColor = '#f8f9fa';
                                    optionDiv.style.borderColor = '#007bff';
                                }
                            });
                            
                            optionDiv.addEventListener('mouseleave', () => {
                                if (!optionDiv.classList.contains('selected')) {
                                    optionDiv.style.backgroundColor = 'white';
                                    optionDiv.style.borderColor = '#ddd';
                                }
                            });
                            
                            optionsContainer.appendChild(optionDiv);
                        }
                    });
                    
                    container.appendChild(optionsContainer);
                    
                    // Ê∑ªÂä†Á°ÆÂÆöÊåâÈíÆ
                    const confirmBtn = document.createElement('button');
                    confirmBtn.className = 'btn btn-primary confirm-answer-btn';
                    confirmBtn.textContent = '‚úì Á°ÆÂÆö';
                    confirmBtn.style.display = 'none';
                    confirmBtn.style.marginTop = '15px';
                    
                    confirmBtn.addEventListener('click', () => {
                        const currentAnswer = this.userAnswers[this.currentQuestionIndex];
                        this.confirmAnswer(this.currentQuestionIndex, currentAnswer);
                    });
                    
                    container.appendChild(confirmBtn);
                    
                    // Â¶ÇÊûúÂ∑≤ÁªèÂõûÁ≠îËøáÔºåÊòæÁ§∫ÁªìÊûúÂπ∂Á¶ÅÁî®ÈÄâÈ°π
                    if (this.answeredQuestions.has(this.currentQuestionIndex)) {
                        this.showAnswerResult(this.currentQuestionIndex, container);
                        optionsContainer.querySelectorAll('.option-item').forEach(item => {
                            item.style.pointerEvents = 'none';
                            item.style.opacity = '0.6';
                        });
                        confirmBtn.style.display = 'none';
                    } else if (savedAnswer && savedAnswer.trim()) {
                        confirmBtn.style.display = 'inline-block';
                    }
                } else if (question.type === 'Âà§Êñ≠È¢ò') {
                    const trueOption = this.createJudgeOption('Ê≠£Á°Æ', 'Ê≠£Á°Æ');
                    const falseOption = this.createJudgeOption('ÈîôËØØ', 'ÈîôËØØ');
                    
                    const savedAnswer = this.userAnswers[this.currentQuestionIndex];
                    if (savedAnswer === 'Ê≠£Á°Æ') {
                        trueOption.classList.add('selected');
                        trueOption.querySelector('input').checked = true;
                    } else if (savedAnswer === 'ÈîôËØØ') {
                        falseOption.classList.add('selected');
                        falseOption.querySelector('input').checked = true;
                    }
                    
                    container.appendChild(trueOption);
                    container.appendChild(falseOption);
                    
                    // Ê∑ªÂä†Á°ÆÂÆöÊåâÈíÆ
                    const confirmBtnDiv = document.createElement('div');
                    confirmBtnDiv.className = 'confirm-btn-container';
                    confirmBtnDiv.style.marginTop = '15px';
                    
                    const confirmBtn = document.createElement('button');
                    confirmBtn.className = 'btn btn-primary confirm-answer-btn';
                    confirmBtn.textContent = '‚úì Á°ÆÂÆö';
                    confirmBtn.style.display = savedAnswer ? 'inline-block' : 'none';
                    
                    confirmBtn.addEventListener('click', () => {
                        const selectedValue = this.userAnswers[this.currentQuestionIndex];
                        if (selectedValue) {
                            this.confirmAnswer(this.currentQuestionIndex, selectedValue);
                        }
                    });
                    
                    confirmBtnDiv.appendChild(confirmBtn);
                    container.appendChild(confirmBtnDiv);
                    
                    // Â¶ÇÊûúÂ∑≤ÁªèÂõûÁ≠îËøáÔºåÊòæÁ§∫ÁªìÊûúÂπ∂Á¶ÅÁî®ÈÄâÈ°π
                    if (this.answeredQuestions.has(this.currentQuestionIndex)) {
                        this.showAnswerResult(this.currentQuestionIndex, container);
                        trueOption.style.pointerEvents = 'none';
                        falseOption.style.pointerEvents = 'none';
                        confirmBtn.style.display = 'none';
                    }
                } else if (question.type === 'ÈóÆÁ≠îÈ¢ò') {
                    const textarea = document.createElement('textarea');
                    textarea.className = 'textarea-answer';
                    textarea.placeholder = 'ËØ∑ËæìÂÖ•ÊÇ®ÁöÑÁ≠îÊ°à...';
                    textarea.value = this.userAnswers[this.currentQuestionIndex] || '';
                    
                    let saveTimeout;
                    textarea.addEventListener('input', () => {
                        this.userAnswers[this.currentQuestionIndex] = textarea.value;
                        // Èò≤Êäñ‰øùÂ≠òÊèêÁ§∫
                        clearTimeout(saveTimeout);
                        saveTimeout = setTimeout(() => {
                            if (textarea.value.trim()) {
                                this.showAnswerSaved();
                            }
                        }, 1000);
                    });
                    
                    container.appendChild(textarea);
                }
            }

            createJudgeOption(text, value) {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option';
                
                const input = document.createElement('input');
                input.type = 'radio';
                input.name = 'judge';
                input.value = value;
                
                const label = document.createElement('label');
                label.textContent = text;
                
                optionDiv.appendChild(input);
                optionDiv.appendChild(label);
                
                optionDiv.addEventListener('click', () => {
                    // Â¶ÇÊûúÂ∑≤ÁªèÂõûÁ≠îËøáÔºå‰∏çÂÖÅËÆ∏ÂÜçÊ¨°ÈÄâÊã©
                    if (this.answeredQuestions.has(this.currentQuestionIndex)) {
                        return;
                    }
                    
                    document.querySelectorAll('.option').forEach(opt => opt.classList.remove('selected'));
                    optionDiv.classList.add('selected');
                    input.checked = true;
                    this.userAnswers[this.currentQuestionIndex] = value;
                    
                    // ÊòæÁ§∫Á°ÆÂÆöÊåâÈíÆ
                    const confirmBtn = document.querySelector('.confirm-answer-btn');
                    if (confirmBtn) {
                        confirmBtn.style.display = 'inline-block';
                    }
                });
                
                return optionDiv;
            }



            previousQuestion() {
                if (this.currentQuestionIndex > 0) {
                    this.currentQuestionIndex--;
                    this.displayQuestion();
                }
            }

            nextQuestion() {
                if (this.currentQuestionIndex < this.questions.length - 1) {
                    this.currentQuestionIndex++;
                    this.displayQuestion();
                }
            }

            submitExam(autoSubmit = false) {
                if (autoSubmit === true) {
                    // Ëá™Âä®‰∫§Âç∑ÔºåÂÅúÊ≠¢ËÆ°Êó∂Âô®Âπ∂Áõ¥Êé•ËÆ°ÁÆóÁªìÊûú
                    this.stopTimer();
                    alert('ËÄÉËØïÊó∂Èó¥Âà∞ÔºÅÁ≥ªÁªüÂ∞ÜËá™Âä®‰∫§Âç∑„ÄÇ');
                    this.calculateResults();
                    return;
                }
                
                // ÊâãÂä®‰∫§Âç∑ÔºåÊ£ÄÊü•Êú™Á≠îÈ¢òÁõÆ
                const unansweredQuestions = [];
                this.questions.forEach((question, index) => {
                    const answer = this.userAnswers[index];
                    const hasAnswer = answer !== null && answer !== undefined && answer !== '';
                    if (!hasAnswer || (Array.isArray(answer) && answer.length === 0)) {
                        unansweredQuestions.push(index + 1);
                    }
                });
                
                let confirmMessage = 'Á°ÆÂÆöË¶Å‰∫§Âç∑ÂêóÔºü‰∫§Âç∑ÂêéÂ∞ÜÊó†Ê≥ï‰øÆÊîπÁ≠îÊ°à„ÄÇ';
                if (unansweredQuestions.length > 0) {
                    confirmMessage = `ËøòÊúâ ${unansweredQuestions.length} ÈÅìÈ¢òÁõÆÊú™‰ΩúÁ≠îÔºàÁ¨¨ ${unansweredQuestions.join('„ÄÅ')} È¢òÔºâ„ÄÇ\n\nÁ°ÆÂÆöË¶Å‰∫§Âç∑ÂêóÔºü‰∫§Âç∑ÂêéÂ∞ÜÊó†Ê≥ï‰øÆÊîπÁ≠îÊ°à„ÄÇ`;
                }
                
                if (confirm(confirmMessage)) {
                    // Áî®Êà∑Á°ÆËÆ§‰∫§Âç∑ÔºåÂÅúÊ≠¢ËÆ°Êó∂Âô®Âπ∂ËÆ°ÁÆóÁªìÊûú
                    this.stopTimer();
                    this.calculateResults();
                }
                // Â¶ÇÊûúÁî®Êà∑ÂèñÊ∂à‰∫§Âç∑ÔºåËÆ°Êó∂Âô®ÁªßÁª≠ËøêË°åÔºå‰∏çÂÅö‰ªª‰ΩïÊìç‰Ωú
            }

            calculateResults() {
                let correctCount = 0;
                const wrongQuestions = [];
                const essayQuestions = [];
                let answeredCount = 0;
                
                // Â∞ÜÊú¨Ê¨°ËÄÉËØïÁöÑÊâÄÊúâÈ¢òÁõÆIDÊ∑ªÂä†Âà∞Â∑≤Á≠îÈ¢òÁõÆÈõÜÂêà‰∏≠
                this.questions.forEach(question => {
                    this.answeredQuestions.add(question.id);
                });
                
                // ÁªüËÆ°ÈùûÈóÆÁ≠îÈ¢òÊï∞ÈáèÁî®‰∫éÂàÜÊï∞ËÆ°ÁÆó
                const scoredQuestions = this.questions.filter(q => q.type !== 'ÈóÆÁ≠îÈ¢ò');

                this.questions.forEach((question, index) => {
                    const userAnswer = this.userAnswers[index];
                    const correctAnswer = question.answer;
                    
                    // ÈóÆÁ≠îÈ¢òÂçïÁã¨Â§ÑÁêÜÔºå‰∏çËÆ°ÂÖ•ËÄÉËØïÁªìÊûú
                    if (question.type === 'ÈóÆÁ≠îÈ¢ò') {
                        essayQuestions.push({ question, userAnswer: userAnswer || 'Êú™‰ΩúÁ≠î', index: index + 1 });
                        return;
                    }
                    
                    // Ê£ÄÊü•ÊòØÂê¶Â∑≤Á≠îÈ¢ò
                    const hasAnswer = userAnswer !== null && userAnswer !== undefined && userAnswer !== '';
                    if (!hasAnswer) {
                        // Êú™Á≠îÈ¢òÔºåÁõ¥Êé•Âä†ÂÖ•ÈîôËØØÈ¢òÁõÆÂàóË°®
                        wrongQuestions.push({ question, userAnswer: 'Êú™‰ΩúÁ≠î', index: index + 1 });
                        return;
                    }
                    
                    answeredCount++;
                    let isCorrect = false;

                    if (question.type === 'ÂçïÈÄâÈ¢ò' || question.type === 'Â§öÈÄâÈ¢ò') {
                        // ÊèêÂèñÊ≠£Á°ÆÁ≠îÊ°à‰∏≠ÁöÑÂ≠óÊØçÈÉ®ÂàÜ
                        let correctLetters = '';
                        if (question.type === 'ÂçïÈÄâÈ¢ò') {
                            // ÂçïÈÄâÈ¢òÔºöÊèêÂèñÁ¨¨‰∏Ä‰∏™Â≠óÊØç
                            const match = correctAnswer.match(/^([A-D])/);
                            correctLetters = match ? match[1] : '';
                        } else {
                            // Â§öÈÄâÈ¢òÔºöÊîØÊåÅ‰∏§ÁßçÊ†ºÂºè
                            if (/^[A-D]+$/.test(correctAnswer.trim())) {
                                // Ê†ºÂºè1ÔºöÁõ¥Êé•ÊòØÂ≠óÊØçÁªÑÂêà
                                correctLetters = correctAnswer.trim().split('').sort().join('');
                            } else {
                                // Ê†ºÂºè2ÔºöÊèêÂèñÊâÄÊúâÂ≠óÊØçÂπ∂ÊéíÂ∫è
                                const matches = correctAnswer.match(/([A-D])\./g);
                                if (matches) {
                                    correctLetters = matches.map(m => m.charAt(0)).sort().join('');
                                }
                            }
                        }
                        
                        // ÊØîËæÉÂ≠óÊØçÁ≠îÊ°à
                        if (question.type === 'Â§öÈÄâÈ¢ò') {
                            const userLetters = userAnswer ? userAnswer.split('').sort().join('') : '';
                            isCorrect = userLetters === correctLetters;
                            console.log(`Â§öÈÄâÈ¢òÊØîËæÉ: Áî®Êà∑Á≠îÊ°à="${userLetters}", Ê≠£Á°ÆÁ≠îÊ°à="${correctLetters}", ÂåπÈÖç=${isCorrect}`);
                        } else {
                            isCorrect = userAnswer === correctLetters;
                            console.log(`ÂçïÈÄâÈ¢òÊØîËæÉ: Áî®Êà∑Á≠îÊ°à="${userAnswer}", Ê≠£Á°ÆÁ≠îÊ°à="${correctLetters}", ÂåπÈÖç=${isCorrect}`);
                        }
                    } else {
                        isCorrect = userAnswer === correctAnswer;
                    }

                    if (isCorrect) {
                        correctCount++;
                    } else {
                        wrongQuestions.push({ question, userAnswer, index: index + 1 });
                    }
                });

                // ËÆ°ÁÆóÂàÜÊï∞Ôºö‰ΩøÁî®È¢òÁõÆÁöÑÂàÜÊï∞Â±ûÊÄß
                let totalScore = 0;
                this.questions.forEach((question, index) => {
                    if (question.type === 'ÈóÆÁ≠îÈ¢ò') return; // ÈóÆÁ≠îÈ¢ò‰∏çËÆ°ÂàÜ
                    
                    const userAnswer = this.userAnswers[index];
                    const hasAnswer = userAnswer !== null && userAnswer !== undefined && userAnswer !== '';
                    if (!hasAnswer) return; // Êú™Á≠îÈ¢ò‰∏çÂæóÂàÜ
                    
                    let isCorrect = false;
                    const correctAnswer = question.answer;
                    
                    if (question.type === 'ÂçïÈÄâÈ¢ò' || question.type === 'Â§öÈÄâÈ¢ò') {
                        let correctLetters = '';
                        if (question.type === 'ÂçïÈÄâÈ¢ò') {
                            const match = correctAnswer.match(/^([A-D])/);
                            correctLetters = match ? match[1] : '';
                        } else {
                            if (/^[A-D]+$/.test(correctAnswer.trim())) {
                                correctLetters = correctAnswer.trim().split('').sort().join('');
                            } else {
                                const matches = correctAnswer.match(/([A-D])\./g);
                                if (matches) {
                                    correctLetters = matches.map(m => m.charAt(0)).sort().join('');
                                }
                            }
                        }
                        
                        if (question.type === 'Â§öÈÄâÈ¢ò') {
                            const userLetters = userAnswer ? userAnswer.split('').sort().join('') : '';
                            isCorrect = userLetters === correctLetters;
                        } else {
                            isCorrect = userAnswer === correctLetters;
                        }
                    } else {
                        isCorrect = userAnswer === correctAnswer;
                    }
                    
                    if (isCorrect && question.score !== undefined) {
                        totalScore += question.score;
                    }
                });
                
                // Â¶ÇÊûúÊ≤°ÊúâËÆæÁΩÆÂàÜÊï∞Â±ûÊÄßÔºåÂàô‰ΩøÁî®ÂéüÊù•ÁöÑÂπ≥ÂùáÂàÜÈÖçÊñπÂºè
                if (totalScore === 0 && correctCount > 0 && scoredQuestions.length > 0) {
                    totalScore = parseFloat(((100 / scoredQuestions.length) * correctCount).toFixed(1));
                }
                
                console.log(`Á≠îÈ¢òÁªüËÆ°: ËÆ°ÂàÜÈ¢òÁõÆ${scoredQuestions.length}È¢òÔºåÂ∑≤Á≠îÈ¢ò${answeredCount}È¢òÔºåÊ≠£Á°Æ${correctCount}È¢òÔºåÊÄªÂàÜ${totalScore}ÂàÜ`);
                console.log(`ÂàÜÊï∞ËÆ°ÁÆó: 100 / ${scoredQuestions.length} * ${correctCount} = ${totalScore}`);
                this.displayResults(correctCount, wrongQuestions, essayQuestions, totalScore, scoredQuestions.length);
            }

            displayResults(correctCount, wrongQuestions, essayQuestions, totalScore, scoredQuestionsCount) {
                const wrongCount = scoredQuestionsCount - correctCount;
                const accuracy = scoredQuestionsCount > 0 ? Math.round((correctCount / scoredQuestionsCount) * 100) : 0;

                document.getElementById('totalScore').textContent = totalScore;
                document.getElementById('correctCount').textContent = correctCount;
                document.getElementById('wrongCount').textContent = wrongCount;
                document.getElementById('accuracy').textContent = `${accuracy}%`;
                document.getElementById('examTime').textContent = this.getExamDuration();
                
                // ËÆ°ÁÆóÂπ≥ÂùáÁî®Êó∂
                const avgTimePerQuestion = this.getAverageTimePerQuestion();
                document.getElementById('avgTimePerQuestion').textContent = avgTimePerQuestion;
                
                // ËÆ°ÁÆóÊ≠£Á°ÆÈ¢òÁõÆ
                const correctQuestions = [];
                const wrongQuestionIndexes = new Set(wrongQuestions.map(wq => wq.index - 1)); // ËΩ¨Êç¢‰∏∫0Âü∫Á¥¢Âºï
                
                this.questions.forEach((question, index) => {
                    if (!wrongQuestionIndexes.has(index) && this.userAnswers[index] !== null && this.userAnswers[index] !== undefined && this.userAnswers[index] !== '') {
                        // ÊéíÈô§ÈóÆÁ≠îÈ¢òÔºåÂõ†‰∏∫ÈóÆÁ≠îÈ¢ò‰∏çÂèÇ‰∏éÊ≠£Á°Æ/ÈîôËØØÂà§Êñ≠
                        if (question.type !== 'ÈóÆÁ≠îÈ¢ò') {
                            correctQuestions.push({
                                question: question,
                                userAnswer: this.userAnswers[index],
                                index: index + 1
                            });
                        }
                    }
                });

                // ÊòæÁ§∫ÈîôËØØÈ¢òÁõÆ
                const wrongQuestionsContainer = document.getElementById('wrongQuestions');
                // Ê∏ÖÈô§‰πãÂâçÁöÑÈ¢òÁõÆÂÜÖÂÆπÔºå‰ΩÜ‰øùÁïôÊ†áÈ¢òÂíåÂØºÂá∫ÊåâÈíÆ
                const existingHeader = wrongQuestionsContainer.querySelector('.wrong-questions-header');
                if (existingHeader) {
                    // Âè™Ê∏ÖÈô§È¢òÁõÆÂÜÖÂÆπÔºå‰øùÁïôheader
                    const questionsContent = wrongQuestionsContainer.querySelectorAll('.wrong-question');
                    questionsContent.forEach(q => q.remove());
                    // Ê∏ÖÈô§ÂèØËÉΩÂ≠òÂú®ÁöÑÊÅ≠Âñú‰ø°ÊÅØ
                    const congratsMsg = wrongQuestionsContainer.querySelector('p');
                    if (congratsMsg) congratsMsg.remove();
                } else {
                    wrongQuestionsContainer.innerHTML = '<h3>‚ùå ÈîôËØØÈ¢òÁõÆÂ§ç‰π†</h3>';
                }
                
                // ÊòæÁ§∫ÈîôÈ¢òÊìç‰ΩúÂå∫ÂüüÔºàÂåÖÂê´ÂØºÂá∫ÂíåÈáçËÄÉÊåâÈíÆÔºâ
                const wrongActions = document.getElementById('wrongActions');
                const exportWrongControls = document.getElementById('exportWrongControls');
                if (wrongActions && exportWrongControls) {
                    if (wrongQuestions.length > 0) {
                        wrongActions.style.display = 'flex';
                        exportWrongControls.style.display = 'flex';
                    } else {
                        wrongActions.style.display = 'none';
                        exportWrongControls.style.display = 'none';
                    }
                }

                if (wrongQuestions.length === 0) {
                    const congratsMsg = document.createElement('p');
                    congratsMsg.style.color = '#4CAF50';
                    congratsMsg.style.fontWeight = 'bold';
                    congratsMsg.textContent = 'üéâ ÊÅ≠ÂñúÔºÅÂÖ®ÈÉ®Á≠îÂØπ‰∫ÜÔºÅ';
                    wrongQuestionsContainer.appendChild(congratsMsg);
                } else {
                    // Â≠òÂÇ®ÈîôÈ¢òÊï∞ÊçÆ‰æõÂØºÂá∫‰ΩøÁî®
                    this.wrongQuestionsData = wrongQuestions;
                    
                    wrongQuestions.forEach(({ question, userAnswer, index }) => {
                        const wrongDiv = document.createElement('div');
                        wrongDiv.className = 'wrong-question';
                        
                        let userAnswerText = userAnswer;
                        if (Array.isArray(userAnswer)) {
                            userAnswerText = userAnswer.join(', ');
                        }
                        if (!userAnswerText) {
                            userAnswerText = 'Êú™‰ΩúÁ≠î';
                        }
                        
                        wrongDiv.innerHTML = `
                            <h4>Á¨¨${index}È¢ò (${question.type})</h4>
                            <p><strong>È¢òÁõÆÔºö</strong>${question.question}</p>
                            ${question.options ? `<p><strong>ÈÄâÈ°πÔºö</strong>${question.options.replace(/\|/g, ' | ')}</p>` : ''}
                            <p><strong>ÊÇ®ÁöÑÁ≠îÊ°àÔºö</strong><span style="color: #f44336;">${userAnswerText}</span></p>
                            <p><strong>Ê≠£Á°ÆÁ≠îÊ°àÔºö</strong><span style="color: #4CAF50;">${question.answer}</span></p>
                            <p><strong>Á≠îÊ°àËØ¥ÊòéÔºö</strong>${question.explanation}</p>
                        `;
                        
                        wrongQuestionsContainer.appendChild(wrongDiv);
                    });
                    
                    // ÂØºÂá∫‰∏ãÊãâËèúÂçï‰∫ã‰ª∂Â∑≤Âú®ÈîôÈ¢òÈÉ®ÂàÜÁªëÂÆö
                }
                
                // ÊòæÁ§∫Ê≠£Á°ÆÈ¢òÁõÆ
                const correctQuestionsContainer = document.getElementById('correctQuestions');
                // Ê∏ÖÈô§‰πãÂâçÁöÑÈ¢òÁõÆÂÜÖÂÆπÔºå‰ΩÜ‰øùÁïôÊ†áÈ¢òÂíåÂØºÂá∫ÊåâÈíÆ
                const existingCorrectHeader = correctQuestionsContainer.querySelector('.correct-questions-header');
                if (existingCorrectHeader) {
                    // Âè™Ê∏ÖÈô§È¢òÁõÆÂÜÖÂÆπÔºå‰øùÁïôheader
                    const questionsContent = correctQuestionsContainer.querySelectorAll('.correct-question');
                    questionsContent.forEach(q => q.remove());
                    // Ê∏ÖÈô§ÂèØËÉΩÂ≠òÂú®ÁöÑÊèêÁ§∫‰ø°ÊÅØ
                    const noCorrectMsg = correctQuestionsContainer.querySelector('p');
                    if (noCorrectMsg) noCorrectMsg.remove();
                } else {
                    correctQuestionsContainer.innerHTML = '<h3>‚úÖ Ê≠£Á°ÆÈ¢òÁõÆÂ±ïÁ§∫</h3>';
                }
                
                // ÊòæÁ§∫ÂØºÂá∫Ê≠£Á°ÆÈ¢òÁõÆÂíåÂÖ®ÈÉ®È¢òÁõÆ‰∏ãÊãâËèúÂçï
                const exportCorrectControls = document.getElementById('exportCorrectControls');
                const exportAllControls = document.getElementById('exportAllControls');
                
                if (exportCorrectControls) {
                    if (correctQuestions.length > 0) {
                        exportCorrectControls.style.display = 'flex';
                    } else {
                        exportCorrectControls.style.display = 'none';
                    }
                }
                
                if (exportAllControls) {
                    if (this.questions.length > 0) {
                        exportAllControls.style.display = 'flex';
                    } else {
                        exportAllControls.style.display = 'none';
                    }
                }
                
                if (correctQuestions.length === 0) {
                    const noCorrectMsg = document.createElement('p');
                    noCorrectMsg.style.color = '#ff9800';
                    noCorrectMsg.style.fontWeight = 'bold';
                    noCorrectMsg.textContent = 'üòî Êú¨Ê¨°ËÄÉËØïÊ≤°ÊúâÁ≠îÂØπÁöÑÈ¢òÁõÆÔºåÁªßÁª≠Âä™ÂäõÔºÅ';
                    correctQuestionsContainer.appendChild(noCorrectMsg);
                } else {
                    // Â≠òÂÇ®Ê≠£Á°ÆÈ¢òÁõÆÊï∞ÊçÆ‰æõÂØºÂá∫‰ΩøÁî®
                    this.correctQuestionsData = correctQuestions;
                    
                    correctQuestions.forEach(({ question, userAnswer, index }) => {
                        const correctDiv = document.createElement('div');
                        correctDiv.className = 'correct-question';
                        
                        let userAnswerText = userAnswer;
                        if (Array.isArray(userAnswer)) {
                            userAnswerText = userAnswer.join(', ');
                        }
                        
                        correctDiv.innerHTML = `
                            <h4>Á¨¨${index}È¢ò (${question.type})</h4>
                            <p><strong>È¢òÁõÆÔºö</strong>${question.question}</p>
                            ${question.options ? `<p><strong>ÈÄâÈ°πÔºö</strong>${question.options.replace(/\|/g, ' | ')}</p>` : ''}
                            <p><strong>ÊÇ®ÁöÑÁ≠îÊ°àÔºö</strong><span style="color: #4CAF50;">${userAnswerText}</span></p>
                            <p><strong>Ê≠£Á°ÆÁ≠îÊ°àÔºö</strong><span style="color: #4CAF50;">${question.answer}</span></p>
                            <p><strong>Á≠îÊ°àËØ¥ÊòéÔºö</strong>${question.explanation}</p>
                        `;
                        
                        correctQuestionsContainer.appendChild(correctDiv);
                    });
                }

                // ÊòæÁ§∫ÈóÆÁ≠îÈ¢òÁ≠îÊ°àÂØπÊØî
                const essayAnswersContainer = document.getElementById('essayAnswers');
                essayAnswersContainer.innerHTML = '<h3>üìù ÈóÆÁ≠îÈ¢òÁ≠îÊ°àÂØπÊØî</h3>';

                if (essayQuestions.length === 0) {
                    essayAnswersContainer.innerHTML += '<p style="color: #666;">Êú¨Ê¨°ËÄÉËØïÊ≤°ÊúâÈóÆÁ≠îÈ¢ò„ÄÇ</p>';
                } else {
                    essayQuestions.forEach(({ question, userAnswer, index }) => {
                        const essayDiv = document.createElement('div');
                        essayDiv.className = 'essay-question';
                        
                        let userAnswerText = userAnswer || 'Êú™‰ΩúÁ≠î';
                        
                        essayDiv.innerHTML = `
                            <h4>Á¨¨${index}È¢ò (${question.type})</h4>
                            <p><strong>È¢òÁõÆÔºö</strong>${question.question}</p>
                            <div class="essay-answer user-essay-answer">
                                <strong>ÊÇ®ÁöÑÁ≠îÊ°àÔºö</strong><br>${userAnswerText}
                            </div>
                            <div class="essay-answer correct-essay-answer">
                                <strong>ÂèÇËÄÉÁ≠îÊ°àÔºö</strong><br>${question.answer}
                            </div>
                        `;
                        
                        essayAnswersContainer.appendChild(essayDiv);
                    });
                }

                document.getElementById('exam-section').classList.add('hidden');
                document.getElementById('result-section').classList.remove('hidden');
            }



            updateQuestionStatus() {
                const statusContainer = document.getElementById('questionStatus');
                // ‰øùÂ≠òÂΩìÂâçÊäòÂè†Áä∂ÊÄÅ
                const isCollapsed = statusContainer.classList.contains('collapsed');
                statusContainer.innerHTML = '';
                // ÊÅ¢Â§çÊäòÂè†Áä∂ÊÄÅ
                if (isCollapsed) {
                    statusContainer.classList.add('collapsed');
                }
                let answeredCount = 0;
                
                this.questions.forEach((_, index) => {
                    const statusItem = document.createElement('div');
                    statusItem.className = 'status-item';
                    statusItem.textContent = index + 1;
                    
                    // Ê£ÄÊü•ÊòØÂê¶Â∑≤Á≠îÈ¢ò
                    const hasAnswer = this.userAnswers[index] !== null && this.userAnswers[index] !== undefined && this.userAnswers[index] !== '';
                    if (hasAnswer) {
                        if (Array.isArray(this.userAnswers[index])) {
                            if (this.userAnswers[index].length > 0) {
                                statusItem.classList.add('answered');
                                answeredCount++;
                            }
                        } else {
                            statusItem.classList.add('answered');
                            answeredCount++;
                        }
                    }
                    
                    // Ê†áËÆ∞ÂΩìÂâçÈ¢òÁõÆ
                    if (index === this.currentQuestionIndex) {
                        statusItem.classList.add('current');
                    }
                    
                    // Ê∑ªÂä†ÁÇπÂáªË∑≥ËΩ¨ÂäüËÉΩ
                    statusItem.addEventListener('click', () => {
                        this.currentQuestionIndex = index;
                        this.displayQuestion();
                    });
                    
                    statusContainer.appendChild(statusItem);
                });
                
                // Êõ¥Êñ∞Â∑≤Á≠îÈ¢òÊï∞ÈáèÊòæÁ§∫
                document.getElementById('answeredCount').textContent = `Â∑≤Á≠îÈ¢ò: ${answeredCount}`;
            }

            showAnswerSaved() {
                const notification = document.getElementById('answerSavedNotification');
                notification.classList.add('show');
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 2000);
                // Êõ¥Êñ∞Á≠îÈ¢òÁä∂ÊÄÅ
                this.updateQuestionStatus();
            }

            confirmAnswer(questionIndex, userAnswer) {
                const question = this.questions[questionIndex];
                const correctAnswer = question.answer;
                
                // Ê†áËÆ∞È¢òÁõÆÂ∑≤ÂõûÁ≠î
                this.answeredQuestions.add(questionIndex);
                
                // Âà§Êñ≠Á≠îÊ°àÊòØÂê¶Ê≠£Á°Æ
                let isCorrect = false;
                
                if (question.type === 'ÂçïÈÄâÈ¢ò' || question.type === 'Â§öÈÄâÈ¢ò') {
                    // ÊèêÂèñÊ≠£Á°ÆÁ≠îÊ°à‰∏≠ÁöÑÂ≠óÊØçÈÉ®ÂàÜ
                    let correctLetters = '';
                    if (question.type === 'ÂçïÈÄâÈ¢ò') {
                        const match = correctAnswer.match(/^([A-D])/);
                        correctLetters = match ? match[1] : '';
                    } else {
                        if (/^[A-D]+$/.test(correctAnswer.trim())) {
                            correctLetters = correctAnswer.trim().split('').sort().join('');
                        } else {
                            const matches = correctAnswer.match(/([A-D])\./g);
                            if (matches) {
                                correctLetters = matches.map(m => m.charAt(0)).sort().join('');
                            }
                        }
                    }
                    
                    if (question.type === 'Â§öÈÄâÈ¢ò') {
                        const userLetters = userAnswer ? userAnswer.split('').sort().join('') : '';
                        isCorrect = userLetters === correctLetters;
                    } else {
                        isCorrect = userAnswer === correctLetters;
                    }
                } else {
                    isCorrect = userAnswer === correctAnswer;
                }
                
                // ÊòæÁ§∫ÁªìÊûú
                this.showAnswerResult(questionIndex, document.getElementById('optionsContainer'), isCorrect);
                
                // Á¶ÅÁî®ËæìÂÖ•
                const container = document.getElementById('optionsContainer');
                const inputs = container.querySelectorAll('input, textarea');
                inputs.forEach(input => input.disabled = true);
                
                // ÈöêËóèÁ°ÆÂÆöÊåâÈíÆ
                const confirmBtn = container.querySelector('.confirm-answer-btn');
                if (confirmBtn) {
                    confirmBtn.style.display = 'none';
                }
                
                // Á¶ÅÁî®Âà§Êñ≠È¢òÈÄâÈ°πÁÇπÂáª
                const options = container.querySelectorAll('.option');
                options.forEach(option => {
                    option.style.pointerEvents = 'none';
                });
            }

            showAnswerResult(questionIndex, container, isCorrect = null) {
                const question = this.questions[questionIndex];
                const userAnswer = this.userAnswers[questionIndex];
                
                // Â¶ÇÊûúÊ≤°Êúâ‰º†ÂÖ•isCorrectÔºåÈáçÊñ∞ËÆ°ÁÆó
                if (isCorrect === null) {
                    const correctAnswer = question.answer;
                    
                    if (question.type === 'ÂçïÈÄâÈ¢ò' || question.type === 'Â§öÈÄâÈ¢ò') {
                        let correctLetters = '';
                        if (question.type === 'ÂçïÈÄâÈ¢ò') {
                            const match = correctAnswer.match(/^([A-D])/);
                            correctLetters = match ? match[1] : '';
                        } else {
                            if (/^[A-D]+$/.test(correctAnswer.trim())) {
                                correctLetters = correctAnswer.trim().split('').sort().join('');
                            } else {
                                const matches = correctAnswer.match(/([A-D])\./g);
                                if (matches) {
                                    correctLetters = matches.map(m => m.charAt(0)).sort().join('');
                                }
                            }
                        }
                        
                        if (question.type === 'Â§öÈÄâÈ¢ò') {
                            const userLetters = userAnswer ? userAnswer.split('').sort().join('') : '';
                            isCorrect = userLetters === correctLetters;
                        } else {
                            isCorrect = userAnswer === correctLetters;
                        }
                    } else {
                        isCorrect = userAnswer === correctAnswer;
                    }
                }
                
                // ÁßªÈô§‰πãÂâçÁöÑÁªìÊûúÊòæÁ§∫
                const existingResult = container.querySelector('.answer-result');
                if (existingResult) {
                    existingResult.remove();
                }
                
                // ÂàõÂª∫ÁªìÊûúÊòæÁ§∫
                const resultDiv = document.createElement('div');
                resultDiv.className = 'answer-result';
                resultDiv.style.marginTop = '15px';
                resultDiv.style.padding = '15px';
                resultDiv.style.borderRadius = '8px';
                resultDiv.style.fontWeight = 'bold';
                
                if (isCorrect) {
                    resultDiv.style.backgroundColor = '#d4edda';
                    resultDiv.style.color = '#155724';
                    resultDiv.style.border = '1px solid #c3e6cb';
                    let correctContent = '‚úÖ <strong>Ê≠£Á°ÆÔºÅ</strong>';
                    if (question.explanation && question.explanation.trim()) {
                        correctContent += `<br><span style="margin-top: 8px; display: block; font-weight: normal;">Á≠îÊ°àËØ¥ÊòéÔºö${question.explanation}</span>`;
                    }
                    resultDiv.innerHTML = correctContent;
                } else {
                    resultDiv.style.backgroundColor = '#f8d7da';
                    resultDiv.style.color = '#721c24';
                    resultDiv.style.border = '1px solid #f5c6cb';
                    let errorContent = `‚ùå <strong>ÈîôËØØÔºÅ</strong><br><span style="margin-top: 8px; display: block;">Ê≠£Á°ÆÁ≠îÊ°àÔºö${question.answer}</span>`;
                    if (question.explanation && question.explanation.trim()) {
                        errorContent += `<br><span style="margin-top: 8px; display: block; font-weight: normal;">Á≠îÊ°àËØ¥ÊòéÔºö${question.explanation}</span>`;
                    }
                    resultDiv.innerHTML = errorContent;
                }
                
                container.appendChild(resultDiv);
            }

            exportWrongQuestions(format = 'csv') {
                if (!this.wrongQuestionsData || this.wrongQuestionsData.length === 0) {
                    alert('Ê≤°ÊúâÈîôÈ¢òÂèØ‰ª•ÂØºÂá∫');
                    return;
                }

                const headers = ['È¢òÁõÆÁºñÂè∑', 'È¢òÁõÆÁ±ªÂûã', 'È¢òÁõÆÂÜÖÂÆπ', 'ÈÄâÈ°π', 'Ê≠£Á°ÆÁ≠îÊ°à', 'Á≠îÊ°àËØ¥Êòé', 'ÈîôËØØÁ≠îÊ°à'];
                const data = [];
                
                this.wrongQuestionsData.forEach(({ question, userAnswer }) => {
                    let userAnswerText = userAnswer;
                    if (Array.isArray(userAnswer)) {
                        userAnswerText = userAnswer.join('');
                    }
                    if (!userAnswerText) {
                        userAnswerText = 'Êú™‰ΩúÁ≠î';
                    }
                    
                    data.push([
                        question.id,
                        question.type,
                        question.question,
                        question.options,
                        question.answer,
                        question.explanation,
                        userAnswerText
                    ]);
                });

                this.downloadFile(headers, data, `ÈîôÈ¢òÈõÜ_${new Date().toISOString().slice(0, 10)}`, format);
                alert(`Â∑≤ÂØºÂá∫ ${this.wrongQuestionsData.length} ÈÅìÈîôÈ¢ò`);
            }
            
            exportCorrectQuestions(format = 'csv') {
                if (!this.correctQuestionsData || this.correctQuestionsData.length === 0) {
                    alert('Ê≤°ÊúâÊ≠£Á°ÆÈ¢òÁõÆÂèØ‰ª•ÂØºÂá∫');
                    return;
                }

                const headers = ['È¢òÁõÆÁºñÂè∑', 'È¢òÁõÆÁ±ªÂûã', 'È¢òÁõÆÂÜÖÂÆπ', 'ÈÄâÈ°π', 'Ê≠£Á°ÆÁ≠îÊ°à', 'Á≠îÊ°àËØ¥Êòé', 'ÊÇ®ÁöÑÁ≠îÊ°à'];
                const data = [];
                
                this.correctQuestionsData.forEach(({ question, userAnswer }) => {
                    let userAnswerText = userAnswer;
                    if (Array.isArray(userAnswer)) {
                        userAnswerText = userAnswer.join('');
                    }
                    
                    data.push([
                        question.id,
                        question.type,
                        question.question,
                        question.options,
                        question.answer,
                        question.explanation,
                        userAnswerText
                    ]);
                });

                this.downloadFile(headers, data, `Ê≠£Á°ÆÈ¢òÁõÆ_${new Date().toISOString().slice(0, 10)}`, format);
                alert(`Â∑≤ÂØºÂá∫ ${this.correctQuestionsData.length} ÈÅìÊ≠£Á°ÆÈ¢òÁõÆ`);
            }
            
            exportAllQuestions(format = 'csv') {
                if (!this.questions || this.questions.length === 0) {
                    alert('Ê≤°ÊúâÈ¢òÁõÆÂèØ‰ª•ÂØºÂá∫');
                    return;
                }

                const headers = ['È¢òÁõÆÁºñÂè∑', 'È¢òÁõÆÁ±ªÂûã', 'È¢òÁõÆÂÜÖÂÆπ', 'ÈÄâÈ°π', 'Ê≠£Á°ÆÁ≠îÊ°à', 'Á≠îÊ°àËØ¥Êòé', 'ÊÇ®ÁöÑÁ≠îÊ°à', 'Á≠îÈ¢òÁä∂ÊÄÅ'];
                const data = [];
                
                this.questions.forEach((question, index) => {
                    let userAnswer = this.userAnswers[index];
                    let userAnswerText = '';
                    let answerStatus = 'Êú™‰ΩúÁ≠î';
                    
                    if (userAnswer !== null && userAnswer !== undefined && userAnswer !== '') {
                        if (Array.isArray(userAnswer)) {
                            userAnswerText = userAnswer.join('');
                        } else {
                            userAnswerText = userAnswer;
                        }
                        
                        // Âà§Êñ≠Á≠îÈ¢òÁä∂ÊÄÅ
                        if (question.type === 'ÈóÆÁ≠îÈ¢ò') {
                            answerStatus = 'Â∑≤‰ΩúÁ≠î';
                        } else {
                            // Âà§Êñ≠ÊòØÂê¶Ê≠£Á°Æ
                            const wrongQuestionIndexes = this.wrongQuestionsData ? 
                                new Set(this.wrongQuestionsData.map(wq => wq.index - 1)) : new Set();
                            answerStatus = wrongQuestionIndexes.has(index) ? 'ÈîôËØØ' : 'Ê≠£Á°Æ';
                        }
                    }
                    
                    data.push([
                        question.id,
                        question.type,
                        question.question,
                        question.options,
                        question.answer,
                        question.explanation,
                        userAnswerText,
                        answerStatus
                    ]);
                });

                this.downloadFile(headers, data, `ÂÖ®ÈÉ®È¢òÁõÆ_${new Date().toISOString().slice(0, 10)}`, format);
                alert(`Â∑≤ÂØºÂá∫ ${this.questions.length} ÈÅìÈ¢òÁõÆ`);
            }
            
            retakeWrongQuestions() {
                if (!this.wrongQuestionsData || this.wrongQuestionsData.length === 0) {
                    alert('Ê≤°ÊúâÈîôÈ¢òÂèØ‰ª•ÈáçËÄÉ');
                    return;
                }
                
                // Á°ÆËÆ§ÊòØÂê¶Ë¶ÅÂºÄÂßãÈîôÈ¢òÈáçËÄÉËÆæÁΩÆ
                if (!confirm(`Á°ÆÂÆöË¶ÅÂºÄÂßãÈîôÈ¢òÈáçËÄÉÂêóÔºü\nÂ∞ÜËøõÂÖ•ËÄÉËØïËÆæÁΩÆÈ°µÈù¢ÔºåÊÇ®ÂèØ‰ª•ÈáçÊñ∞ÈÖçÁΩÆ ${this.wrongQuestionsData.length} ÈÅìÈîôÈ¢òÁöÑËÄÉËØïÂèÇÊï∞„ÄÇ`)) {
                    return;
                }
                
                // Ê†áËÆ∞ÂΩìÂâç‰∏∫ÈîôÈ¢òÈáçËÄÉÊ®°Âºè
                this.isRetakeMode = true;
                this.retakeQuestions = this.wrongQuestionsData.map(item => item.question);
                
                // ÊòæÁ§∫ÈîôÈ¢òÈáçËÄÉËÆæÁΩÆÈ°µÈù¢
                this.showRetakeSettings();
            }
            
            showRetakeSettings() {
                // ÈöêËóèÁªìÊûúÂå∫Âüü
                document.getElementById('result-section').classList.add('hidden');
                
                // ÊòæÁ§∫È¢òÂ∫ì‰ø°ÊÅØÂå∫Âüü
                document.getElementById('library-section').classList.remove('hidden');
                
                // Êõ¥Êñ∞È¢òÂ∫ìÁªüËÆ°‰ø°ÊÅØÔºàÂü∫‰∫éÈîôÈ¢òÊï∞ÊçÆÔºâ
                this.updateRetakeStats();
                
                // ÊòæÁ§∫ËÄÉËØïËÆæÁΩÆÂå∫Âüü
                document.getElementById('exam-settings').style.display = 'block';
                
                // ÈöêËóèÂºÄÂßãËÄÉËØïÊåâÈíÆ
                const startExamBtn = document.getElementById('startExam');
                if (startExamBtn) {
                    startExamBtn.style.display = 'none';
                }
                
                // Êõ¥Êñ∞ËÆæÁΩÆÈ°µÈù¢Ê†áÈ¢ò
                const settingsTitle = document.querySelector('#exam-settings h3');
                if (settingsTitle) {
                    settingsTitle.textContent = 'üìù ÈîôÈ¢òÈáçËÄÉËÆæÁΩÆ';
                }
                
                // Êõ¥Êñ∞ÂèØÁî®È¢òÁõÆÊï∞ÈáèÔºàÂü∫‰∫éÈîôÈ¢òÔºâ
                this.updateRetakeAvailableQuestions();
                
                // ‰øÆÊîπÁ°ÆËÆ§ÊåâÈíÆÊñáÊú¨
                const confirmBtn = document.getElementById('confirmSettings');
                if (confirmBtn) {
                    confirmBtn.textContent = '‚úÖ ÂºÄÂßãÈîôÈ¢òÈáçËÄÉ';
                }
            }
            
            updateRetakeStats() {
                // ÁªüËÆ°ÈîôÈ¢ò‰∏≠ÂêÑÈ¢òÂûãÁöÑÊï∞Èáè
                const stats = {
                    single: this.retakeQuestions.filter(q => q.type === 'ÂçïÈÄâÈ¢ò').length,
                    multi: this.retakeQuestions.filter(q => q.type === 'Â§öÈÄâÈ¢ò').length,
                    trueOrFalse: this.retakeQuestions.filter(q => q.type === 'Âà§Êñ≠È¢ò').length,
                    essay: this.retakeQuestions.filter(q => q.type === 'ÈóÆÁ≠îÈ¢ò').length
                };
                
                const total = stats.single + stats.multi + stats.trueOrFalse + stats.essay;
                
                // Êõ¥Êñ∞ÁªüËÆ°ÊòæÁ§∫
                document.getElementById('totalQuestions').textContent = total;
                document.getElementById('singleChoice').textContent = stats.single;
                document.getElementById('multiChoice').textContent = stats.multi;
                document.getElementById('trueOrFalse').textContent = stats.trueOrFalse;
                document.getElementById('essay').textContent = stats.essay;
            }
            
            updateRetakeAvailableQuestions() {
                // ËÆ°ÁÆóÈîôÈ¢ò‰∏≠ÂêÑÈ¢òÂûãÁöÑÂèØÁî®È¢òÁõÆÊï∞Èáè
                const availableStats = {
                    single: this.retakeQuestions.filter(q => q.type === 'ÂçïÈÄâÈ¢ò').length,
                    multi: this.retakeQuestions.filter(q => q.type === 'Â§öÈÄâÈ¢ò').length,
                    trueOrFalse: this.retakeQuestions.filter(q => q.type === 'Âà§Êñ≠È¢ò').length,
                    essay: this.retakeQuestions.filter(q => q.type === 'ÈóÆÁ≠îÈ¢ò').length
                };
                
                // Êõ¥Êñ∞ÂèØÁî®È¢òÁõÆÊï∞ÈáèÊòæÁ§∫
                document.getElementById('singleAvailable').textContent = `(${availableStats.single}È¢ò)`;
                document.getElementById('multiAvailable').textContent = `(${availableStats.multi}È¢ò)`;
                document.getElementById('trueOrFalseAvailable').textContent = `(${availableStats.trueOrFalse}È¢ò)`;
                document.getElementById('essayAvailable').textContent = `(${availableStats.essay}È¢ò)`;
                
                // Êõ¥Êñ∞ÂêÑÈ¢òÂûãÁöÑÊúÄÂ§ßÊï∞ÈáèÊèêÁ§∫
                document.getElementById('singleMaxHint').textContent = `ÊúÄÂ§ö ${availableStats.single} È¢ò`;
                document.getElementById('multiMaxHint').textContent = `ÊúÄÂ§ö ${availableStats.multi} È¢ò`;
                document.getElementById('trueOrFalseMaxHint').textContent = `ÊúÄÂ§ö ${availableStats.trueOrFalse} È¢ò`;
                document.getElementById('essayMaxHint').textContent = `ÊúÄÂ§ö ${availableStats.essay} È¢ò`;
                
                // ËÆæÁΩÆÂêÑÈ¢òÂûãËæìÂÖ•Ê°ÜÁöÑÊúÄÂ§ßÂÄºÂíåÈªòËÆ§ÂÄº
                document.getElementById('singleCount').max = availableStats.single;
                document.getElementById('singleCount').value = availableStats.single;
                document.getElementById('multiCount').max = availableStats.multi;
                document.getElementById('multiCount').value = availableStats.multi;
                document.getElementById('trueOrFalseCount').max = availableStats.trueOrFalse;
                document.getElementById('trueOrFalseCount').value = availableStats.trueOrFalse;
                document.getElementById('essayCount').max = availableStats.essay;
                document.getElementById('essayCount').value = availableStats.essay;
                
                // Êõ¥Êñ∞ÊÄªÈ¢òÁõÆÊï∞
                this.updateTotalCount();
            }
            
            downloadFile(headers, data, filename, format) {
                if (format === 'xlsx') {
                    // ÂàõÂª∫ExcelÊñá‰ª∂
                    const ws = XLSX.utils.aoa_to_sheet([headers, ...data]);
                    const wb = XLSX.utils.book_new();
                    XLSX.utils.book_append_sheet(wb, ws, 'Sheet1');
                    XLSX.writeFile(wb, `${filename}.xlsx`);
                } else {
                    // ÂàõÂª∫CSVÊñá‰ª∂
                    const escapeCSV = (field) => {
                        if (typeof field !== 'string') field = String(field);
                        if (field.includes(',') || field.includes('"') || field.includes('\n')) {
                            return '"' + field.replace(/"/g, '""') + '"';
                        }
                        return field;
                    };
                    
                    let csvContent = headers.map(escapeCSV).join(',') + '\n';
                    data.forEach(row => {
                        csvContent += row.map(escapeCSV).join(',') + '\n';
                    });
                    
                    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                    const link = document.createElement('a');
                    const url = URL.createObjectURL(blob);
                    link.setAttribute('href', url);
                    link.setAttribute('download', `${filename}.csv`);
                    link.style.visibility = 'hidden';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                }
            }

            // Êó∂Èó¥ÁÆ°ÁêÜÊñπÊ≥ï
            startTimer() {
                this.examStartTime = new Date();
                
                if (this.isTimeLimited) {
                    // ÊòæÁ§∫ÂÄíËÆ°Êó∂
                    document.getElementById('examTimer').style.display = 'block';
                    document.getElementById('examDuration').style.display = 'none';
                    
                    this.timerInterval = setInterval(() => {
                        this.updateCountdownTimer();
                    }, 1000);
                } else {
                    // ÊòæÁ§∫Áî®Êó∂ÁªüËÆ°
                    document.getElementById('examTimer').style.display = 'none';
                    document.getElementById('examDuration').style.display = 'block';
                    
                    this.timerInterval = setInterval(() => {
                        this.updateDurationTimer();
                    }, 1000);
                }
            }
            
            updateCountdownTimer() {
                if (this.isPaused) {
                    return; // ÊöÇÂÅúÊó∂‰∏çÊõ¥Êñ∞ËÆ°Êó∂Âô®
                }
                
                const now = new Date();
                const elapsed = Math.floor((now - this.examStartTime - this.pausedTime) / 1000); // Â∑≤Áî®ÁßíÊï∞ÔºàÊâ£Èô§ÊöÇÂÅúÊó∂Èó¥Ôºâ
                const totalSeconds = this.examTimeLimit * 60; // ÊÄªÁßíÊï∞
                const remaining = totalSeconds - elapsed; // Ââ©‰ΩôÁßíÊï∞
                
                if (remaining <= 0) {
                    // Êó∂Èó¥Âà∞ÔºåËá™Âä®‰∫§Âç∑
                    this.stopTimer();
                    this.submitExam(true); // ‰º†ÂÖ•trueË°®Á§∫Ëá™Âä®‰∫§Âç∑
                    return;
                }
                
                const minutes = Math.floor(remaining / 60);
                const seconds = remaining % 60;
                const timeStr = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                const timerValue = document.getElementById('timerValue');
                timerValue.textContent = timeStr;
                
                // Ê†πÊçÆÂâ©‰ΩôÊó∂Èó¥Ê∑ªÂä†Ë≠¶ÂëäÊ†∑Âºè
                timerValue.className = 'timer-value';
                if (remaining <= 60) { // ÊúÄÂêé1ÂàÜÈíü
                    timerValue.classList.add('danger');
                } else if (remaining <= 300) { // ÊúÄÂêé5ÂàÜÈíü
                    timerValue.classList.add('warning');
                }
            }
            
            updateDurationTimer() {
                if (this.isPaused) {
                    return; // ÊöÇÂÅúÊó∂‰∏çÊõ¥Êñ∞ËÆ°Êó∂Âô®
                }
                
                const now = new Date();
                const elapsed = Math.floor((now - this.examStartTime - this.pausedTime) / 1000); // Â∑≤Áî®ÁßíÊï∞ÔºàÊâ£Èô§ÊöÇÂÅúÊó∂Èó¥Ôºâ
                
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                const timeStr = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                document.getElementById('durationValue').textContent = timeStr;
            }
            
            stopTimer() {
                if (this.timerInterval) {
                    clearInterval(this.timerInterval);
                    this.timerInterval = null;
                }
                this.examEndTime = new Date();
            }
            
            getExamDuration() {
                if (!this.examStartTime) return '00:00';
                
                const endTime = this.examEndTime || new Date();
                const elapsed = Math.floor((endTime - this.examStartTime - this.pausedTime) / 1000); // Êâ£Èô§ÊöÇÂÅúÊó∂Èó¥
                
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
            
            getAverageTimePerQuestion() {
                if (!this.examStartTime || this.questions.length === 0) return '00:00';
                
                const endTime = this.examEndTime || new Date();
                const totalElapsed = Math.floor((endTime - this.examStartTime - this.pausedTime) / 1000); // Êâ£Èô§ÊöÇÂÅúÊó∂Èó¥
                const avgSeconds = Math.floor(totalElapsed / this.questions.length);
                
                const minutes = Math.floor(avgSeconds / 60);
                const seconds = avgSeconds % 60;
                return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
            
            // ÊöÇÂÅú/ÊÅ¢Â§çÂäüËÉΩ
            togglePauseResume() {
                if (this.isPaused) {
                    // ÊÅ¢Â§çËÆ°Êó∂
                    this.resumeTimer();
                } else {
                    // ÊöÇÂÅúËÆ°Êó∂
                    this.pauseTimer();
                }
            }
            
            pauseTimer() {
                if (!this.isPaused && this.timerInterval) {
                    this.isPaused = true;
                    this.pauseStartTime = new Date();
                    
                    // Êõ¥Êñ∞ÊåâÈíÆÁä∂ÊÄÅ
                    const pauseBtn1 = document.getElementById('pauseResumeBtn');
                    const pauseBtn2 = document.getElementById('pauseResumeBtn2');
                    
                    if (pauseBtn1) {
                        pauseBtn1.textContent = '‚ñ∂Ô∏è ÊÅ¢Â§ç';
                        pauseBtn1.classList.add('paused');
                    }
                    if (pauseBtn2) {
                        pauseBtn2.textContent = '‚ñ∂Ô∏è ÊÅ¢Â§ç';
                        pauseBtn2.classList.add('paused');
                    }
                    
                    // Á¶ÅÁî®Á≠îÈ¢òÁõ∏ÂÖ≥ÁöÑ‰∫§‰∫íÂäüËÉΩ
                    this.disableExamInteraction();
                }
            }
            
            resumeTimer() {
                if (this.isPaused && this.pauseStartTime) {
                    // Á¥ØËÆ°ÊöÇÂÅúÊó∂Èó¥
                    this.pausedTime += new Date() - this.pauseStartTime;
                    this.isPaused = false;
                    this.pauseStartTime = null;
                    
                    // Êõ¥Êñ∞ÊåâÈíÆÁä∂ÊÄÅ
                    const pauseBtn1 = document.getElementById('pauseResumeBtn');
                    const pauseBtn2 = document.getElementById('pauseResumeBtn2');
                    
                    if (pauseBtn1) {
                        pauseBtn1.textContent = '‚è∏Ô∏è ÊöÇÂÅú';
                        pauseBtn1.classList.remove('paused');
                    }
                    if (pauseBtn2) {
                        pauseBtn2.textContent = '‚è∏Ô∏è ÊöÇÂÅú';
                        pauseBtn2.classList.remove('paused');
                    }
                    
                    // ÈáçÊñ∞ÂêØÁî®Á≠îÈ¢òÁõ∏ÂÖ≥ÁöÑ‰∫§‰∫íÂäüËÉΩ
                    this.enableExamInteraction();
                }
            }

            restart() {
                this.questions = [];
                this.currentQuestionIndex = 0;
                this.userAnswers = [];
                this.examStarted = false;
                this.wrongQuestionsData = null;
                this.correctQuestionsData = null; // Ê∏ÖÁ©∫Ê≠£Á°ÆÈ¢òÁõÆÊï∞ÊçÆ
                this.answeredQuestions.clear(); // Ê∏ÖÁ©∫Â∑≤ÂõûÁ≠îÈ¢òÁõÆËÆ∞ÂΩï
                this.selectedFile = null; // Ê∏ÖÈô§ÈÄâ‰∏≠ÁöÑÊñá‰ª∂
                
                // ÈáçÁΩÆÊó∂Èó¥Áõ∏ÂÖ≥ÂèòÈáè
                this.stopTimer();
                this.examStartTime = null;
                this.examEndTime = null;
                this.examTimeLimit = null;
                this.isTimeLimited = false;
                
                // ÈáçÁΩÆÊöÇÂÅúÁõ∏ÂÖ≥ÂèòÈáè
                this.isPaused = false;
                this.pausedTime = 0;
                this.pauseStartTime = null;

                document.getElementById('result-section').classList.add('hidden');
                document.getElementById('import-section').classList.remove('hidden');
                document.getElementById('csvFile').value = '';
                document.getElementById('file-info').classList.add('hidden');
                document.getElementById('parseBtn').disabled = true;
                
                // ÈöêËóèÊó∂Èó¥ÊòæÁ§∫Âå∫Âüü
                document.getElementById('examTimer').style.display = 'none';
                document.getElementById('examDuration').style.display = 'none';
                
                // Ê∏ÖÈô§Êñá‰ª∂ÈÄâ‰∏≠Áä∂ÊÄÅ
                document.querySelectorAll('.file-item').forEach(item => {
                    item.classList.remove('selected');
                });
                
                // ÈáçÊñ∞Ê£ÄÊµãCSVÊñá‰ª∂
                this.detectCSVFiles();
            }
            
            // Á¶ÅÁî®Á≠îÈ¢òÁõ∏ÂÖ≥ÁöÑ‰∫§‰∫íÂäüËÉΩ
            disableExamInteraction() {
                // Á¶ÅÁî®ÂØºËà™ÊåâÈíÆ
                const prevBtn = document.getElementById('prevBtn');
                const nextBtn = document.getElementById('nextBtn');
                const submitBtn = document.getElementById('submitBtn');
                
                if (prevBtn) {
                    prevBtn.disabled = true;
                    prevBtn.style.opacity = '0.5';
                }
                if (nextBtn) {
                    nextBtn.disabled = true;
                    nextBtn.style.opacity = '0.5';
                }
                if (submitBtn) {
                    submitBtn.disabled = true;
                    submitBtn.style.opacity = '0.5';
                }
                
                // Á¶ÅÁî®È¢òÁõÆÁä∂ÊÄÅÁÇπÂáªË∑≥ËΩ¨
                const statusItems = document.querySelectorAll('.status-item');
                statusItems.forEach(item => {
                    item.style.pointerEvents = 'none';
                    item.style.opacity = '0.5';
                });
                
                // Á¶ÅÁî®Á≠îÈ¢òÈÄâÈ°πÂíåËæìÂÖ•Ê°Ü
                const optionsContainer = document.getElementById('optionsContainer');
                if (optionsContainer) {
                    // Á¶ÅÁî®ÊâÄÊúâËæìÂÖ•ÂÖÉÁ¥†
                    const inputs = optionsContainer.querySelectorAll('input, textarea, button');
                    inputs.forEach(input => {
                        input.disabled = true;
                        input.style.opacity = '0.5';
                    });
                    
                    // Á¶ÅÁî®ÈÄâÈ°πÁÇπÂáª
                    const options = optionsContainer.querySelectorAll('.option');
                    options.forEach(option => {
                        option.style.pointerEvents = 'none';
                        option.style.opacity = '0.5';
                    });
                }
                
                // ÊòæÁ§∫ÊöÇÂÅúÊèêÁ§∫
                this.showPauseOverlay();
            }
            
            // ÂêØÁî®Á≠îÈ¢òÁõ∏ÂÖ≥ÁöÑ‰∫§‰∫íÂäüËÉΩ
            enableExamInteraction() {
                // ÂêØÁî®ÂØºËà™ÊåâÈíÆÔºàÊ†πÊçÆÂΩìÂâçÁä∂ÊÄÅÔºâ
                const prevBtn = document.getElementById('prevBtn');
                const nextBtn = document.getElementById('nextBtn');
                const submitBtn = document.getElementById('submitBtn');
                
                if (prevBtn) {
                    prevBtn.disabled = this.currentQuestionIndex === 0;
                    prevBtn.style.opacity = '';
                }
                if (nextBtn) {
                    nextBtn.disabled = false;
                    nextBtn.style.opacity = '';
                }
                if (submitBtn) {
                    submitBtn.disabled = false;
                    submitBtn.style.opacity = '';
                }
                
                // ÂêØÁî®È¢òÁõÆÁä∂ÊÄÅÁÇπÂáªË∑≥ËΩ¨
                const statusItems = document.querySelectorAll('.status-item');
                statusItems.forEach(item => {
                    item.style.pointerEvents = '';
                    item.style.opacity = '';
                });
                
                // ÂêØÁî®Á≠îÈ¢òÈÄâÈ°πÂíåËæìÂÖ•Ê°Ü
                const optionsContainer = document.getElementById('optionsContainer');
                if (optionsContainer) {
                    // ÂêØÁî®ÊâÄÊúâËæìÂÖ•ÂÖÉÁ¥†ÔºàÈô§‰∫ÜÂ∑≤ÁªèÂõûÁ≠îËøáÁöÑÈ¢òÁõÆÔºâ
                    const inputs = optionsContainer.querySelectorAll('input, textarea, button');
                    inputs.forEach(input => {
                        // Â¶ÇÊûúÂΩìÂâçÈ¢òÁõÆÂ∑≤ÁªèÂõûÁ≠îËøáÔºå‰øùÊåÅÁ¶ÅÁî®Áä∂ÊÄÅ
                        if (!this.answeredQuestions.has(this.currentQuestionIndex)) {
                            input.disabled = false;
                        }
                        input.style.opacity = '';
                    });
                    
                    // ÂêØÁî®ÈÄâÈ°πÁÇπÂáªÔºàÈô§‰∫ÜÂ∑≤ÁªèÂõûÁ≠îËøáÁöÑÈ¢òÁõÆÔºâ
                    const options = optionsContainer.querySelectorAll('.option');
                    options.forEach(option => {
                        if (!this.answeredQuestions.has(this.currentQuestionIndex)) {
                            option.style.pointerEvents = '';
                        }
                        option.style.opacity = '';
                    });
                }
                
                // ÈöêËóèÊöÇÂÅúÊèêÁ§∫
                this.hidePauseOverlay();
            }
            
            // ÊòæÁ§∫ÊöÇÂÅúÊèêÁ§∫Ë¶ÜÁõñÂ±Ç
            showPauseOverlay() {
                // Èò≤Ê≠¢È°µÈù¢ÊªöÂä®
                document.body.style.overflow = 'hidden';
                document.body.style.position = 'fixed';
                document.body.style.width = '100%';
                
                let overlay = document.getElementById('pauseOverlay');
                if (!overlay) {
                    overlay = document.createElement('div');
                    overlay.id = 'pauseOverlay';
                    overlay.innerHTML = `
                        <div class="pause-message">
                            <h3>‚è∏Ô∏è ËÄÉËØïÂ∑≤ÊöÇÂÅú</h3>
                            <p>ËÄÉËØïËÆ°Êó∂Â∑≤ÊöÇÂÅúÔºåÊâÄÊúâÁ≠îÈ¢òÂäüËÉΩÂ∑≤Á¶ÅÁî®</p>
                            <button id="resumeFromOverlay" class="resume-btn">‚ñ∂Ô∏è ÊÅ¢Â§çËÄÉËØï</button>
                        </div>
                    `;
                    overlay.style.cssText = `
                        position: fixed;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        background: rgba(0, 0, 0, 0.7);
                        display: flex;
                        justify-content: center;
                        align-items: center;
                        z-index: 9999;
                        backdrop-filter: blur(5px);
                    `;
                    
                    const pauseMessage = overlay.querySelector('.pause-message');
                    pauseMessage.style.cssText = `
                        background: white;
                        padding: 30px;
                        border-radius: 10px;
                        text-align: center;
                        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
                        max-width: 400px;
                        margin: 20px;
                    `;
                    
                    // ‰∏∫Ë¶ÜÁõñÂ±Ç‰∏≠ÁöÑÊÅ¢Â§çÊåâÈíÆÊ∑ªÂä†Ê†∑Âºè
                    const resumeBtn = overlay.querySelector('#resumeFromOverlay');
                    resumeBtn.style.cssText = `
                        background: #28a745;
                        color: white;
                        border: none;
                        padding: 12px 24px;
                        border-radius: 6px;
                        font-size: 16px;
                        cursor: pointer;
                        margin-top: 20px;
                        transition: background-color 0.3s;
                    `;
                    
                    // Ê∑ªÂä†ÊÇ¨ÂÅúÊïàÊûú
                    resumeBtn.addEventListener('mouseenter', () => {
                        resumeBtn.style.backgroundColor = '#218838';
                    });
                    resumeBtn.addEventListener('mouseleave', () => {
                        resumeBtn.style.backgroundColor = '#28a745';
                    });
                    
                    // ÁªëÂÆöÁÇπÂáª‰∫ã‰ª∂Âà∞ÊÅ¢Â§çÂäüËÉΩ
                    resumeBtn.addEventListener('click', () => {
                        this.togglePauseResume();
                    });
                    
                    document.body.appendChild(overlay);
                }
                overlay.style.display = 'flex';
            }
            
            // ÈöêËóèÊöÇÂÅúÊèêÁ§∫Ë¶ÜÁõñÂ±Ç
            hidePauseOverlay() {
                // ÊÅ¢Â§çÈ°µÈù¢ÊªöÂä®
                document.body.style.overflow = '';
                document.body.style.position = '';
                document.body.style.width = '';
                
                const overlay = document.getElementById('pauseOverlay');
                if (overlay) {
                    overlay.style.display = 'none';
                }
            }
        }

        // È°µÁ≠æÂàáÊç¢ÂáΩÊï∞
        function showTab(tabName) {
            // ÈöêËóèÊâÄÊúâÈ°µÁ≠æÂÜÖÂÆπ
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // ÁßªÈô§ÊâÄÊúâÊåâÈíÆÁöÑactiveÁä∂ÊÄÅ
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // ÊòæÁ§∫ÈÄâ‰∏≠ÁöÑÈ°µÁ≠æ
            if (tabName === 'wrong-questions') {
                document.getElementById('wrong-questions-tab').classList.add('active');
                document.querySelector('button[onclick="showTab(\'wrong-questions\')"]').classList.add('active');
            } else if (tabName === 'correct-questions') {
                document.getElementById('correct-questions-tab').classList.add('active');
                document.querySelector('button[onclick="showTab(\'correct-questions\')"]').classList.add('active');
            } else if (tabName === 'essay-answers') {
                document.getElementById('essay-answers-tab').classList.add('active');
                document.querySelector('button[onclick="showTab(\'essay-answers\')"]').classList.add('active');
            }
        }

        // ÂàùÂßãÂåñÂ∫îÁî®
        const app = new QuestionBank();

        // È¢òÁõÆÁä∂ÊÄÅÂå∫ÂüüÊäòÂè†/Â±ïÂºÄÂäüËÉΩ
        function toggleQuestionStatus() {
            const statusContainer = document.getElementById('questionStatus');
            const toggleIcon = document.getElementById('toggleIcon');
            
            statusContainer.classList.toggle('collapsed');
            
            // Êõ¥Êñ∞ÂõæÊ†áÊóãËΩ¨Áä∂ÊÄÅ
            if (statusContainer.classList.contains('collapsed')) {
                toggleIcon.style.transform = 'rotate(0deg)';
            } else {
                toggleIcon.style.transform = 'rotate(180deg)';
            }
        }
    </script>
</body>
</html>